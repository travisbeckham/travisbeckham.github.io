<!doctype html><html lang=en><head><meta charset=utf-8><title>Proxy Metrics | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Linkerd proxy natively exports Prometheus metrics for all incoming and outgoing traffic."><meta property="og:url" content="https://travisbeckham.github.io/2.15/reference/proxy-metrics/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Proxy Metrics"><meta property="og:description" content="The Linkerd proxy natively exports Prometheus metrics for all incoming and outgoing traffic."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.15"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Proxy Metrics"><meta name=twitter:description content="The Linkerd proxy natively exports Prometheus metrics for all incoming and outgoing traffic."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.15/reference/proxy-metrics/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/ selected>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2.15/overview/>Overview</a></li><li><a href=/2.15/getting-started/>Getting Started</a></li><li><a href=/2.15/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-9502176e66310dde847fdf0e0179df48>
<label class=toggle__label for=toggle-9502176e66310dde847fdf0e0179df48><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.15/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.15/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.15/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.15/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.15/features/ingress/>Ingress</a></li><li><a href=/2.15/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.15/features/load-balancing/>Load Balancing</a></li><li><a href=/2.15/features/server-policy/>Authorization Policy</a></li><li><a href=/2.15/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.15/features/cni/>CNI Plugin</a></li><li><a href=/2.15/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2.15/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.15/features/request-routing/>Dynamic Request Routing</a></li><li><a href=/2.15/features/fault-injection/>Fault Injection</a></li><li><a href=/2.15/features/ha/>High Availability</a></li><li><a href=/2.15/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2.15/features/httproute/>HTTPRoutes</a></li><li><a href=/2.15/features/nft/>Iptables-nft Support</a></li><li><a href=/2.15/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.15/features/non-kubernetes-workloads/>Non-Kubernetes workloads (mesh expansion)</a></li><li><a href=/2.15/features/service-profiles/>Service Profiles</a></li><li><a href=/2.15/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li><a href=/2.15/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-d3491daa3401b9d2bd77587482630419>
<label class=toggle__label for=toggle-d3491daa3401b9d2bd77587482630419><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.15/tasks/adding-non-kubernetes-workloads/>Adding non-Kubernetes workloads to your mesh</a></li><li><a href=/2.15/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.15/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.15/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.15/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.15/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.15/tasks/circuit-breakers/>Circuit Breakers</a></li><li><a href=/2.15/tasks/configuring-dynamic-request-routing/>Configuring Dynamic Request Routing</a></li><li><a href=/2.15/tasks/configuring-per-route-policy/>Configuring Per-Route Authorization Policy</a></li><li><a href=/2.15/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.15/tasks/configuring-proxy-discovery-cache/>Configuring Proxy Discovery Cache</a></li><li><a href=/2.15/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.15/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.15/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.15/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.15/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.15/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.15/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.15/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.15/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.15/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.15/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.15/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.15/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.15/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.15/tasks/grafana/>Grafana</a></li><li><a href=/2.15/tasks/using-ingress/>Handling ingress traffic</a></li><li><a href=/2.15/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.15/tasks/install/>Installing Linkerd</a></li><li><a href=/2.15/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.15/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.15/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.15/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.15/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.15/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.15/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.15/tasks/pod-to-pod-multicluster/>Pod-to-Pod Multi-cluster communication</a></li><li><a href=/2.15/tasks/flagger/>Progressive Delivery</a></li><li><a href=/2.15/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.15/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.15/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.15/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2.15/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.15/tasks/traffic-shifting/>Traffic Shifting</a></li><li><a href=/2.15/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.15/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.15/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.15/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.15/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.15/tasks/extensions/>Using extensions</a></li><li><a href=/2.15/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.15/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.15/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li class=docs__nav--selected><a href=/2.15/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-6c1ed631a095b70fc00aeb5c380a1fe3 checked>
<label class=toggle__label for=toggle-6c1ed631a095b70fc00aeb5c380a1fe3><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.15/reference/architecture/>Architecture</a></li><li><a href=/2.15/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.15/reference/circuit-breaking/>Circuit Breaking</a></li><li><a href=/2.15/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-bc91c7f240985a01728bf733237a9d0d>
<label class=toggle__label for=toggle-bc91c7f240985a01728bf733237a9d0d><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.15/reference/cli/authz/>authz</a></li><li><a href=/2.15/reference/cli/check/>check</a></li><li><a href=/2.15/reference/cli/completion/>completion</a></li><li><a href=/2.15/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.15/reference/cli/identity/>identity</a></li><li><a href=/2.15/reference/cli/inject/>inject</a></li><li><a href=/2.15/reference/cli/install/>install</a></li><li><a href=/2.15/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.15/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.15/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.15/reference/cli/profile/>profile</a></li><li><a href=/2.15/reference/cli/prune/>prune</a></li><li><a href=/2.15/reference/cli/uninject/>uninject</a></li><li><a href=/2.15/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.15/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.15/reference/cli/version/>version</a></li><li><a href=/2.15/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.15/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.15/reference/extension-list/>Extensions List</a></li><li><a href=/2.15/reference/external-workload/>ExternalWorkload</a></li><li><a href=/2.15/reference/httproute/>HTTPRoute</a></li><li><a href=/2.15/reference/iptables/>IPTables Reference</a></li><li><a href=/2.15/reference/multicluster/>Multi-cluster communication</a></li><li><a href=/2.15/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.15/reference/proxy-log-level/>Proxy Log Level</a></li><li class=docs__nav--selected><a href=/2.15/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.15/reference/service-profiles/>Service Profiles</a></li><li><a href=/2.15/reference/k8s-versions/>Supported Kubernetes Versions</a></li></ul></li><li><a href=/2.15/common-errors/>Common Errors
</a><input class=toggle__input type=checkbox id=toggle-70fc38683e3d1aadd6c9fc9f3235e04b>
<label class=toggle__label for=toggle-70fc38683e3d1aadd6c9fc9f3235e04b><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.15/common-errors/failfast/>Failfast</a></li><li><a href=/2.15/common-errors/http-502/>HTTP 502 Errors</a></li><li><a href=/2.15/common-errors/http-503-504/>HTTP 503 and 504 Errors</a></li><li><a href=/2.15/common-errors/protocol-detection/>Protocol Detection Errors</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Proxy Metrics</h1></div><div class="docs__content prose"><p>The Linkerd proxy exposes metrics that describe the traffic flowing through the
proxy. The following metrics are available at <code>/metrics</code> on the proxy&rsquo;s metrics
port (default: <code>:4191</code>) in the <a href=https://prometheus.io/docs/instrumenting/exposition_formats/#format-version-0.0.4 target=_blank rel=noopener>Prometheus format</a>.</p><h2 id=protocol-level-metrics class=anchor>Protocol-Level Metrics
<a href=#protocol-level-metrics class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><ul><li><p><code>request_total</code>: A counter of the number of requests the proxy has received.
This is incremented when the request stream begins.</p></li><li><p><code>response_total</code>: A counter of the number of responses the proxy has received.
This is incremented when the response stream ends.</p></li><li><p><code>response_latency_ms</code>: A histogram of response latencies. This measurement
reflects the <a href=https://en.wikipedia.org/wiki/Time_to_first_byte target=_blank rel=noopener>time-to-first-byte</a> (TTFB) by recording the elapsed time
between the proxy processing a request&rsquo;s headers and the first data frame of the
response. If a response does not include any data, the end-of-stream event is
used. The TTFB measurement is used so that Linkerd accurately reflects
application behavior when a server provides response headers immediately but is
slow to begin serving the response body.</p></li><li><p><code>route_request_total</code>, <code>route_response_latency_ms</code>, and <code>route_response_total</code>:
These metrics are analogous to <code>request_total</code>, <code>response_latency_ms</code>, and
<code>response_total</code> except that they are collected at the route level. This
means that they do not have <code>authority</code>, <code>tls</code>, <code>grpc_status_code</code> or any
outbound labels but instead they have:</p><ul><li><code>dst</code>: The authority of this request.</li><li><code>rt_route</code>: The name of the route for this request.</li></ul></li><li><p><code>control_request_total</code>, <code>control_response_latency_ms</code>, and <code>control_response_total</code>:
These metrics are analogous to <code>request_total</code>, <code>response_latency_ms</code>, and
<code>response_total</code> but for requests that the proxy makes to the Linkerd control
plane. Instead of <code>authority</code>, <code>direction</code>, or any outbound labels, instead
they have:</p><ul><li><code>addr</code>: The address used to connect to the control plane.</li></ul></li><li><p><code>inbound_http_authz_allow_total</code>: A counter of the total number of inbound
HTTP requests that were authorized.</p><ul><li><code>authz_name</code>: The name of the authorization policy used to allow the request.</li></ul></li><li><p><code>inbound_http_authz_deny_total</code>: A counter of the total number of inbound
HTTP requests that could not be processed due to being denied by the
authorization policy.</p></li><li><p><code>inbound_http_route_not_found_total</code>: A counter of the total number of
inbound HTTP requests that could not be associated with a route.</p></li></ul><p>Note that latency measurements are not exported to Prometheus until the stream
<em>completes</em>. This is necessary so that latencies can be labeled with the appropriate
<a href=#response-labels>response classification</a>.</p><h3 id=labels class=anchor>Labels
<a href=#labels class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Each of these metrics has the following labels:</p><ul><li><code>authority</code>: The value of the <code>:authority</code> (HTTP/2) or <code>Host</code> (HTTP/1.1)
header of the request.</li><li><code>direction</code>: <code>inbound</code> if the request originated from outside of the pod,
<code>outbound</code> if the request originated from inside of the pod.</li><li><code>tls</code>: <code>true</code> if the request&rsquo;s connection was secured with TLS.</li></ul><h4 id=response-labels class=anchor>Response Labels
<a href=#response-labels class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>The following labels are only applicable on <code>response_*</code> metrics.</p><ul><li><code>status_code</code>: The HTTP status code of the response.</li></ul><h4 id=response-total-labels class=anchor>Response Total Labels
<a href=#response-total-labels class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>In addition to the labels applied to all <code>response_*</code> metrics, the
<code>response_total</code>, <code>route_response_total</code>, and <code>control_response_total</code> metrics
also have the following labels:</p><ul><li><code>classification</code>: <code>success</code> if the response was successful, or <code>failure</code> if
a server error occurred. This classification is based on
the gRPC status code if one is present, and on the HTTP
status code otherwise.</li><li><code>grpc_status_code</code>: The value of the <code>grpc-status</code> trailer. Only applicable
for gRPC responses.</li></ul><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Because response classification may be determined based on the <code>grpc-status</code>
trailer (if one is present), a response may not be classified until its body
stream completes. Response latency, however, is determined based on
[time-to-first-byte][ttfb], so the <code>response_latency_ms</code> metric is recorded as
soon as data is received, rather than when the response body ends. Therefore,
the values of the <code>classification</code> and <code>grpc_status_code</code> labels are not yet
known when the <code>response_latency_ms</code> metric is recorded.</div></div><h4 id=outbound-labels class=anchor>Outbound labels
<a href=#outbound-labels class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>The following labels are only applicable if <code>direction=outbound</code>.</p><ul><li><code>dst_deployment</code>: The deployment to which this request is being sent.</li><li><code>dst_k8s_job</code>: The job to which this request is being sent.</li><li><code>dst_replicaset</code>: The replica set to which this request is being sent.</li><li><code>dst_daemonset</code>: The daemon set to which this request is being sent.</li><li><code>dst_statefulset</code>: The stateful set to which this request is being sent.</li><li><code>dst_replicationcontroller</code>: The replication controller to which this request
is being sent.</li><li><code>dst_namespace</code>: The namespace to which this request is being sent.</li><li><code>dst_service</code>: The service to which this request is being sent.</li><li><code>dst_pod_template_hash</code>: The <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#pod-template-hash-label target=_blank rel=noopener>pod-template-hash</a> of the pod
to which this request is being sent. This label
selector roughly approximates a pod&rsquo;s <code>ReplicaSet</code> or
<code>ReplicationController</code>.</li></ul><h4 id=prometheus-collector-labels class=anchor>Prometheus Collector labels
<a href=#prometheus-collector-labels class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>The following labels are added by the Prometheus collector.</p><ul><li><code>instance</code>: ip:port of the pod.</li><li><code>job</code>: The Prometheus job responsible for the collection, typically
<code>linkerd-proxy</code>.</li></ul><h5 id=kubernetes-labels-added-at-collection-time class=anchor>Kubernetes labels added at collection time
<a href=#kubernetes-labels-added-at-collection-time class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>Kubernetes namespace, pod name, and all labels are mapped to corresponding
Prometheus labels.</p><ul><li><code>namespace</code>: Kubernetes namespace that the pod belongs to.</li><li><code>pod</code>: Kubernetes pod name.</li><li><code>pod_template_hash</code>: Corresponds to the <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#pod-template-hash-label target=_blank rel=noopener>pod-template-hash</a>
Kubernetes label. This value changes during redeploys and
rolling restarts. This label selector roughly
approximates a pod&rsquo;s <code>ReplicaSet</code> or
<code>ReplicationController</code>.</li></ul><h5 id=linkerd-labels-added-at-collection-time class=anchor>Linkerd labels added at collection time
<a href=#linkerd-labels-added-at-collection-time class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>Kubernetes labels prefixed with <code>linkerd.io/</code> are added to your application at
<code>linkerd inject</code> time. More specifically, Kubernetes labels prefixed with
<code>linkerd.io/proxy-*</code> will correspond to these Prometheus labels:</p><ul><li><code>daemonset</code>: The daemon set that the pod belongs to (if applicable).</li><li><code>deployment</code>: The deployment that the pod belongs to (if applicable).</li><li><code>k8s_job</code>: The job that the pod belongs to (if applicable).</li><li><code>replicaset</code>: The replica set that the pod belongs to (if applicable).</li><li><code>replicationcontroller</code>: The replication controller that the pod belongs to
(if applicable).</li><li><code>statefulset</code>: The stateful set that the pod belongs to (if applicable).</li></ul><h3 id=example class=anchor>Example
<a href=#example class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Here&rsquo;s a concrete example, given the following pod snippet:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>vote-bot-5b7f5657f6-xbjjw</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emojivoto</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>labels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>vote-bot</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>linkerd.io/control-plane-ns</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>linkerd</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>linkerd.io/proxy-deployment</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>vote-bot</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>pod-template-hash</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;3957278789&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>test</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>vote-bot-test</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>The resulting Prometheus labels will look like this:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>request_total<span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>pod</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;vote-bot-5b7f5657f6-xbjjw&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>namespace</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;emojivoto&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>app</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;vote-bot&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>control_plane_ns</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;linkerd&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>deployment</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;vote-bot&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>pod_template_hash</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;3957278789&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>test</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;vote-bot-test&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>instance</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;10.1.3.93:4191&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#79c0ff>job</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;linkerd-proxy&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=transport-level-metrics class=anchor>Transport-Level Metrics
<a href=#transport-level-metrics class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The following metrics are collected at the level of the underlying transport
layer.</p><ul><li><code>tcp_open_total</code>: A counter of the total number of opened transport
connections.</li><li><code>tcp_close_total</code>: A counter of the total number of transport connections
which have closed.</li><li><code>tcp_open_connections</code>: A gauge of the number of transport connections
currently open.</li><li><code>tcp_write_bytes_total</code>: A counter of the total number of sent bytes. This is
updated when the connection closes.</li><li><code>tcp_read_bytes_total</code>: A counter of the total number of received bytes. This
is updated when the connection closes.</li><li><code>tcp_connection_duration_ms</code>: A histogram of the duration of the lifetime of a
connection, in milliseconds. This is updated when the connection closes.</li><li><code>inbound_tcp_errors_total</code>: A counter of the total number of inbound TCP
connections that could not be processed due to a proxy error.</li><li><code>outbound_tcp_errors_total</code>: A counter of the total number of outbound TCP
connections that could not be processed due to a proxy error.</li><li><code>inbound_tcp_authz_allow_total</code>: A counter of the total number of TCP
connections that were authorized.</li><li><code>inbound_tcp_authz_deny_total</code>: A counter of the total number of TCP
connections that were denied</li></ul><h3 id=labels-1 class=anchor>Labels
<a href=#labels-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Each of these metrics has the following labels:</p><ul><li><code>direction</code>: <code>inbound</code> if the connection was established either from outside the
pod to the proxy, or from the proxy to the application,
<code>outbound</code> if the connection was established either from the
application to the proxy, or from the proxy to outside the pod.</li><li><code>peer</code>: <code>src</code> if the connection was accepted by the proxy from the source,
<code>dst</code> if the connection was opened by the proxy to the destination.</li></ul><p>Note that the labels described above under the heading &ldquo;Prometheus Collector labels&rdquo;
are also added to transport-level metrics, when applicable.</p><h4 id=connection-close-labels class=anchor>Connection Close Labels
<a href=#connection-close-labels class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>The following labels are added only to metrics which are updated when a
connection closes (<code>tcp_close_total</code> and <code>tcp_connection_duration_ms</code>):</p><ul><li><code>classification</code>: <code>success</code> if the connection terminated cleanly, <code>failure</code> if
the connection closed due to a connection failure.</li></ul><h2 id=identity-metrics class=anchor>Identity Metrics
<a href=#identity-metrics class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><ul><li><code>identity_cert_expiration_timestamp_seconds</code>: A gauge of the time when the
proxy&rsquo;s current mTLS identity certificate will expire (in seconds since the UNIX
epoch).</li><li><code>identity_cert_refresh_count</code>: A counter of the total number of times the
proxy&rsquo;s mTLS identity certificate has been refreshed by the Identity service.</li></ul><h2 id=outbound-xroute-metrics class=anchor>Outbound <code>xRoute</code> Metrics
<a href=#outbound-xroute-metrics class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>When performing policy-based routing, proxies may dispatch requests through
per-route backend configurations. In order to record how routing rules
apply and how backend distributions are applied, the outbound proxy records the
following metrics:</p><ul><li><code>outbound_http_route_backend_requests_total</code>: A counter of the total number of
outbound HTTP requests dispatched to a route-backend.</li><li><code>outbound_grpc_route_backend_requests_total</code>: A counter of the total number of
outbound gRPC requests dispatched to a route-backend.</li><li><code>outbound_http_balancer_endpoints</code>: A gauge of the number of endpoints in an
outbound load balancer.</li></ul><h3 id=labels-2 class=anchor>Labels
<a href=#labels-2 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Each of these metrics has the following common labels, which describe the
Kubernetes resources to which traffic is routed by the proxy:</p><ul><li><code>parent_group</code>, <code>parent_kind</code>, <code>parent_name</code>, and <code>parent_namespace</code> reference
the parent resource through which the proxy discovered the route binding.
The parent resource of an <a href=../../features/httproute/>HTTPRoute</a> is generally a Service.</li><li><code>route_group</code>, <code>route_kind</code>, <code>route_name</code>, and <code>route_namespace</code> reference the
route resource through which the proxy discovered the route binding. This will
either reference an <a href=../../features/httproute/>HTTPRoute</a> resource or a default (synthesized) route.</li><li><code>backend_group</code>, <code>backend_kind</code>, <code>backend_name</code>, and <code>backend_namespace</code>
reference the backend resource to which which the proxy routed the request.
This will always be a Service.</li></ul><p>In addition, the <code>outbound_http_balancer_endpoints</code> gauge metric adds the
following labels:</p><ul><li><p><code>endpoint_state</code>: Either &ldquo;ready&rdquo; if the endpoint is available to have requests
routed to it by the load balancer, or &ldquo;pending&rdquo; if the endpoint is currently
unavailable.</p><p>Endpoints may be &ldquo;pending&rdquo; when a connection is being established (or
reestablished), or when the endpoint has been <a href=../circuit-breaking/>made unavailable by failure
accrual</a>.</p></li></ul></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>