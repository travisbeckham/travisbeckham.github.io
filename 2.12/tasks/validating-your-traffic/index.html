<!doctype html><html lang=en><head><meta charset=utf-8><title>Validating your mTLS traffic | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="You can validate whether or not your traffic is being mTLS'd by Linkerd."><meta property="og:url" content="https://travisbeckham.github.io/2.12/tasks/validating-your-traffic/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Validating your mTLS traffic"><meta property="og:description" content="You can validate whether or not your traffic is being mTLS'd by Linkerd."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.12"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Validating your mTLS traffic"><meta name=twitter:description content="You can validate whether or not your traffic is being mTLS'd by Linkerd."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.12/tasks/validating-your-traffic/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=/community/heroes/>Linkerd Heroes</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/ selected>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option><option value=/2.9/>Linkerd 2.9</option></select></div><nav><ul><li><a href=/2.12/overview/>Overview</a></li><li><a href=/2.12/getting-started/>Getting Started</a></li><li><a href=/2.12/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-451debf55674ca42b496c251f32b1e24>
<label class=toggle__label for=toggle-451debf55674ca42b496c251f32b1e24><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.12/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.12/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.12/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.12/features/ingress/>Ingress</a></li><li><a href=/2.12/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.12/features/load-balancing/>Load Balancing</a></li><li><a href=/2.12/features/server-policy/>Authorization Policy</a></li><li><a href=/2.12/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.12/features/cni/>CNI Plugin</a></li><li><a href=/2.12/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2.12/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.12/features/fault-injection/>Fault Injection</a></li><li><a href=/2.12/features/ha/>High Availability</a></li><li><a href=/2.12/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2.12/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.12/features/nft/>Proxy Init Iptables Modes</a></li><li><a href=/2.12/features/service-profiles/>Service Profiles</a></li><li><a href=/2.12/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.12/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-bd74b9215cf78dd6fa457943dd02a886 checked>
<label class=toggle__label for=toggle-bd74b9215cf78dd6fa457943dd02a886><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.12/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.12/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.12/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.12/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.12/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.12/tasks/configuring-per-route-policy/>Configuring Per-Route Policy</a></li><li><a href=/2.12/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.12/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.12/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.12/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.12/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.12/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.12/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.12/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.12/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.12/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.12/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.12/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.12/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.12/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.12/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.12/tasks/grafana/>Grafana</a></li><li><a href=/2.12/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.12/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.12/tasks/install/>Installing Linkerd</a></li><li><a href=/2.12/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.12/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.12/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.12/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.12/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.12/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.12/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.12/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.12/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.12/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.12/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2.12/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.12/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.12/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.12/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.12/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.12/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.12/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.12/tasks/extensions/>Using extensions</a></li><li><a href=/2.12/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.12/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li class=docs__nav--selected><a href=/2.12/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.12/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-b8c7e85e215b478062e7a8ddd5fba4c9>
<label class=toggle__label for=toggle-b8c7e85e215b478062e7a8ddd5fba4c9><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/reference/architecture/>Architecture</a></li><li><a href=/2.12/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.12/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-54b83bb178e9cf628a47c1558b11db07>
<label class=toggle__label for=toggle-54b83bb178e9cf628a47c1558b11db07><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/reference/cli/authz/>authz</a></li><li><a href=/2.12/reference/cli/check/>check</a></li><li><a href=/2.12/reference/cli/completion/>completion</a></li><li><a href=/2.12/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.12/reference/cli/identity/>identity</a></li><li><a href=/2.12/reference/cli/inject/>inject</a></li><li><a href=/2.12/reference/cli/install/>install</a></li><li><a href=/2.12/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.12/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.12/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.12/reference/cli/profile/>profile</a></li><li><a href=/2.12/reference/cli/uninject/>uninject</a></li><li><a href=/2.12/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.12/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.12/reference/cli/version/>version</a></li><li><a href=/2.12/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.12/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.12/reference/extension-list/>Extensions List</a></li><li><a href=/2.12/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.12/reference/iptables/>IPTables Reference</a></li><li><a href=/2.12/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.12/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.12/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.12/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Validating your mTLS traffic</h1></div><div class="docs__content prose"><p>By default, <a href=../../features/automatic-mtls/>Linkerd automatically enables mutual Transport Layer Security
(mTLS)</a> for TCP traffic between meshed pods, by
establishing and authenticating secure, private TLS connections between Linkerd
proxies. Simply <a href=../adding-your-service/>add your services</a> to Linkerd,
and Linkerd will take care of the rest.</p><p>Linkerd&rsquo;s automatic mTLS is done in a way that&rsquo;s completely transparent to
the application. Of course, sometimes it&rsquo;s helpful to be able to validate
whether mTLS is in effect!</p><h2 id=validating-mtls-with-linkerd-viz-edges class=anchor>Validating mTLS with <code>linkerd viz edges</code>
<a href=#validating-mtls-with-linkerd-viz-edges class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>To validate that mTLS is working, you can view a summary of the TCP
connections between services that are managed by Linkerd using the <a href=../../reference/cli/viz/#edges><code>linkerd viz edges</code></a> command. For example:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz -n linkerd edges deployment
</span></span></code></pre></div><p>The output will look like:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SRC          DST                      SRC_NS        DST_NS    SECURED
</span></span><span style=display:flex><span>prometheus   linkerd-controller       linkerd-viz   linkerd   √
</span></span><span style=display:flex><span>prometheus   linkerd-destination      linkerd-viz   linkerd   √
</span></span><span style=display:flex><span>prometheus   linkerd-identity         linkerd-viz   linkerd   √
</span></span><span style=display:flex><span>prometheus   linkerd-proxy-injector   linkerd-viz   linkerd   √
</span></span><span style=display:flex><span>prometheus   linkerd-sp-validator     linkerd-viz   linkerd   √
</span></span></code></pre></div><p>In this example, everything is successfully mTLS&rsquo;d, and the <code>CLIENT</code> and
<code>SERVER</code> columns denote the identities used, in the form
<code>service-account-name.namespace</code>. (See <a href=../../features/automatic-mtls/>Linkerd&rsquo;s automatic mTLS
documentation</a> for more on what these identities
mean.) If there were a problem automatically upgrading the connection with
mTLS, the <code>MSG</code> field would contain the reason why.</p><h2 id=validating-mtls-with-linkerd-viz-tap class=anchor>Validating mTLS with <code>linkerd viz tap</code>
<a href=#validating-mtls-with-linkerd-viz-tap class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Instead of relying on an aggregate, it is also possible to watch the requests
and responses in real time to understand what is getting mTLS&rsquo;d. We can use the
<a href=../../reference/cli/viz/#tap><code>linkerd viz tap</code> command</a> to sample real time
request data.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz -n linkerd tap deploy
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>By default, the control plane resources are not tappable. After having
installed the Viz extension (through <code>linkerd viz install</code>), you can enable tap
on the control plane components simply by restarting them, which can be done
with no downtime with <code>kubectl -n linkerd rollout restart deploy</code>. To enable tap
on the Viz extension itself, issue <code>kubectl -n linkerd-viz rollout restart deploy</code>.</div></div><p>Looking at the control plane specifically, there will be two main types of output.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.1:60318 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.23:9995 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>no_tls_from_remote :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>10.42.0.23:9995 :path<span style=color:#ff7b72;font-weight:700>=</span>/ready
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.1:60318 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.23:9995 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>no_tls_from_remote :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>267µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.1:60318 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.23:9995 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>no_tls_from_remote <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>20µs response-length<span style=color:#ff7b72;font-weight:700>=</span>3B
</span></span></code></pre></div><p>These are calls by the <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/ target=_blank rel=noopener>Kubernetes readiness
probe</a>.
As probes are initiated from the kubelet, which is not in the mesh, there is no
identity and these requests are not mTLS&rsquo;d, as denoted by the
<code>tls=no_tls_from_remote</code> message.</p><p>Other requests to the control plane <em>are</em> TLS&rsquo;d:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ireq <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>2:1 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.31:55428 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.22:9995 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>10.42.0.22:9995 :path<span style=color:#ff7b72;font-weight:700>=</span>/metrics
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>2:1 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.31:55428 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.22:9995 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>1597µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>2:1 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.31:55428 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.42.0.22:9995 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>228µs response-length<span style=color:#ff7b72;font-weight:700>=</span>2272B
</span></span></code></pre></div><p>This connection comes from Prometheus, which in the mesh, so the request is
automatically mTLS&rsquo;d, as denoted by the <code>tls=true</code> output.</p><h2 id=validating-mtls-with-tshark class=anchor>Validating mTLS with tshark
<a href=#validating-mtls-with-tshark class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The final way to validate mTLS is to look at raw network traffic within the
cluster.</p><p>Linkerd includes a <a href=../using-the-debug-container/>debug sidecar</a> that
comes with a selection of commands that make it easier to verify and debug the
service mesh itself. For example, with our <a href=../../getting-started/><em>emojivoto</em> demo
application</a>, we can add the debug sidecar by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/emojivoto.yml <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | linkerd inject --enable-debug-sidecar - <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | kubectl apply -f -
</span></span></code></pre></div><p>We can then establish a remote shell directly in the debug container of a pod in
the <code>voting</code> service with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n emojivoto exec -it <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    <span style=color:#ff7b72>$(</span>kubectl -n emojivoto get po -o name | grep voting<span style=color:#ff7b72>)</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -c linkerd-debug -- /bin/bash
</span></span></code></pre></div><p>Once we&rsquo;re inside the debug sidecar, the built-in <code>tshark</code> command can be used
to inspect the raw packets on the network interface. For example:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tshark -i any -d tcp.port<span style=color:#ff7b72;font-weight:700>==</span>8080,ssl | grep -v 127.0.0.1
</span></span></code></pre></div><p>This tells <code>tshark</code> that port 8080 might be TLS&rsquo;d, and to ignore localhost (as
that traffic will always be unencrypted). The output will show the primary
application traffic being automatically mTLS&rsquo;d.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#a5d6ff>133</span> 11.391540872    10.4.0.17 → 10.4.0.23    TCP <span style=color:#a5d6ff>68</span> <span style=color:#a5d6ff>46766</span> → <span style=color:#a5d6ff>4191</span> <span style=color:#ff7b72;font-weight:700>[</span>ACK<span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#79c0ff>Seq</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>557</span> <span style=color:#79c0ff>Ack</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3942</span> <span style=color:#79c0ff>Win</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1329</span> <span style=color:#79c0ff>Len</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span> <span style=color:#79c0ff>TSval</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>3389590636</span> <span style=color:#79c0ff>TSecr</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1915605020</span>
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>134</span> 12.128190076    10.4.0.25 → 10.4.0.23    TLSv1.2 <span style=color:#a5d6ff>154</span> Application Data
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>140</span> 12.129497053    10.4.0.23 → 10.4.0.25    TLSv1.2 <span style=color:#a5d6ff>149</span> Application Data
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>141</span> 12.129534848    10.4.0.25 → 10.4.0.23    TCP <span style=color:#a5d6ff>68</span> <span style=color:#a5d6ff>48138</span> → <span style=color:#a5d6ff>8080</span> <span style=color:#ff7b72;font-weight:700>[</span>ACK<span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#79c0ff>Seq</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>1089</span> <span style=color:#79c0ff>Ack</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>985</span> <span style=color:#79c0ff>Win</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>236</span> <span style=color:#79c0ff>Len</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>0</span> <span style=color:#79c0ff>TSval</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>2234109459</span> <span style=color:#79c0ff>TSecr</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>617799816</span>
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>143</span> 13.140288400    10.4.0.25 → 10.4.0.23    TLSv1.2 <span style=color:#a5d6ff>150</span> Application Data
</span></span><span style=display:flex><span>  <span style=color:#a5d6ff>148</span> 13.141219945    10.4.0.23 → 10.4.0.25    TLSv1.2 <span style=color:#a5d6ff>136</span> Application Data
</span></span></code></pre></div><h2 id=summary class=anchor>Summary
<a href=#summary class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>In this guide, we&rsquo;ve provided several different ways to validate whether
Linkerd has been able to automatically upgrade connections to mTLS. Note that
there are several reasons why Linkerd may not be able to do this upgrade&mdash;see
the &ldquo;Caveats and future work&rdquo; section of the <a href=../../features/automatic-mtls/>Linkerd automatic mTLS
documentation</a>&mdash;so if you are relying on Linkerd
for security purposes, this kind of validation can be instructive.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>