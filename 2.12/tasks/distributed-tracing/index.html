<!doctype html><html lang=en><head><meta charset=utf-8><title>Distributed tracing with Linkerd | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Use Linkerd to help instrument your application with distributed tracing."><meta property="og:url" content="https://travisbeckham.github.io/2.12/tasks/distributed-tracing/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Distributed tracing with Linkerd"><meta property="og:description" content="Use Linkerd to help instrument your application with distributed tracing."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.12"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Distributed tracing with Linkerd"><meta name=twitter:description content="Use Linkerd to help instrument your application with distributed tracing."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.12/tasks/distributed-tracing/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/ selected>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2.12/overview/>Overview</a></li><li><a href=/2.12/getting-started/>Getting Started</a></li><li><a href=/2.12/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-451debf55674ca42b496c251f32b1e24>
<label class=toggle__label for=toggle-451debf55674ca42b496c251f32b1e24><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.12/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.12/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.12/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.12/features/ingress/>Ingress</a></li><li><a href=/2.12/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.12/features/load-balancing/>Load Balancing</a></li><li><a href=/2.12/features/server-policy/>Authorization Policy</a></li><li><a href=/2.12/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.12/features/cni/>CNI Plugin</a></li><li><a href=/2.12/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2.12/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.12/features/fault-injection/>Fault Injection</a></li><li><a href=/2.12/features/ha/>High Availability</a></li><li><a href=/2.12/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2.12/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.12/features/nft/>Proxy Init Iptables Modes</a></li><li><a href=/2.12/features/service-profiles/>Service Profiles</a></li><li><a href=/2.12/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.12/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-bd74b9215cf78dd6fa457943dd02a886 checked>
<label class=toggle__label for=toggle-bd74b9215cf78dd6fa457943dd02a886><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.12/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.12/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.12/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.12/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.12/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.12/tasks/configuring-per-route-policy/>Configuring Per-Route Policy</a></li><li><a href=/2.12/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.12/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.12/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.12/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.12/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.12/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.12/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.12/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li class=docs__nav--selected><a href=/2.12/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.12/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.12/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.12/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.12/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.12/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.12/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.12/tasks/grafana/>Grafana</a></li><li><a href=/2.12/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.12/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.12/tasks/install/>Installing Linkerd</a></li><li><a href=/2.12/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.12/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.12/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.12/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.12/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.12/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.12/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.12/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.12/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.12/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.12/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2.12/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.12/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.12/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.12/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.12/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.12/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.12/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.12/tasks/extensions/>Using extensions</a></li><li><a href=/2.12/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.12/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.12/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.12/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-b8c7e85e215b478062e7a8ddd5fba4c9>
<label class=toggle__label for=toggle-b8c7e85e215b478062e7a8ddd5fba4c9><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/reference/architecture/>Architecture</a></li><li><a href=/2.12/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.12/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-54b83bb178e9cf628a47c1558b11db07>
<label class=toggle__label for=toggle-54b83bb178e9cf628a47c1558b11db07><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.12/reference/cli/authz/>authz</a></li><li><a href=/2.12/reference/cli/check/>check</a></li><li><a href=/2.12/reference/cli/completion/>completion</a></li><li><a href=/2.12/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.12/reference/cli/identity/>identity</a></li><li><a href=/2.12/reference/cli/inject/>inject</a></li><li><a href=/2.12/reference/cli/install/>install</a></li><li><a href=/2.12/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.12/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.12/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.12/reference/cli/profile/>profile</a></li><li><a href=/2.12/reference/cli/uninject/>uninject</a></li><li><a href=/2.12/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.12/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.12/reference/cli/version/>version</a></li><li><a href=/2.12/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.12/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.12/reference/extension-list/>Extensions List</a></li><li><a href=/2.12/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.12/reference/iptables/>IPTables Reference</a></li><li><a href=/2.12/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.12/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.12/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.12/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Distributed tracing with Linkerd</h1></div><div class="docs__content prose"><p>Using distributed tracing in practice can be complex, for a high level
explanation of what you get and how it is done, we&rsquo;ve assembled a <a href=https://linkerd.io/2019/08/09/service-mesh-distributed-tracing-myths/ target=_blank rel=noopener>list of
myths</a>.</p><p>This guide will walk you through configuring and enabling tracing for
<a href=../../getting-started/#step-5-install-the-demo-app>emojivoto</a>. Jump to the end
for some recommendations on the best way to make use of distributed tracing with
Linkerd.</p><p>To use distributed tracing, you&rsquo;ll need to:</p><ul><li>Install the Linkerd-Jaeger extension.</li><li>Modify your application to emit spans.</li></ul><p>In the case of emojivoto, once all these steps are complete there will be a
topology that looks like:</p><figure><img alt=Topology class="img img--max-fill img--center img--rounded" src=/docs/images/tracing/tracing-topology.svg><figcaption>Topology</figcaption></figure><h2 id=prerequisites class=anchor>Prerequisites
<a href=#prerequisites class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><ul><li>To use this guide, you&rsquo;ll need to have Linkerd installed on your cluster.
Follow the <a href=../install/>Installing Linkerd Guide</a> if you haven&rsquo;t
already done this.</li></ul><h2 id=install-the-linkerd-jaeger-extension class=anchor>Install the Linkerd-Jaeger extension
<a href=#install-the-linkerd-jaeger-extension class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The first step of getting distributed tracing setup is installing the
Linkerd-Jaeger extension onto your cluster. This extension consists of a
collector, a Jaeger backend, and a Jaeger-injector. The collector consumes spans
emitted from the mesh and your applications and sends them to the Jaeger backend
which stores them and serves a dashboard to view them. The Jaeger-injector is
responsible for configuring the Linkerd proxies to emit spans.</p><p>To install the Linkerd-Jaeger extension, run the command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd jaeger install | kubectl apply -f -
</span></span></code></pre></div><p>You can verify that the Linkerd-Jaeger extension was installed correctly by
running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd jaeger check
</span></span></code></pre></div><h2 id=install-emojivoto class=anchor>Install Emojivoto
<a href=#install-emojivoto class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Add emojivoto to your cluster and inject it with the Linkerd proxy:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd inject https://run.linkerd.io/emojivoto.yml | kubectl apply -f -
</span></span></code></pre></div><p>Before moving onto the next step, make sure everything is up and running with
<code>kubectl</code>:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n emojivoto rollout status deploy/web
</span></span></code></pre></div><h2 id=modify-the-application class=anchor>Modify the application
<a href=#modify-the-application class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Unlike most features of a service mesh, distributed tracing requires modifying
the source of your application. Tracing needs some way to tie incoming requests
to your application together with outgoing requests to dependent services. To do
this, some headers are added to each request that contain a unique ID for the
trace. Linkerd uses the <a href=https://github.com/openzipkin/b3-propagation target=_blank rel=noopener>b3
propagation</a> format to tie these
things together.</p><p>We&rsquo;ve already modified emojivoto to instrument its requests with this
information, this
<a href=https://github.com/BuoyantIO/emojivoto/commit/47a026c2e4085f4e536c2735f3ff3788b0870072 target=_blank rel=noopener>commit</a>
shows how this was done. For most programming languages, it simply requires the
addition of a client library to take care of this. Emojivoto uses the OpenCensus
client, but others can be used.</p><p>To enable tracing in emojivoto, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n emojivoto set env --all deploy <span style=color:#79c0ff>OC_AGENT_HOST</span><span style=color:#ff7b72;font-weight:700>=</span>collector.linkerd-jaeger:55678
</span></span></code></pre></div><p>This command will add an environment variable that enables the applications to
propagate context and emit spans.</p><h2 id=explore-jaeger class=anchor>Explore Jaeger
<a href=#explore-jaeger class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>With <code>vote-bot</code> starting traces for every request, spans should now be showing
up in Jaeger. To get to the UI, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd jaeger dashboard
</span></span></code></pre></div><figure><img alt=Jaeger class="img img--max-fill img--center img--rounded" src=/docs/images/tracing/jaeger-empty.png><figcaption>Jaeger</figcaption></figure><p>You can search for any service in the dropdown and click Find Traces. <code>vote-bot</code>
is a great way to get started.</p><figure><img alt=Search class="img img--max-fill img--center img--rounded" src=/docs/images/tracing/jaeger-search.png><figcaption>Search</figcaption></figure><p>Clicking on a specific trace will provide all the details, you&rsquo;ll be able to see
the spans for every proxy!</p><figure><img alt=Search class="img img--max-fill img--center img--rounded" src=/docs/images/tracing/example-trace.png><figcaption>Search</figcaption></figure><p>There sure are a lot of <code>linkerd-proxy</code> spans in that output. Internally, the
proxy has a server and client side. When a request goes through the proxy, it is
received by the server and then issued by the client. For a single request that
goes between two meshed pods, there will be a total of 4 spans. Two will be on
the source side as the request traverses that proxy and two will be on the
destination side as the request is received by the remote proxy.</p><h2 id=integration-with-the-dashboard class=anchor>Integration with the Dashboard
<a href=#integration-with-the-dashboard class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>After having set up the Linkerd-Jaeger extension, as the proxy adds application
meta-data as trace attributes, users can directly jump into related resources
traces directly from the linkerd-web dashboard by clicking the Jaeger icon in
the Metrics Table, as shown below:</p><figure><img alt=Linkerd-Jaeger class="img img--max-fill img--center img--rounded" src=/docs/images/tracing/linkerd-jaeger-ui.png><figcaption>Linkerd-Jaeger</figcaption></figure><p>To obtain that functionality you need to install (or upgrade) the Linkerd-Viz
extension specifying the service exposing the Jaeger UI. By default, this would
be something like this:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz install --set <span style=color:#79c0ff>jaegerUrl</span><span style=color:#ff7b72;font-weight:700>=</span>jaeger.linkerd-jaeger:16686
</span></span></code></pre></div><h2 id=cleanup class=anchor>Cleanup
<a href=#cleanup class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>To cleanup, uninstall the Linkerd-Jaeger extension along with emojivoto by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd jaeger uninstall | kubectl delete -f -
</span></span><span style=display:flex><span>kubectl delete ns emojivoto
</span></span></code></pre></div><h2 id=bring-your-own-jaeger class=anchor>Bring your own Jaeger
<a href=#bring-your-own-jaeger class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If you have an existing Jaeger installation, you can configure the OpenCensus
collector to send traces to it instead of the Jaeger instance built into the
Linkerd-Jaeger extension.</p><p>Create the following YAML file which disables the built in Jaeger instance
and specifies the OpenCensus collector&rsquo;s config.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#a5d6ff>&lt;&lt;EOF &gt; jaeger-linkerd.yaml
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>jaeger:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  enabled: false
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>collector:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  config: |
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    receivers:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      otlp:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        protocols:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          grpc:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          http:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      opencensus:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      zipkin:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      jaeger:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        protocols:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          grpc:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          thrift_http:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          thrift_compact:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          thrift_binary:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    processors:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      batch:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    extensions:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      health_check:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    exporters:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      jaeger:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        endpoint: my-jaeger-collector.my-jaeger-ns:14250
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        insecure: true
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    service:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      extensions: [health_check]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>      pipelines:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        traces:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          receivers: [otlp,opencensus,zipkin,jaeger]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          processors: [batch]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>          exporters: [jaeger]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>EOF</span>
</span></span><span style=display:flex><span>linkerd jaeger install --values ./jaeger-linkerd.yaml | kubectl apply -f -
</span></span></code></pre></div><p>You&rsquo;ll want to ensure that the <code>exporters.jaeger.endpoint</code> which is
<code>my-jaeger-collector.my-jaeger-ns:14250</code> in this example is set to a value
appropriate for your environment. This should point to a Jaeger Collector
on port 14250.</p><p>The YAML file is merged with the <a href=https://github.com/linkerd/linkerd2/blob/main/jaeger/charts/linkerd-jaeger/values.yaml target=_blank rel=noopener>Helm values.yaml</a> which shows
other possible values that can be configured.</p><p>It is also possible to manually edit the OpenCensus configuration to have it
export to any backend which it supports. See the
<a href=https://opencensus.io/service/exporters/ target=_blank rel=noopener>OpenCensus documentation</a> for a full
list.</p><h2 id=troubleshooting class=anchor>Troubleshooting
<a href=#troubleshooting class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=i-dont-see-any-spans-for-the-proxies class=anchor>I don&rsquo;t see any spans for the proxies
<a href=#i-dont-see-any-spans-for-the-proxies class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>The Linkerd proxy uses the <a href=https://github.com/openzipkin/b3-propagation target=_blank rel=noopener>b3
propagation</a> format. Some client
libraries, such as Jaeger, use different formats by default. You&rsquo;ll want to
configure your client library to use the b3 format to have the proxies
participate in traces.</p><h2 id=recommendations class=anchor>Recommendations
<a href=#recommendations class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=ingress class=anchor>Ingress
<a href=#ingress class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>The ingress is an especially important component for distributed tracing because
it typically creates the root span of each trace and is responsible for deciding
if that trace should be sampled or not. Having the ingress make all sampling
decisions ensures that either an entire trace is sampled or none of it is, and
avoids creating &ldquo;partial traces&rdquo;.</p><p>Distributed tracing systems all rely on services to propagate metadata about the
current trace from requests that they receive to requests that they send. This
metadata, called the trace context, is usually encoded in one or more request
headers. There are many different trace context header formats and while we hope
that the ecosystem will eventually converge on open standards like <a href=https://www.w3.org/TR/trace-context/ target=_blank rel=noopener>W3C
tracecontext</a>, we only use the <a href=https://github.com/openzipkin/b3-propagation target=_blank rel=noopener>b3
format</a> today. Being one of the
earliest widely used formats, it has the widest support, especially among
ingresses like Nginx.</p><p>This reference architecture uses a traffic generator called <code>vote-bot</code> instead
of an ingress to create the root span of each trace.</p><h3 id=client-library class=anchor>Client Library
<a href=#client-library class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>While it is possible for services to manually propagate trace propagation
headers, it&rsquo;s usually much easier to use a library which does three things:</p><ul><li>Propagates the trace context from incoming request headers to outgoing request
headers</li><li>Modifies the trace context (i.e. starts a new span)</li><li>Transmits this data to a trace collector</li></ul><p>We recommend using OpenCensus in your service and configuring it with:</p><ul><li><a href=https://github.com/openzipkin/b3-propagation target=_blank rel=noopener>b3 propagation</a> (this is the
default)</li><li><a href=https://opencensus.io/exporters/supported-exporters/go/ocagent/ target=_blank rel=noopener>the OpenCensus agent
exporter</a></li></ul><p>The OpenCensus agent exporter will export trace data to the OpenCensus collector
over a gRPC API. The details of how to configure OpenCensus will vary language
by language, but there are <a href=https://opencensus.io/quickstart/ target=_blank rel=noopener>guides for many popular
languages</a>. You can also see an end-to-end
example of this in Go with our example application,
<a href=https://github.com/adleong/emojivoto target=_blank rel=noopener>Emojivoto</a>.</p><p>You may notice that the OpenCensus project is in maintenance mode and will
become part of <a href=https://opentelemetry.io/ target=_blank rel=noopener>OpenTelemetry</a>. Unfortunately,
OpenTelemetry is not yet production ready and so OpenCensus remains our
recommendation for the moment.</p><p>It is possible to use many other tracing client libraries as well. Just make
sure the b3 propagation format is being used and the client library can export
its spans in a format the collector has been configured to receive.</p><h2 id=collector-opencensus class=anchor>Collector: OpenCensus
<a href=#collector-opencensus class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The OpenCensus collector receives trace data from the OpenCensus agent exporter
and potentially does translation and filtering before sending that data to
Jaeger. Having the OpenCensus exporter send to the OpenCensus collector gives us
a lot of flexibility: we can switch to any backend that OpenCensus supports
without needing to interrupt the application.</p><h2 id=backend-jaeger class=anchor>Backend: Jaeger
<a href=#backend-jaeger class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Jaeger is one of the most widely used tracing backends and for good reason: it
is easy to use and does a great job of visualizing traces. However, <a href=https://opencensus.io/service/exporters/ target=_blank rel=noopener>any backend
supported by OpenCensus</a> can be used
instead.</p><h2 id=linkerd class=anchor>Linkerd
<a href=#linkerd class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If your application is injected with Linkerd, the Linkerd proxy will participate
in the traces and will also emit trace data to the OpenCensus collector. This
enriches the trace data and allows you to see exactly how much time requests are
spending in the proxy and on the wire.</p><p>While Linkerd can only actively participate in traces that use the b3
propagation format, Linkerd will always forward unknown request headers
transparently, which means it will never interfere with traces that use other
propagation formats.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>