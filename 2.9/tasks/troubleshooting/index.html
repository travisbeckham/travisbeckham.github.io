<!doctype html><html lang=en><head><meta charset=utf-8><title>Troubleshooting | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Troubleshoot issues with your Linkerd installation."><meta property="og:url" content="https://travisbeckham.github.io/2.9/tasks/troubleshooting/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Troubleshooting"><meta property="og:description" content="Troubleshoot issues with your Linkerd installation."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.9"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Troubleshooting"><meta name=twitter:description content="Troubleshoot issues with your Linkerd installation."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.9/tasks/troubleshooting/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=/community/heroes/>Linkerd Heroes</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option><option value=/2.9/ selected>Linkerd 2.9</option></select></div><nav><ul><li><a href=/2.9/overview/>Overview</a></li><li><a href=/2.9/getting-started/>Getting Started</a></li><li><a href=/2.9/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-e4cde74e0b82591bbb113b641faed73d>
<label class=toggle__label for=toggle-e4cde74e0b82591bbb113b641faed73d><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.9/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.9/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.9/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.9/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.9/features/ingress/>Ingress</a></li><li><a href=/2.9/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.9/features/load-balancing/>Load Balancing</a></li><li><a href=/2.9/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.9/features/cni/>CNI Plugin</a></li><li><a href=/2.9/features/dashboard/>Dashboard and Grafana</a></li><li><a href=/2.9/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.9/features/fault-injection/>Fault Injection</a></li><li><a href=/2.9/features/ha/>High Availability</a></li><li><a href=/2.9/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.9/features/service-profiles/>Service Profiles</a></li><li><a href=/2.9/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.9/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-5e629638c4c6eed35a2c9c4890c08f16 checked>
<label class=toggle__label for=toggle-5e629638c4c6eed35a2c9c4890c08f16><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.9/tasks/adding-your-service/>Adding Your Services to Linkerd</a></li><li><a href=/2.9/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.9/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.9/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.9/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.9/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.9/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.9/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.9/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.9/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.9/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.9/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.9/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.9/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.9/tasks/enabling-addons/>Enabling Add-ons</a></li><li><a href=/2.9/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.9/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.9/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.9/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.9/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.9/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.9/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.9/tasks/install/>Installing Linkerd</a></li><li><a href=/2.9/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.9/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.9/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.9/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.9/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.9/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.9/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.9/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.9/tasks/securing-your-service/>Securing Your Application with mTLS</a></li><li><a href=/2.9/tasks/securing-your-cluster/>Securing Your Cluster</a></li><li><a href=/2.9/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li class=docs__nav--selected><a href=/2.9/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.9/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.9/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.9/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.9/tasks/upgrade-multicluster/>Upgrading Multicluster in Linkerd 2.9</a></li><li><a href=/2.9/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.9/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.9/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.9/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li></ul></li><li><a href=/2.9/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-a8d66111bc52c02f61a2a68c4bc0d794>
<label class=toggle__label for=toggle-a8d66111bc52c02f61a2a68c4bc0d794><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.9/reference/architecture/>Architecture</a></li><li><a href=/2.9/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-3f11a82cff203cfd1d728e9564196222>
<label class=toggle__label for=toggle-3f11a82cff203cfd1d728e9564196222><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.9/reference/cli/check/>check</a></li><li><a href=/2.9/reference/cli/completion/>completion</a></li><li><a href=/2.9/reference/cli/dashboard/>dashboard</a></li><li><a href=/2.9/reference/cli/edges/>edges</a></li><li><a href=/2.9/reference/cli/endpoints/>endpoints</a></li><li><a href=/2.9/reference/cli/get/>get</a></li><li><a href=/2.9/reference/cli/inject/>inject</a></li><li><a href=/2.9/reference/cli/install/>install</a></li><li><a href=/2.9/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.9/reference/cli/install-sp/>install-sp</a></li><li><a href=/2.9/reference/cli/logs/>logs</a></li><li><a href=/2.9/reference/cli/metrics/>metrics</a></li><li><a href=/2.9/reference/cli/profile/>profile</a></li><li><a href=/2.9/reference/cli/routes/>routes</a></li><li><a href=/2.9/reference/cli/stat/>stat</a></li><li><a href=/2.9/reference/cli/tap/>tap</a></li><li><a href=/2.9/reference/cli/top/>top</a></li><li><a href=/2.9/reference/cli/uninject/>uninject</a></li><li><a href=/2.9/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.9/reference/cli/version/>version</a></li></ul></li><li><a href=/2.9/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.9/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.9/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.9/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.9/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Troubleshooting</h1></div><div class="docs__content prose"><p>This section provides resolution steps for common problems reported with the
<code>linkerd check</code> command.</p><h2 id=pre-k8s-cluster class=anchor>The &ldquo;pre-kubernetes-cluster-setup&rdquo; checks
<a href=#pre-k8s-cluster class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks only run when the <code>--pre</code> flag is set. This flag is intended for
use prior to running <code>linkerd install</code>, to verify your cluster is prepared for
installation.</p><h3 id=pre-ns class=anchor>√ control plane namespace does not already exist
<a href=#pre-ns class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane namespace does not already exist
</span></span><span style=display:flex><span>    The <span style=color:#a5d6ff>&#34;linkerd&#34;</span> namespace already exists
</span></span></code></pre></div><p>By default <code>linkerd install</code> will create a <code>linkerd</code> namespace. Prior to
installation, that namespace should not exist. To check with a different
namespace, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --pre --linkerd-namespace linkerd-test
</span></span></code></pre></div><h3 id=pre-k8s-cluster-k8s class=anchor>√ can create Kubernetes resources
<a href=#pre-k8s-cluster-k8s class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>The subsequent checks in this section validate whether you have permission to
create the Kubernetes resources required for Linkerd installation, specifically:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>√ can create Namespaces
</span></span><span style=display:flex><span>√ can create ClusterRoles
</span></span><span style=display:flex><span>√ can create ClusterRoleBindings
</span></span><span style=display:flex><span>√ can create CustomResourceDefinitions
</span></span></code></pre></div><h2 id=pre-k8s class=anchor>The &ldquo;pre-kubernetes-setup&rdquo; checks
<a href=#pre-k8s class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks only run when the <code>--pre</code> flag is set This flag is intended for use
prior to running <code>linkerd install</code>, to verify you have the correct RBAC
permissions to install Linkerd.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>√ can create Namespaces
</span></span><span style=display:flex><span>√ can create ClusterRoles
</span></span><span style=display:flex><span>√ can create ClusterRoleBindings
</span></span><span style=display:flex><span>√ can create CustomResourceDefinitions
</span></span><span style=display:flex><span>√ can create PodSecurityPolicies
</span></span><span style=display:flex><span>√ can create ServiceAccounts
</span></span><span style=display:flex><span>√ can create Services
</span></span><span style=display:flex><span>√ can create Deployments
</span></span><span style=display:flex><span>√ can create ConfigMaps
</span></span></code></pre></div><h3 id=pre-k8s-clock-skew class=anchor>√ no clock skew detected
<a href=#pre-k8s-clock-skew class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This check detects any differences between the system running the
<code>linkerd install</code> command and the Kubernetes nodes (known as clock skew). Having
a substantial clock skew can cause TLS validation problems because a node may
determine that a TLS certificate is expired when it should not be, or vice
versa.</p><p>Linkerd version edge-20.3.4 and later check for a difference of at most 5
minutes and older versions of Linkerd (including stable-2.7) check for a
difference of at most 1 minute. If your Kubernetes node heartbeat interval is
longer than this difference, you may experience false positives of this check.
The default node heartbeat interval was increased to 5 minutes in Kubernetes
1.17 meaning that users running Linkerd versions prior to edge-20.3.4 on
Kubernetes 1.17 or later are likely to experience these false positives. If this
is the case, you can upgrade to Linkerd edge-20.3.4 or later. If you choose to
ignore this error, we strongly recommend that you verify that your system clocks
are consistent.</p><h2 id=pre-k8s-capability class=anchor>The &ldquo;pre-kubernetes-capability&rdquo; checks
<a href=#pre-k8s-capability class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks only run when the <code>--pre</code> flag is set. This flag is intended for
use prior to running <code>linkerd install</code>, to verify you have the correct
Kubernetes capability permissions to install Linkerd.</p><h3 id=pre-k8s-cluster-net-admin class=anchor>√ has NET_ADMIN capability
<a href=#pre-k8s-cluster-net-admin class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× has NET_ADMIN capability
</span></span><span style=display:flex><span>    found <span style=color:#a5d6ff>3</span> PodSecurityPolicies, but none provide NET_ADMIN
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#pre-k8s-cluster-net-admin <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Linkerd installation requires the <code>NET_ADMIN</code> Kubernetes capability, to allow
for modification of iptables.</p><p>For more information, see the Kubernetes documentation on
<a href=https://kubernetes.io/docs/concepts/policy/pod-security-policy/ target=_blank rel=noopener>Pod Security Policies</a>,
<a href=https://kubernetes.io/docs/tasks/configure-pod-container/security-context/ target=_blank rel=noopener>Security Contexts</a>,
and the
<a href=https://www.man7.org/linux/man-pages/man7/capabilities.7.html target=_blank rel=noopener>man page on Linux Capabilities</a>.</p><h3 id=pre-k8s-cluster-net-raw class=anchor>√ has NET_RAW capability
<a href=#pre-k8s-cluster-net-raw class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× has NET_RAW capability
</span></span><span style=display:flex><span>    found <span style=color:#a5d6ff>3</span> PodSecurityPolicies, but none provide NET_RAW
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#pre-k8s-cluster-net-raw <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Linkerd installation requires the <code>NET_RAW</code> Kubernetes capability, to allow for
modification of iptables.</p><p>For more information, see the Kubernetes documentation on
<a href=https://kubernetes.io/docs/concepts/policy/pod-security-policy/ target=_blank rel=noopener>Pod Security Policies</a>,
<a href=https://kubernetes.io/docs/tasks/configure-pod-container/security-context/ target=_blank rel=noopener>Security Contexts</a>,
and the
<a href=https://www.man7.org/linux/man-pages/man7/capabilities.7.html target=_blank rel=noopener>man page on Linux Capabilities</a>.</p><h2 id=pre-l5d-existence class=anchor>The &ldquo;pre-linkerd-global-resources&rdquo; checks
<a href=#pre-l5d-existence class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks only run when the <code>--pre</code> flag is set. This flag is intended for
use prior to running <code>linkerd install</code>, to verify you have not already installed
the Linkerd control plane.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>√ no ClusterRoles exist
</span></span><span style=display:flex><span>√ no ClusterRoleBindings exist
</span></span><span style=display:flex><span>√ no CustomResourceDefinitions exist
</span></span><span style=display:flex><span>√ no MutatingWebhookConfigurations exist
</span></span><span style=display:flex><span>√ no ValidatingWebhookConfigurations exist
</span></span><span style=display:flex><span>√ no PodSecurityPolicies exist
</span></span></code></pre></div><h2 id=pre-single class=anchor>The &ldquo;pre-kubernetes-single-namespace-setup&rdquo; checks
<a href=#pre-single class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If you do not expect to have the permission for a full cluster install, try the
<code>--single-namespace</code> flag, which validates if Linkerd can be installed in a
single namespace, with limited cluster access:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --pre --single-namespace
</span></span></code></pre></div><h3 id=pre-single-ns class=anchor>√ control plane namespace exists
<a href=#pre-single-ns class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane namespace exists
</span></span><span style=display:flex><span>    The <span style=color:#a5d6ff>&#34;linkerd&#34;</span> namespace does not exist
</span></span></code></pre></div><p>In <code>--single-namespace</code> mode, <code>linkerd check</code> assumes that the installer does
not have permission to create a namespace, so the installation namespace must
already exist.</p><p>By default the <code>linkerd</code> namespace is used. To use a different namespace run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --pre --single-namespace --linkerd-namespace linkerd-test
</span></span></code></pre></div><h3 id=pre-single-k8s class=anchor>√ can create Kubernetes resources
<a href=#pre-single-k8s class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>The subsequent checks in this section validate whether you have permission to
create the Kubernetes resources required for Linkerd <code>--single-namespace</code>
installation, specifically:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>√ can create Roles
</span></span><span style=display:flex><span>√ can create RoleBindings
</span></span></code></pre></div><p>For more information on cluster access, see the
<a href=../install/#gke>GKE Setup</a> section above.</p><h2 id=k8s-api class=anchor>The &ldquo;kubernetes-api&rdquo; checks
<a href=#k8s-api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Example failures:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× can initialize the client
</span></span><span style=display:flex><span>    error configuring Kubernetes API client: stat badconfig: no such file or directory
</span></span><span style=display:flex><span>× can query the Kubernetes API
</span></span><span style=display:flex><span>    Get https://8.8.8.8/version: dial tcp 8.8.8.8:443: i/o timeout
</span></span></code></pre></div><p>Ensure that your system is configured to connect to a Kubernetes cluster.
Validate that the <code>KUBECONFIG</code> environment variable is set properly, and/or
<code>~/.kube/config</code> points to a valid cluster.</p><p>For more information see these pages in the Kubernetes Documentation:</p><ul><li><a href=https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/ target=_blank rel=noopener>Accessing Clusters</a></li><li><a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/ target=_blank rel=noopener>Configure Access to Multiple Clusters</a></li></ul><p>Also verify that these command works:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl config view
</span></span><span style=display:flex><span>kubectl cluster-info
</span></span><span style=display:flex><span>kubectl version
</span></span></code></pre></div><p>Another example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>✘ can query the Kubernetes API
</span></span><span style=display:flex><span>    Get REDACTED/version: x509: certificate signed by unknown authority
</span></span></code></pre></div><p>As an (unsafe) workaround to this, you may try:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl config set-cluster <span style=color:#a5d6ff>${</span><span style=color:#79c0ff>KUBE_CONTEXT</span><span style=color:#a5d6ff>}</span> --insecure-skip-tls-verify<span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    --server<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>KUBE_CONTEXT</span><span style=color:#a5d6ff>}</span>
</span></span></code></pre></div><h2 id=k8s-version class=anchor>The &ldquo;kubernetes-version&rdquo; checks
<a href=#k8s-version class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=k8s-version-api class=anchor>√ is running the minimum Kubernetes API version
<a href=#k8s-version-api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× is running the minimum Kubernetes API version
</span></span><span style=display:flex><span>    Kubernetes is on version <span style=color:#ff7b72;font-weight:700>[</span>1.7.16<span style=color:#ff7b72;font-weight:700>]</span>, but version <span style=color:#ff7b72;font-weight:700>[</span>1.13.0<span style=color:#ff7b72;font-weight:700>]</span> or more recent is required
</span></span></code></pre></div><p>Linkerd requires at least version <code>1.13.0</code>. Verify your cluster version with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version
</span></span></code></pre></div><h3 id=kubectl-version class=anchor>√ is running the minimum kubectl version
<a href=#kubectl-version class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× is running the minimum kubectl version
</span></span><span style=display:flex><span>    kubectl is on version <span style=color:#ff7b72;font-weight:700>[</span>1.9.1<span style=color:#ff7b72;font-weight:700>]</span>, but version <span style=color:#ff7b72;font-weight:700>[</span>1.13.0<span style=color:#ff7b72;font-weight:700>]</span> or more recent is required
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#kubectl-version <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Linkerd requires at least version <code>1.13.0</code>. Verify your kubectl version with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version --client --short
</span></span></code></pre></div><p>To fix please update kubectl version.</p><p>For more information on upgrading Kubernetes, see the page in the Kubernetes
Documentation.</p><h2 id=l5d-config class=anchor>The &ldquo;linkerd-config&rdquo; checks
<a href=#l5d-config class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>This category of checks validates that Linkerd&rsquo;s cluster-wide RBAC and related
resources have been installed. These checks run via a default <code>linkerd check</code>,
and also in the context of a multi-stage setup, for example:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># install cluster-wide resources (first stage)</span>
</span></span><span style=display:flex><span>linkerd install config | kubectl apply -f -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># validate successful cluster-wide resources installation</span>
</span></span><span style=display:flex><span>linkerd check config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># install Linkerd control plane</span>
</span></span><span style=display:flex><span>linkerd install control-plane | kubectl apply -f -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># validate successful control-plane installation</span>
</span></span><span style=display:flex><span>linkerd check
</span></span></code></pre></div><h3 id=l5d-existence-ns class=anchor>√ control plane Namespace exists
<a href=#l5d-existence-ns class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane Namespace exists
</span></span><span style=display:flex><span>    The <span style=color:#a5d6ff>&#34;foo&#34;</span> namespace does not exist
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-ns <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd control plane namespace exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ns
</span></span></code></pre></div><p>The default control plane namespace is <code>linkerd</code>. If you installed Linkerd into
a different namespace, specify that in your check command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --linkerd-namespace linkerdtest
</span></span></code></pre></div><h3 id=l5d-existence-cr class=anchor>√ control plane ClusterRoles exist
<a href=#l5d-existence-cr class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane ClusterRoles exist
</span></span><span style=display:flex><span>    missing ClusterRoles: linkerd-linkerd-controller
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-cr <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd ClusterRoles exist:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterroles | grep linkerd
</span></span><span style=display:flex><span>linkerd-linkerd-controller                                             9d
</span></span><span style=display:flex><span>linkerd-linkerd-identity                                               9d
</span></span><span style=display:flex><span>linkerd-linkerd-prometheus                                             9d
</span></span><span style=display:flex><span>linkerd-linkerd-proxy-injector                                         20d
</span></span><span style=display:flex><span>linkerd-linkerd-sp-validator                                           9d
</span></span></code></pre></div><p>Also ensure you have permission to create ClusterRoles:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create clusterroles
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-crb class=anchor>√ control plane ClusterRoleBindings exist
<a href=#l5d-existence-crb class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane ClusterRoleBindings exist
</span></span><span style=display:flex><span>    missing ClusterRoleBindings: linkerd-linkerd-controller
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-crb <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd ClusterRoleBindings exist:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterrolebindings | grep linkerd
</span></span><span style=display:flex><span>linkerd-linkerd-controller                             9d
</span></span><span style=display:flex><span>linkerd-linkerd-identity                               9d
</span></span><span style=display:flex><span>linkerd-linkerd-prometheus                             9d
</span></span><span style=display:flex><span>linkerd-linkerd-proxy-injector                         20d
</span></span><span style=display:flex><span>linkerd-linkerd-sp-validator                           9d
</span></span></code></pre></div><p>Also ensure you have permission to create ClusterRoleBindings:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create clusterrolebindings
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-sa class=anchor>√ control plane ServiceAccounts exist
<a href=#l5d-existence-sa class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane ServiceAccounts exist
</span></span><span style=display:flex><span>    missing ServiceAccounts: linkerd-controller
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-sa <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd ServiceAccounts exist:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd get serviceaccounts
</span></span><span style=display:flex><span>NAME                     SECRETS   AGE
</span></span><span style=display:flex><span>default                  <span style=color:#a5d6ff>1</span>         23m
</span></span><span style=display:flex><span>linkerd-controller       <span style=color:#a5d6ff>1</span>         23m
</span></span><span style=display:flex><span>linkerd-grafana          <span style=color:#a5d6ff>1</span>         23m
</span></span><span style=display:flex><span>linkerd-identity         <span style=color:#a5d6ff>1</span>         23m
</span></span><span style=display:flex><span>linkerd-prometheus       <span style=color:#a5d6ff>1</span>         23m
</span></span><span style=display:flex><span>linkerd-proxy-injector   <span style=color:#a5d6ff>1</span>         7m
</span></span><span style=display:flex><span>linkerd-sp-validator     <span style=color:#a5d6ff>1</span>         23m
</span></span><span style=display:flex><span>linkerd-web              <span style=color:#a5d6ff>1</span>         23m
</span></span></code></pre></div><p>Also ensure you have permission to create ServiceAccounts in the Linkerd
namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd auth can-i create serviceaccounts
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-crd class=anchor>√ control plane CustomResourceDefinitions exist
<a href=#l5d-existence-crd class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane CustomResourceDefinitions exist
</span></span><span style=display:flex><span>    missing CustomResourceDefinitions: serviceprofiles.linkerd.io
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-crd <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd CRD exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get customresourcedefinitions
</span></span><span style=display:flex><span>NAME                         CREATED AT
</span></span><span style=display:flex><span>serviceprofiles.linkerd.io   2019-04-25T21:47:31Z
</span></span></code></pre></div><p>Also ensure you have permission to create CRDs:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create customresourcedefinitions
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-mwc class=anchor>√ control plane MutatingWebhookConfigurations exist
<a href=#l5d-existence-mwc class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane MutatingWebhookConfigurations exist
</span></span><span style=display:flex><span>    missing MutatingWebhookConfigurations: linkerd-proxy-injector-webhook-config
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-mwc <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd MutatingWebhookConfigurations exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get mutatingwebhookconfigurations | grep linkerd
</span></span><span style=display:flex><span>linkerd-proxy-injector-webhook-config   2019-07-01T13:13:26Z
</span></span></code></pre></div><p>Also ensure you have permission to create MutatingWebhookConfigurations:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create mutatingwebhookconfigurations
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-vwc class=anchor>√ control plane ValidatingWebhookConfigurations exist
<a href=#l5d-existence-vwc class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane ValidatingWebhookConfigurations exist
</span></span><span style=display:flex><span>    missing ValidatingWebhookConfigurations: linkerd-sp-validator-webhook-config
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-vwc <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd ValidatingWebhookConfiguration exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get validatingwebhookconfigurations | grep linkerd
</span></span><span style=display:flex><span>linkerd-sp-validator-webhook-config   2019-07-01T13:13:26Z
</span></span></code></pre></div><p>Also ensure you have permission to create ValidatingWebhookConfigurations:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create validatingwebhookconfigurations
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-psp class=anchor>√ control plane PodSecurityPolicies exist
<a href=#l5d-existence-psp class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane PodSecurityPolicies exist
</span></span><span style=display:flex><span>    missing PodSecurityPolicies: linkerd-linkerd-control-plane
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-psp <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd PodSecurityPolicy exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get podsecuritypolicies | grep linkerd
</span></span><span style=display:flex><span>linkerd-linkerd-control-plane   false   NET_ADMIN,NET_RAW   RunAsAny   RunAsAny    MustRunAs   MustRunAs   true             configMap,emptyDir,secret,projected,downwardAPI,persistentVolumeClaim
</span></span></code></pre></div><p>Also ensure you have permission to create PodSecurityPolicies:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create podsecuritypolicies
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h2 id=l5d-existence class=anchor>The &ldquo;linkerd-existence&rdquo; checks
<a href=#l5d-existence class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=l5d-existence-linkerd-config class=anchor>√ &rsquo;linkerd-config&rsquo; config map exists
<a href=#l5d-existence-linkerd-config class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× <span style=color:#a5d6ff>&#39;linkerd-config&#39;</span> config map exists
</span></span><span style=display:flex><span>    missing ConfigMaps: linkerd-config
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-linkerd-config <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the Linkerd ConfigMap exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd get configmap/linkerd-config
</span></span><span style=display:flex><span>NAME             DATA   AGE
</span></span><span style=display:flex><span>linkerd-config   <span style=color:#a5d6ff>3</span>      61m
</span></span></code></pre></div><p>Also ensure you have permission to create ConfigMaps:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd auth can-i create configmap
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-existence-replicasets class=anchor>√ control plane replica sets are ready
<a href=#l5d-existence-replicasets class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This failure occurs when one of Linkerd&rsquo;s ReplicaSets fails to schedule a pod.</p><p>For more information, see the Kubernetes documentation on
<a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#failed-deployment target=_blank rel=noopener>Failed Deployments</a>.</p><h3 id=l5d-existence-unschedulable-pods class=anchor>√ no unschedulable pods
<a href=#l5d-existence-unschedulable-pods class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× no unschedulable pods
</span></span><span style=display:flex><span>    linkerd-prometheus-6b668f774d-j8ncr: 0/1 nodes are available: <span style=color:#a5d6ff>1</span> Insufficient cpu.
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-unschedulable-pods <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>For more information, see the Kubernetes documentation on the
<a href=https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions target=_blank rel=noopener>Unschedulable Pod Condition</a>.</p><h3 id=l5d-existence-controller class=anchor>√ controller pod is running
<a href=#l5d-existence-controller class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× controller pod is running
</span></span><span style=display:flex><span>    No running pods <span style=color:#ff7b72>for</span> <span style=color:#a5d6ff>&#34;linkerd-controller&#34;</span>
</span></span></code></pre></div><p>Note, it takes a little bit for pods to be scheduled, images to be pulled and
everything to start up. If this is a permanent error, you&rsquo;ll want to validate
the state of the controller pod with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd get po --selector linkerd.io/control-plane-component<span style=color:#ff7b72;font-weight:700>=</span>controller
</span></span><span style=display:flex><span>NAME                                  READY     STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>linkerd-controller-7bb8ff5967-zg265   4/4       Running   <span style=color:#a5d6ff>0</span>          40m
</span></span></code></pre></div><p>Check the controller&rsquo;s logs with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n linkerd linkerd-controller-7bb8ff5967-zg265 public-api
</span></span></code></pre></div><h3 id=l5d-existence-client class=anchor>√ can initialize the client
<a href=#l5d-existence-client class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× can initialize the client
</span></span><span style=display:flex><span>    parse http:// bad/: invalid character <span style=color:#a5d6ff>&#34; &#34;</span> in host name
</span></span></code></pre></div><p>Verify that a well-formed <code>--api-addr</code> parameter was specified, if any:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --api-addr <span style=color:#a5d6ff>&#34; bad&#34;</span>
</span></span></code></pre></div><h3 id=l5d-existence-api class=anchor>√ can query the control plane API
<a href=#l5d-existence-api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× can query the control plane API
</span></span><span style=display:flex><span>    Post http://8.8.8.8/api/v1/Version: context deadline exceeded
</span></span></code></pre></div><p>This check indicates a connectivity failure between the cli and the Linkerd
control plane. To verify connectivity, manually connect to the controller pod:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd port-forward <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    <span style=color:#ff7b72>$(</span>kubectl -n linkerd get po <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>        --selector<span style=color:#ff7b72;font-weight:700>=</span>linkerd.io/control-plane-component<span style=color:#ff7b72;font-weight:700>=</span>controller <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>        -o <span style=color:#79c0ff>jsonpath</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;{.items[*].metadata.name}&#39;</span><span style=color:#ff7b72>)</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>9995:9995
</span></span></code></pre></div><p>&mldr;and then curl the <code>/metrics</code> endpoint:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl localhost:9995/metrics
</span></span></code></pre></div><h2 id=l5d-identity class=anchor>The &ldquo;linkerd-identity&rdquo; checks
<a href=#l5d-identity class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=l5d-identity-cert-config-valid class=anchor>√ certificate config is valid
<a href=#l5d-identity-cert-config-valid class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failures:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× certificate config is valid
</span></span><span style=display:flex><span>    key ca.crt containing the trust anchors needs to exist in secret linkerd-identity-issuer <span style=color:#ff7b72>if</span> --identity-external-issuer<span style=color:#ff7b72;font-weight:700>=</span>true
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-cert-config-valid
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× certificate config is valid
</span></span><span style=display:flex><span>    key crt.pem containing the issuer certificate needs to exist in secret linkerd-identity-issuer <span style=color:#ff7b72>if</span> --identity-external-issuer<span style=color:#ff7b72;font-weight:700>=</span>false
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-cert-config-valid
</span></span></code></pre></div><p>Ensure that your <code>linkerd-identity-issuer</code> secret contains the correct keys for
the <code>scheme</code> that Linkerd is configured with. If the scheme is
<code>kubernetes.io/tls</code> your secret should contain the <code>tls.crt</code>, <code>tls.key</code> and
<code>ca.crt</code> keys. Alternatively if your scheme is <code>linkerd.io/tls</code>, the required
keys are <code>crt.pem</code> and <code>key.pem</code>.</p><h3 id=l5d-identity-trustAnchors-use-supported-crypto class=anchor>√ trust roots are using supported crypto algorithm
<a href=#l5d-identity-trustAnchors-use-supported-crypto class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× trust roots are using supported crypto algorithm
</span></span><span style=display:flex><span>    Invalid roots:
</span></span><span style=display:flex><span>        * <span style=color:#a5d6ff>165223702412626077778653586125774349756</span> identity.linkerd.cluster.local must use P-256 curve <span style=color:#ff7b72>for</span> public key, instead P-521 was used
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-trustAnchors-use-supported-crypto
</span></span></code></pre></div><p>You need to ensure that all of your roots use ECDSA P-256 for their public key
algorithm.</p><h3 id=l5d-identity-trustAnchors-are-time-valid class=anchor>√ trust roots are within their validity period
<a href=#l5d-identity-trustAnchors-are-time-valid class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× trust roots are within their validity period
</span></span><span style=display:flex><span>    Invalid roots:
</span></span><span style=display:flex><span>        * <span style=color:#a5d6ff>199607941798581518463476688845828639279</span> identity.linkerd.cluster.local not valid anymore. Expired on 2019-12-19T13:08:18Z
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-trustAnchors-are-time-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Failures of such nature indicate that your roots have expired. If that is the
case you will have to update both the root and issuer certificates at once. You
can follow the process outlined in
<a href=../replacing_expired_certificates/>Replacing Expired Certificates</a> to
get your cluster back to a stable state.</p><h3 id=l5d-identity-trustAnchors-not-expiring-soon class=anchor>√ trust roots are valid for at least 60 days
<a href=#l5d-identity-trustAnchors-not-expiring-soon class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example warnings:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ trust roots are valid <span style=color:#ff7b72>for</span> at least <span style=color:#a5d6ff>60</span> days
</span></span><span style=display:flex><span>    Roots expiring soon:
</span></span><span style=display:flex><span>        * <span style=color:#a5d6ff>66509928892441932260491975092256847205</span> identity.linkerd.cluster.local will expire on 2019-12-19T13:30:57Z
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-trustAnchors-not-expiring-soon <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This warning indicates that the expiry of some of your roots is approaching. In
order to address this problem without incurring downtime, you can follow the
process outlined in
<a href=../rotating_identity_certificates/>Rotating your identity certificates</a>.</p><h3 id=l5d-identity-issuer-cert-uses-supported-crypto class=anchor>√ issuer cert is using supported crypto algorithm
<a href=#l5d-identity-issuer-cert-uses-supported-crypto class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× issuer cert is using supported crypto algorithm
</span></span><span style=display:flex><span>    issuer certificate must use P-256 curve <span style=color:#ff7b72>for</span> public key, instead P-521 was used
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#5d-identity-issuer-cert-uses-supported-crypto <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>You need to ensure that your issuer certificate uses ECDSA P-256 for its public
key algorithm. You can refer to
<a href=../generate-certificates/#generating-the-certificates-with-step>Generating your own mTLS root certificates</a>
to see how you can generate certificates that will work with Linkerd.</p><h3 id=l5d-identity-issuer-cert-is-time-valid class=anchor>√ issuer cert is within its validity period
<a href=#l5d-identity-issuer-cert-is-time-valid class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× issuer cert is within its validity period
</span></span><span style=display:flex><span>    issuer certificate is not valid anymore. Expired on 2019-12-19T13:35:49Z
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-issuer-cert-is-time-valid
</span></span></code></pre></div><p>This failure indicates that your issuer certificate has expired. In order to
bring your cluster back to a valid state, follow the process outlined in
<a href=../replacing_expired_certificates/>Replacing Expired Certificates</a>.</p><h3 id=l5d-identity-issuer-cert-not-expiring-soon class=anchor>√ issuer cert is valid for at least 60 days
<a href=#l5d-identity-issuer-cert-not-expiring-soon class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example warning:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ issuer cert is valid <span style=color:#ff7b72>for</span> at least <span style=color:#a5d6ff>60</span> days
</span></span><span style=display:flex><span>    issuer certificate will expire on 2019-12-19T13:35:49Z
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-issuer-cert-not-expiring-soon <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This warning means that your issuer certificate is expiring soon. If you do not
rely on external certificate management solution such as <code>cert-manager</code>, you can
follow the process outlined in
<a href=../rotating_identity_certificates/>Rotating your identity certificates</a></p><h3 id=l5d-identity-issuer-cert-issued-by-trust-anchor class=anchor>√ issuer cert is issued by the trust root
<a href=#l5d-identity-issuer-cert-issued-by-trust-anchor class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× issuer cert is issued by the trust root
</span></span><span style=display:flex><span>    x509: certificate signed by unknown authority <span style=color:#ff7b72;font-weight:700>(</span>possibly because of <span style=color:#a5d6ff>&#34;x509: ECDSA verification failure&#34;</span> <span style=color:#ff7b72>while</span> trying to verify candidate authority certificate <span style=color:#a5d6ff>&#34;identity.linkerd.cluster.local&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-identity-issuer-cert-issued-by-trust-anchor <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This error indicates that the issuer certificate that is in the
<code>linkerd-identity-issuer</code> secret cannot be verified with any of the roots that
Linkerd has been configured with. Using the CLI install process, this should
never happen. If Helm was used for installation or the issuer certificates are
managed by a malfunctioning certificate management solution, it is possible for
the cluster to end up in such an invalid state. At that point the best to do is
to use the upgrade command to update your certificates:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    --identity-issuer-certificate-file<span style=color:#ff7b72;font-weight:700>=</span>./your-new-issuer.crt <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    --identity-issuer-key-file<span style=color:#ff7b72;font-weight:700>=</span>./your-new-issuer.key <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    --identity-trust-anchors-file<span style=color:#ff7b72;font-weight:700>=</span>./your-new-roots.crt <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    --force | kubectl apply -f -
</span></span></code></pre></div><p>Once the upgrade process is over, the output of <code>linkerd check --proxy</code> should
be:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd-identity
</span></span><span style=display:flex><span>----------------
</span></span><span style=display:flex><span>√ certificate config is valid
</span></span><span style=display:flex><span>√ trust roots are using supported crypto algorithm
</span></span><span style=display:flex><span>√ trust roots are within their validity period
</span></span><span style=display:flex><span>√ trust roots are valid <span style=color:#ff7b72>for</span> at least <span style=color:#a5d6ff>60</span> days
</span></span><span style=display:flex><span>√ issuer cert is using supported crypto algorithm
</span></span><span style=display:flex><span>√ issuer cert is within its validity period
</span></span><span style=display:flex><span>√ issuer cert is valid <span style=color:#ff7b72>for</span> at least <span style=color:#a5d6ff>60</span> days
</span></span><span style=display:flex><span>√ issuer cert is issued by the trust root
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>linkerd-identity-data-plane
</span></span><span style=display:flex><span>---------------------------
</span></span><span style=display:flex><span>√ data plane proxies certificate match CA
</span></span></code></pre></div><h2 id=l5d-webhook class=anchor>The &ldquo;linkerd-webhooks-and-apisvc-tls&rdquo; checks
<a href=#l5d-webhook class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=l5d-tap-cert-valid class=anchor>√ tap API server has valid cert
<a href=#l5d-tap-cert-valid class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× tap API server has valid cert
</span></span><span style=display:flex><span>    secrets <span style=color:#a5d6ff>&#34;linkerd-tap-tls&#34;</span> not found
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-tap-cert-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the <code>linkerd-tap-k8s-tls</code> secret exists and contains the appropriate
<code>tls.crt</code> and <code>tls.key</code> data entries. For versions before 2.9, the secret is
named <code>linkerd-tap-tls</code> and it should contain the <code>crt.pem</code> and <code>key.pem</code> data
entries.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× tap API server has valid cert
</span></span><span style=display:flex><span>    cert is not issued by the trust anchor: x509: certificate is valid <span style=color:#ff7b72>for</span> xxxxxx, not linkerd-tap.linkerd.svc
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-tap-cert-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Here you need to make sure the certificate was issued specifically for
<code>linkerd-tap.linkerd.svc</code>.</p><h3 id=l5d-webhook-cert-not-expiring-soon class=anchor>√ webhook cert is valid for at least 60 days
<a href=#l5d-webhook-cert-not-expiring-soon class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ tap API server cert is valid <span style=color:#ff7b72>for</span> at least <span style=color:#a5d6ff>60</span> days
</span></span><span style=display:flex><span>    certificate will expire on 2020-11-07T17:00:07Z
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-webhook-cert-not-expiring-soon <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This warning indicates that the expiry of one of your webhooks (tap API server,
proxy-injector or sp-validator) cert is approaching. In order to address this
problem without incurring downtime, you can follow the process outlined in
<a href=../automatically-rotating-webhook-tls-credentials/>Automatically Rotating your webhook TLS Credentials</a>.</p><h3 id=l5d-proxy-injector-webhook-cert-valid class=anchor>√ proxy-injector webhook has valid cert
<a href=#l5d-proxy-injector-webhook-cert-valid class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× proxy-injector webhook has valid cert
</span></span><span style=display:flex><span>    secrets <span style=color:#a5d6ff>&#34;linkerd-proxy-injector-tls&#34;</span> not found
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-proxy-injector-webhook-cert-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the <code>linkerd-proxy-injector-k8s-tls</code> secret exists and contains the
appropriate <code>tls.crt</code> and <code>tls.key</code> data entries. For versions before 2.9, the
secret is named <code>linkerd-proxy-injector-tls</code> and it should contain the <code>crt.pem</code>
and <code>key.pem</code> data entries.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× proxy-injector webhook has valid cert
</span></span><span style=display:flex><span>    cert is not issued by the trust anchor: x509: certificate is valid <span style=color:#ff7b72>for</span> xxxxxx, not linkerd-proxy-injector.linkerd.svc
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-proxy-injector-webhook-cert-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Here you need to make sure the certificate was issued specifically for
<code>linkerd-proxy-injector.linkerd.svc</code>.</p><h3 id=l5d-sp-validator-webhook-cert-valid class=anchor>√ sp-validator webhook has valid cert
<a href=#l5d-sp-validator-webhook-cert-valid class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× sp-validator webhook has valid cert
</span></span><span style=display:flex><span>    secrets <span style=color:#a5d6ff>&#34;linkerd-sp-validator-tls&#34;</span> not found
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-sp-validator-webhook-cert-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the <code>linkerd-sp-validator-k8s-tls</code> secret exists and contains the
appropriate <code>tls.crt</code> and <code>tls.key</code> data entries. For versions before 2.9, the
secret is named <code>linkerd-sp-validator-tls</code> and it should contain the <code>crt.pem</code>
and <code>key.pem</code> data entries.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× sp-validator webhook has valid cert
</span></span><span style=display:flex><span>    cert is not issued by the trust anchor: x509: certificate is valid <span style=color:#ff7b72>for</span> xxxxxx, not linkerd-sp-validator.linkerd.svc
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-sp-validator-webhook-cert-valid <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Here you need to make sure the certificate was issued specifically for
<code>linkerd-sp-validator.linkerd.svc</code>.</p><h2 id=l5d-identity-data-plane class=anchor>The &ldquo;linkerd-identity-data-plane&rdquo; checks
<a href=#l5d-identity-data-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=l5d-identity-data-plane-proxies-certs-match-ca class=anchor>√ data plane proxies certificate match CA
<a href=#l5d-identity-data-plane-proxies-certs-match-ca class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example warning:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ data plane proxies certificate match CA
</span></span><span style=display:flex><span>    Some pods <span style=color:#ff7b72>do</span> not have the current trust bundle and must be restarted:
</span></span><span style=display:flex><span>        * emojivoto/emoji-d8d7d9c6b-8qwfx
</span></span><span style=display:flex><span>        * emojivoto/vote-bot-588499c9f6-zpwz6
</span></span><span style=display:flex><span>        * emojivoto/voting-8599548fdc-6v64k
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/<span style=color:#ff7b72;font-weight:700>{</span><span style=color:#8b949e;font-style:italic>#l5d-identity-data-plane-proxies-certs-match-ca for hints</span>
</span></span></code></pre></div><p>Observing this warning indicates that some of your meshed pods have proxies that
have stale certificates. This is most likely to happen during <code>upgrade</code>
operations that deal with cert rotation. In order to solve the problem you can
use <code>rollout restart</code> to restart the pods in question. That should cause them to
pick the correct certs from the <code>linkerd-config</code> configmap. When <code>upgrade</code> is
performed using the <code>--identity-trust-anchors-file</code> flag to modify the roots,
the Linkerd components are restarted. While this operation is in progress the
<code>check --proxy</code> command may output a warning, pertaining to the Linkerd
components:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ data plane proxies certificate match CA
</span></span><span style=display:flex><span>    Some pods <span style=color:#ff7b72>do</span> not have the current trust bundle and must be restarted:
</span></span><span style=display:flex><span>        * linkerd/linkerd-sp-validator-75f9d96dc-rch4x
</span></span><span style=display:flex><span>        * linkerd/linkerd-tap-68d8bbf64-mpzgb
</span></span><span style=display:flex><span>        * linkerd/linkerd-web-849f74b7c6-qlhwc
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/<span style=color:#ff7b72;font-weight:700>{</span><span style=color:#8b949e;font-style:italic>#l5d-identity-data-plane-proxies-certs-match-ca for hints</span>
</span></span></code></pre></div><p>If that is the case, simply wait for the <code>upgrade</code> operation to complete. The
stale pods should terminate and be replaced by new ones, configured with the
correct certificates.</p><h2 id=l5d-api class=anchor>The &ldquo;linkerd-api&rdquo; checks
<a href=#l5d-api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=l5d-api-control-ready class=anchor>√ control plane pods are ready
<a href=#l5d-api-control-ready class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane pods are ready
</span></span><span style=display:flex><span>    No running pods <span style=color:#ff7b72>for</span> <span style=color:#a5d6ff>&#34;linkerd-web&#34;</span>
</span></span></code></pre></div><p>Verify the state of the control plane pods with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd get po
</span></span><span style=display:flex><span>NAME                                      READY     STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/linkerd-controller-b8c4c48c8-pflc9    4/4       Running   <span style=color:#a5d6ff>0</span>          45m
</span></span><span style=display:flex><span>pod/linkerd-grafana-776cf777b6-lg2dd      2/2       Running   <span style=color:#a5d6ff>0</span>          1h
</span></span><span style=display:flex><span>pod/linkerd-prometheus-74d66f86f6-6t6dh   2/2       Running   <span style=color:#a5d6ff>0</span>          1h
</span></span><span style=display:flex><span>pod/linkerd-web-5f6c45d6d9-9hd9j          2/2       Running   <span style=color:#a5d6ff>0</span>          3m
</span></span></code></pre></div><h3 id=l5d-api-control-api class=anchor>√ control plane self-check
<a href=#l5d-api-control-api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× control plane self-check
</span></span><span style=display:flex><span>    Post https://localhost:6443/api/v1/namespaces/linkerd/services/linkerd-controller-api:http/proxy/api/v1/SelfCheck: context deadline exceeded
</span></span></code></pre></div><p>Check the logs on the control-plane&rsquo;s public API:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n linkerd linkerd-controller-b8c4c48c8-pflc9 public-api
</span></span></code></pre></div><h3 id=l5d-api-k8s class=anchor>√ [kubernetes] control plane can talk to Kubernetes
<a href=#l5d-api-k8s class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× <span style=color:#ff7b72;font-weight:700>[</span>kubernetes<span style=color:#ff7b72;font-weight:700>]</span> control plane can talk to Kubernetes
</span></span><span style=display:flex><span>    Error calling the Kubernetes API: FAIL
</span></span></code></pre></div><p>Check the logs on the control-plane&rsquo;s public API:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n linkerd linkerd-controller-b8c4c48c8-pflc9 public-api
</span></span></code></pre></div><h3 id=l5d-api-prom class=anchor>√ [prometheus] control plane can talk to Prometheus
<a href=#l5d-api-prom class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× <span style=color:#ff7b72;font-weight:700>[</span>prometheus<span style=color:#ff7b72;font-weight:700>]</span> control plane can talk to Prometheus
</span></span><span style=display:flex><span>    Error calling Prometheus from the control plane: FAIL
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>This will fail if you have changed your default cluster domain from
<code>cluster.local</code>, see the
<a href=https://github.com/linkerd/linkerd2/issues/1720 target=_blank rel=noopener>associated issue</a> for more
information and potential workarounds.</div></div><p>Validate that the Prometheus instance is up and running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd get all | grep prometheus
</span></span></code></pre></div><p>Check the Prometheus logs:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n linkerd linkerd-prometheus-74d66f86f6-6t6dh prometheus
</span></span></code></pre></div><p>Check the logs on the control-plane&rsquo;s public API:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -n linkerd linkerd-controller-b8c4c48c8-pflc9 public-api
</span></span></code></pre></div><h3 id=l5d-tap-api class=anchor>√ tap api service is running
<a href=#l5d-tap-api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× FailedDiscoveryCheck: no response from https://10.233.31.133:443: Get https://10.233.31.133:443: net/http: request canceled <span style=color:#ff7b72>while</span> waiting <span style=color:#ff7b72>for</span> connection <span style=color:#ff7b72;font-weight:700>(</span>Client.Timeout exceeded <span style=color:#ff7b72>while</span> awaiting headers<span style=color:#ff7b72;font-weight:700>)</span>
</span></span></code></pre></div><p>tap uses the
<a href=https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/ target=_blank rel=noopener>kubernetes Aggregated Api-Server model</a>
to allow users to have k8s RBAC on top. This model has the following specific
requirements in the cluster:</p><ul><li>tap Server must be
<a href=https://kubernetes.io/docs/concepts/architecture/master-node-communication/#master-to-cluster target=_blank rel=noopener>reachable from kube-apiserver</a></li><li>The kube-apiserver must be correctly configured to
<a href=https://kubernetes.io/docs/tasks/access-kubernetes-api/configure-aggregation-layer/ target=_blank rel=noopener>enable an aggregation layer</a></li></ul><h2 id=l5d-sp class=anchor>The &ldquo;linkerd-service-profile&rdquo; checks
<a href=#l5d-sp class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ no invalid service profiles
</span></span><span style=display:flex><span>    ServiceProfile <span style=color:#a5d6ff>&#34;bad&#34;</span> has invalid name <span style=color:#ff7b72;font-weight:700>(</span>must be <span style=color:#a5d6ff>&#34;&lt;service&gt;.&lt;namespace&gt;.svc.cluster.local&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span></code></pre></div><p>Validate the structure of your service profiles:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n linkerd get sp
</span></span><span style=display:flex><span>NAME                                               AGE
</span></span><span style=display:flex><span>bad                                                51s
</span></span><span style=display:flex><span>linkerd-controller-api.linkerd.svc.cluster.local   1m
</span></span></code></pre></div><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ no invalid service profiles
</span></span><span style=display:flex><span>    the server could not find the requested resource <span style=color:#ff7b72;font-weight:700>(</span>get serviceprofiles.linkerd.io<span style=color:#ff7b72;font-weight:700>)</span>
</span></span></code></pre></div><p>Validate that the Service Profile CRD is installed on your cluster and that its
<code>linkerd.io/created-by</code> annotation matches your <code>linkerd version</code> client
version:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get crd/serviceprofiles.linkerd.io -o yaml | grep linkerd.io/created-by
</span></span></code></pre></div><p>If the CRD is missing or out-of-date you can update it:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade | kubectl apply -f -
</span></span></code></pre></div><h2 id=l5d-version class=anchor>The &ldquo;linkerd-version&rdquo; checks
<a href=#l5d-version class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=l5d-version-latest class=anchor>√ can determine the latest version
<a href=#l5d-version-latest class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× can determine the latest version
</span></span><span style=display:flex><span>    Get https://versioncheck.linkerd.io/version.json?version<span style=color:#ff7b72;font-weight:700>=</span>edge-19.1.2&amp;<span style=color:#79c0ff>uuid</span><span style=color:#ff7b72;font-weight:700>=</span>test-uuid&amp;<span style=color:#79c0ff>source</span><span style=color:#ff7b72;font-weight:700>=</span>cli: context deadline exceeded
</span></span></code></pre></div><p>Ensure you can connect to the Linkerd version check endpoint from the
environment the <code>linkerd</code> cli is running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl <span style=color:#a5d6ff>&#34;https://versioncheck.linkerd.io/version.json?version=edge-19.1.2&amp;uuid=test-uuid&amp;source=cli&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;stable&#34;</span>:<span style=color:#a5d6ff>&#34;stable-2.1.0&#34;</span>,<span style=color:#a5d6ff>&#34;edge&#34;</span>:<span style=color:#a5d6ff>&#34;edge-19.1.2&#34;</span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=l5d-version-cli class=anchor>√ cli is up-to-date
<a href=#l5d-version-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ cli is up-to-date
</span></span><span style=display:flex><span>    is running version 19.1.1 but the latest edge version is 19.1.2
</span></span></code></pre></div><p>See the page on <a href=../../upgrade/>Upgrading Linkerd</a>.</p><h2 id=l5d-version-control class=anchor>The &ldquo;control-plane-version&rdquo; checks
<a href=#l5d-version-control class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Example failures:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ control plane is up-to-date
</span></span><span style=display:flex><span>    is running version 19.1.1 but the latest edge version is 19.1.2
</span></span><span style=display:flex><span>‼ control plane and cli versions match
</span></span><span style=display:flex><span>    mismatched channels: running stable-2.1.0 but retrieved edge-19.1.2
</span></span></code></pre></div><p>See the page on <a href=../../upgrade/>Upgrading Linkerd</a>.</p><h2 id=l5d-data-plane class=anchor>The &ldquo;linkerd-data-plane&rdquo; checks
<a href=#l5d-data-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks only run when the <code>--proxy</code> flag is set. This flag is intended for
use after running <code>linkerd inject</code>, to verify the injected proxies are operating
normally.</p><h3 id=l5d-data-plane-exists class=anchor>√ data plane namespace exists
<a href=#l5d-data-plane-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ linkerd check --proxy --namespace foo
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>× data plane namespace exists
</span></span><span style=display:flex><span>    The <span style=color:#a5d6ff>&#34;foo&#34;</span> namespace does not exist
</span></span></code></pre></div><p>Ensure the <code>--namespace</code> specified exists, or, omit the parameter to check all
namespaces.</p><h3 id=l5d-data-plane-ready class=anchor>√ data plane proxies are ready
<a href=#l5d-data-plane-ready class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× data plane proxies are ready
</span></span><span style=display:flex><span>    No <span style=color:#a5d6ff>&#34;linkerd-proxy&#34;</span> containers found
</span></span></code></pre></div><p>Ensure you have injected the Linkerd proxy into your application via the
<code>linkerd inject</code> command.</p><p>For more information on <code>linkerd inject</code>, see
<a href=../../getting-started/#step-5-install-the-demo-app>Step 5: Install the demo app</a>
in our <a href=../../getting-started/>Getting Started</a> guide.</p><h3 id=l5d-data-plane-prom class=anchor>√ data plane proxy metrics are present in Prometheus
<a href=#l5d-data-plane-prom class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× data plane proxy metrics are present in Prometheus
</span></span><span style=display:flex><span>    Data plane metrics not found <span style=color:#ff7b72>for</span> linkerd/linkerd-controller-b8c4c48c8-pflc9.
</span></span></code></pre></div><p>Ensure Prometheus can connect to each <code>linkerd-proxy</code> via the Prometheus
dashboard:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd port-forward svc/linkerd-prometheus <span style=color:#a5d6ff>9090</span>
</span></span></code></pre></div><p>&mldr;and then browse to
<a href=http://localhost:9090/targets target=_blank rel=noopener>http://localhost:9090/targets</a>, validate the
<code>linkerd-proxy</code> section.</p><p>You should see all your pods here. If they are not:</p><ul><li>Prometheus might be experiencing connectivity issues with the k8s api server.
Check out the logs and delete the pod to flush any possible transient errors.</li></ul><h3 id=l5d-data-plane-version class=anchor>√ data plane is up-to-date
<a href=#l5d-data-plane-version class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ data plane is up-to-date
</span></span><span style=display:flex><span>    linkerd/linkerd-prometheus-74d66f86f6-6t6dh: is running version 19.1.2 but the latest edge version is 19.1.3
</span></span></code></pre></div><p>See the page on <a href=../../upgrade/>Upgrading Linkerd</a>.</p><h3 id=l5d-data-plane-cli-version class=anchor>√ data plane and cli versions match
<a href=#l5d-data-plane-cli-version class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ data plane and cli versions match
</span></span><span style=display:flex><span>    linkerd/linkerd-web-5f6c45d6d9-9hd9j: is running version 19.1.2 but the latest edge version is 19.1.3
</span></span></code></pre></div><p>See the page on <a href=../../upgrade/>Upgrading Linkerd</a>.</p><h2 id=l5d-ha class=anchor>The &ldquo;linkerd-ha-checks&rdquo; checks
<a href=#l5d-ha class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks are ran if Linkerd has been installed in HA mode.</p><h3 id=l5d-injection-disabled class=anchor>√ pod injection disabled on kube-system
<a href=#l5d-injection-disabled class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example warning:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ pod injection disabled on kube-system
</span></span><span style=display:flex><span>    kube-system namespace needs to have the label config.linkerd.io/admission-webhooks: disabled <span style=color:#ff7b72>if</span> HA mode is enabled
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-injection-disabled <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure the kube-system namespace has the
<code>config.linkerd.io/admission-webhooks:disabled</code> label:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get namespace kube-system -oyaml
</span></span><span style=display:flex><span>kind: Namespace
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: kube-system
</span></span><span style=display:flex><span>  annotations:
</span></span><span style=display:flex><span>    linkerd.io/inject: disabled
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    config.linkerd.io/admission-webhooks: disabled
</span></span></code></pre></div><h3 id=l5d-control-plane-replicas class=anchor>√ multiple replicas of control plane pods
<a href=#l5d-control-plane-replicas class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example warning:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ multiple replicas of control plane pods
</span></span><span style=display:flex><span>    not enough replicas available <span style=color:#ff7b72>for</span> <span style=color:#ff7b72;font-weight:700>[</span>linkerd-controller<span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-control-plane-replicas <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This happens when one of the control plane pods doesn&rsquo;t have at least two
replicas running. This is likely caused by insufficient node resources.</p><h2 id=l5d-cni class=anchor>The &ldquo;linkerd-cni-plugin&rdquo; checks
<a href=#l5d-cni class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks run if Linkerd has been installed with the <code>--linkerd-cni-enabled</code>
flag. Alternatively they can be run as part of the pre-checks by providing the
<code>--linkerd-cni-enabled</code> flag. Most of these checks verify that the required
resources are in place. If any of them are missing, you can use
<code>linkerd install-cni | kubectl apply -f -</code> to re-install them.</p><h3 id=cni-plugin-cm-exists class=anchor>√ cni plugin ConfigMap exists
<a href=#cni-plugin-cm-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin ConfigMap exists
</span></span><span style=display:flex><span>    configmaps <span style=color:#a5d6ff>&#34;linkerd-cni-config&#34;</span> not found
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-cm-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the linkerd-cni-config ConfigMap exists in the CNI namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get cm linkerd-cni-config -n linkerd-cni
</span></span><span style=display:flex><span>NAME                      PRIV    CAPS   SELINUX    RUNASUSER   FSGROUP    SUPGROUP   READONLYROOTFS   VOLUMES
</span></span><span style=display:flex><span>linkerd-linkerd-cni-cni   false          RunAsAny   RunAsAny    RunAsAny   RunAsAny   false            hostPath,secret
</span></span></code></pre></div><p>Also ensure you have permission to create ConfigMaps:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ConfigMaps
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-psp-exists class=anchor>√ cni plugin PodSecurityPolicy exists
<a href=#cni-plugin-psp-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin PodSecurityPolicy exists
</span></span><span style=display:flex><span>    missing PodSecurityPolicy: linkerd-linkerd-cni-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-psp-exists <span style=color:#ff7b72>for</span> hint
</span></span></code></pre></div><p>Ensure that the pod security policy exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get psp linkerd-linkerd-cni-cni
</span></span><span style=display:flex><span>NAME                      PRIV    CAPS   SELINUX    RUNASUSER   FSGROUP    SUPGROUP   READONLYROOTFS   VOLUMES
</span></span><span style=display:flex><span>linkerd-linkerd-cni-cni   false          RunAsAny   RunAsAny    RunAsAny   RunAsAny   false            hostPath,secret
</span></span></code></pre></div><p>Also ensure you have permission to create PodSecurityPolicies:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create PodSecurityPolicies
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-cr-exists class=anchor>√ cni plugin ClusterRole exist
<a href=#cni-plugin-cr-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin ClusterRole exists
</span></span><span style=display:flex><span>    missing ClusterRole: linkerd-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-cr-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the cluster role exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterrole linkerd-cni
</span></span><span style=display:flex><span>NAME          AGE
</span></span><span style=display:flex><span>linkerd-cni   54m
</span></span></code></pre></div><p>Also ensure you have permission to create ClusterRoles:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ClusterRoles
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-crb-exists class=anchor>√ cni plugin ClusterRoleBinding exist
<a href=#cni-plugin-crb-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin ClusterRoleBinding exists
</span></span><span style=display:flex><span>    missing ClusterRoleBinding: linkerd-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-crb-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the cluster role binding exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterrolebinding linkerd-cni
</span></span><span style=display:flex><span>NAME          AGE
</span></span><span style=display:flex><span>linkerd-cni   54m
</span></span></code></pre></div><p>Also ensure you have permission to create ClusterRoleBindings:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ClusterRoleBindings
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-r-exists class=anchor>√ cni plugin Role exists
<a href=#cni-plugin-r-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin Role exists
</span></span><span style=display:flex><span>    missing Role: linkerd-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-r-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the role exists in the CNI namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get role linkerd-cni -n linkerd-cni
</span></span><span style=display:flex><span>NAME          AGE
</span></span><span style=display:flex><span>linkerd-cni   52m
</span></span></code></pre></div><p>Also ensure you have permission to create Roles:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create Roles -n linkerd-cni
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-rb-exists class=anchor>√ cni plugin RoleBinding exists
<a href=#cni-plugin-rb-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin RoleBinding exists
</span></span><span style=display:flex><span>    missing RoleBinding: linkerd-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-rb-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the role binding exists in the CNI namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get rolebinding linkerd-cni -n linkerd-cni
</span></span><span style=display:flex><span>NAME          AGE
</span></span><span style=display:flex><span>linkerd-cni   49m
</span></span></code></pre></div><p>Also ensure you have permission to create RoleBindings:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create RoleBindings -n linkerd-cni
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-sa-exists class=anchor>√ cni plugin ServiceAccount exists
<a href=#cni-plugin-sa-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin ServiceAccount exists
</span></span><span style=display:flex><span>    missing ServiceAccount: linkerd-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-sa-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the CNI service account exists in the CNI namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get ServiceAccount linkerd-cni -n linkerd-cni
</span></span><span style=display:flex><span>NAME          SECRETS   AGE
</span></span><span style=display:flex><span>linkerd-cni   <span style=color:#a5d6ff>1</span>         45m
</span></span></code></pre></div><p>Also ensure you have permission to create ServiceAccount:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ServiceAccounts -n linkerd-cni
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-ds-exists class=anchor>√ cni plugin DaemonSet exists
<a href=#cni-plugin-ds-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× cni plugin DaemonSet exists
</span></span><span style=display:flex><span>    missing DaemonSet: linkerd-cni
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-ds-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the CNI daemonset exists in the CNI namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get ds -n linkerd-cni
</span></span><span style=display:flex><span>NAME          DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                 AGE
</span></span><span style=display:flex><span>linkerd-cni   <span style=color:#a5d6ff>1</span>         <span style=color:#a5d6ff>1</span>         <span style=color:#a5d6ff>1</span>       <span style=color:#a5d6ff>1</span>            <span style=color:#a5d6ff>1</span>           beta.kubernetes.io/os<span style=color:#ff7b72;font-weight:700>=</span>linux   14m
</span></span></code></pre></div><p>Also ensure you have permission to create DaemonSets:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create DaemonSets -n linkerd-cni
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=cni-plugin-ready class=anchor>√ cni plugin pod is running on all nodes
<a href=#cni-plugin-ready class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example failure:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ cni plugin pod is running on all nodes
</span></span><span style=display:flex><span>    number ready: 2, number scheduled: <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#cni-plugin-ready
</span></span></code></pre></div><p>Ensure that all the CNI pods are running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get po -n linkerd-cn
</span></span><span style=display:flex><span>NAME                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>linkerd-cni-rzp2q   1/1     Running   <span style=color:#a5d6ff>0</span>          9m20s
</span></span><span style=display:flex><span>linkerd-cni-mf564   1/1     Running   <span style=color:#a5d6ff>0</span>          9m22s
</span></span><span style=display:flex><span>linkerd-cni-p5670   1/1     Running   <span style=color:#a5d6ff>0</span>          9m25s
</span></span></code></pre></div><p>Ensure that all pods have finished the deployment of the CNI config and binary:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl logs linkerd-cni-rzp2q -n linkerd-cni
</span></span><span style=display:flex><span>Wrote linkerd CNI binaries to /host/opt/cni/bin
</span></span><span style=display:flex><span>Created CNI config /host/etc/cni/net.d/10-kindnet.conflist
</span></span><span style=display:flex><span>Done configuring CNI. <span style=color:#79c0ff>Sleep</span><span style=color:#ff7b72;font-weight:700>=</span>true
</span></span></code></pre></div><h2 id=l5d-multicluster class=anchor>The &ldquo;linkerd-multicluster checks
<a href=#l5d-multicluster class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>These checks run if the service mirroring controller has been installed.
Additionally they can be ran if <code>--multicluster</code> flag is specified explicitly.
Most of these checks verify that the service mirroring controller is working
correctly. Furthermore the checks ensure that end to end TLS is possible between
paired clusters.</p><h3 id=l5d-multicluster-service-mirror-running class=anchor>√ service mirror controller is running
<a href=#l5d-multicluster-service-mirror-running class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller is running
</span></span><span style=display:flex><span>    Service mirror controller is not present
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-service-mirror-running <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Note, it takes a little bit for pods to be scheduled, images to be pulled and
everything to start up. If this is a permanent error, you&rsquo;ll want to validate
the state of the controller pod with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl --all-namespaces get po --selector linkerd.io/control-plane-component<span style=color:#ff7b72;font-weight:700>=</span>linkerd-service-mirror
</span></span><span style=display:flex><span>NAME                                  READY     STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>linkerd-service-mirror-7bb8ff5967-zg265   2/2       Running   <span style=color:#a5d6ff>0</span>          50m
</span></span></code></pre></div><h3 id=l5d-multicluster-cluster-role-exists class=anchor>√ service mirror controller ClusterRoles exists
<a href=#l5d-multicluster-cluster-role-exists class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller ClusterRoles exists
</span></span><span style=display:flex><span>    missing ClusterRoles: linkerd-service-mirror-access-local-resources
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-cluster-role-exists <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the cluster role exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterrole linkerd-service-mirror-access-local-resources
</span></span><span style=display:flex><span>NAME                                            AGE
</span></span><span style=display:flex><span>linkerd-service-mirror-access-local-resources   54m
</span></span></code></pre></div><p>Also ensure you have permission to create ClusterRoles:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ClusterRoles
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-multicluster-cluster-role-binding-exist class=anchor>√ service mirror controller ClusterRoleBindings exist
<a href=#l5d-multicluster-cluster-role-binding-exist class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller ClusterRoleBindings exist
</span></span><span style=display:flex><span>    missing ClusterRoleBindings: linkerd-service-mirror-access-local-resources
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-cluster-role-binding-exist <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the cluster role bindings exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterrolebindings linkerd-service-mirror-access-local-resources
</span></span><span style=display:flex><span>NAME                                            AGE
</span></span><span style=display:flex><span>linkerd-service-mirror-access-local-resources   54m
</span></span></code></pre></div><p>Also ensure you have permission to create ClusterRoleBindings:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ClusterRoleBindings
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-multicluster-role-exist class=anchor>√ service mirror controller Roles exist
<a href=#l5d-multicluster-role-exist class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller Roles exist
</span></span><span style=display:flex><span>    missing Roles: linkerd-service-mirror-read-remote-creds
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-role-exist <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the role exists in the service mirror controller namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get role linkerd-service-mirror-read-remote-creds -n linkerd-multicluster
</span></span><span style=display:flex><span>NAME                                       AGE
</span></span><span style=display:flex><span>linkerd-service-mirror-read-remote-creds   12m
</span></span></code></pre></div><p>Also ensure you have permission to create Roles:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create Roles -n linkerd-multicluster
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-multicluster-role-binding-exist class=anchor>√ service mirror controller RoleBindings exist
<a href=#l5d-multicluster-role-binding-exist class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller RoleBindings exist
</span></span><span style=display:flex><span>    missing RoleBindings: linkerd-service-mirror-read-remote-creds
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-role-binding-exist <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the role binding exists in service mirror controller namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get rolebinding linkerd-service-mirror-read-remote-creds -n linkerd-multicluster
</span></span><span style=display:flex><span>NAME                                       AGE
</span></span><span style=display:flex><span>linkerd-service-mirror-read-remote-creds   19m
</span></span></code></pre></div><p>Also ensure you have permission to create RoleBindings:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create RoleBindings -n linkerd-multicluster
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-multicluster-service-account-exist class=anchor>√ service mirror controller ServiceAccounts exist
<a href=#l5d-multicluster-service-account-exist class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller ServiceAccounts exist
</span></span><span style=display:flex><span>    missing ServiceAccounts: linkerd-service-mirror
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-service-account-exist <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Ensure that the linkerd-service-mirror service account exists:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get ServiceAccount linkerd-service-mirror -n linkerd-multicluster
</span></span><span style=display:flex><span>NAME                     SECRETS   AGE
</span></span><span style=display:flex><span>linkerd-service-mirror   <span style=color:#a5d6ff>1</span>         45m
</span></span></code></pre></div><p>Also ensure you have permission to create ServiceAccount:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i create ServiceAccounts -n linkerd-multicluster
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><h3 id=l5d-multicluster-local-rbac-correct class=anchor>√ service mirror controller has required permissions
<a href=#l5d-multicluster-local-rbac-correct class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller has required permissions
</span></span><span style=display:flex><span>    missing Service mirror ClusterRole linkerd-service-mirror-access-local-resources: unexpected verbs expected create,delete,get,list,update,watch, got create,delete,get,update,watch
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-local-rbac-correct <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This error indicates that the local RBAC permissions of the service mirror
service account are not correct. In order to ensure that you have the correct
verbs and resources you can inspect your ClusterRole and Role object and look at
the rules section.</p><p>Expected rules for <code>linkerd-service-mirror-access-local-resources</code> cluster role:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl  --context<span style=color:#ff7b72;font-weight:700>=</span>local get clusterrole linkerd-service-mirror-access-local-resources -o yaml
</span></span><span style=display:flex><span>kind: ClusterRole
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    linkerd.io/control-plane-component: linkerd-service-mirror
</span></span><span style=display:flex><span>  name: linkerd-service-mirror-access-local-resources
</span></span><span style=display:flex><span>rules:
</span></span><span style=display:flex><span>- apiGroups:
</span></span><span style=display:flex><span>  - <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>  - endpoints
</span></span><span style=display:flex><span>  - services
</span></span><span style=display:flex><span>  verbs:
</span></span><span style=display:flex><span>  - list
</span></span><span style=display:flex><span>  - get
</span></span><span style=display:flex><span>  - watch
</span></span><span style=display:flex><span>  - create
</span></span><span style=display:flex><span>  - delete
</span></span><span style=display:flex><span>  - update
</span></span><span style=display:flex><span>- apiGroups:
</span></span><span style=display:flex><span>  - <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>  - namespaces
</span></span><span style=display:flex><span>  verbs:
</span></span><span style=display:flex><span>  - create
</span></span><span style=display:flex><span>  - list
</span></span><span style=display:flex><span>  - get
</span></span><span style=display:flex><span>  - watch
</span></span></code></pre></div><p>Expected rules for <code>linkerd-service-mirror-read-remote-creds</code> role:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl  --context<span style=color:#ff7b72;font-weight:700>=</span>local get role linkerd-service-mirror-read-remote-creds -n linkerd-multicluster  -o yaml
</span></span><span style=display:flex><span>kind: Role
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  labels:
</span></span><span style=display:flex><span>    linkerd.io/control-plane-component: linkerd-service-mirror
</span></span><span style=display:flex><span>  name: linkerd-service-mirror-read-remote-creds
</span></span><span style=display:flex><span>  namespace: linkerd-multicluster
</span></span><span style=display:flex><span>  rules:
</span></span><span style=display:flex><span>- apiGroups:
</span></span><span style=display:flex><span>  - <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>  - secrets
</span></span><span style=display:flex><span>  verbs:
</span></span><span style=display:flex><span>  - list
</span></span><span style=display:flex><span>  - get
</span></span><span style=display:flex><span>  - watch
</span></span></code></pre></div><h3 id=l5d-smc-remote-remote-clusters-access class=anchor>√ service mirror controller can access remote clusters
<a href=#l5d-smc-remote-remote-clusters-access class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× service mirror controller can access remote clusters
</span></span><span style=display:flex><span>    Problematic clusters:
</span></span><span style=display:flex><span>        * cluster: <span style=color:#ff7b72;font-weight:700>[</span>remote<span style=color:#ff7b72;font-weight:700>]</span>: Insufficient Service permissions: expected get,list,watch, got list,watch
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-smc-remote-remote-clusters-access <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>In case you get an error of that nature you need to ensure that the ClusterRole
in the remote cluster has sufficient permissions for the service mirroring
controller to work correctly:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl --context<span style=color:#ff7b72;font-weight:700>=</span>remote get  clusterrole linkerd-service-mirror-remote-access  -n linkerd-multicluster -o yaml
</span></span><span style=display:flex><span>kind: ClusterRole
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: linkerd-service-mirror-remote-access
</span></span><span style=display:flex><span>rules:
</span></span><span style=display:flex><span>- apiGroups:
</span></span><span style=display:flex><span>  - <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>  - services
</span></span><span style=display:flex><span>  verbs:
</span></span><span style=display:flex><span>  - get
</span></span><span style=display:flex><span>  - list
</span></span><span style=display:flex><span>  - watch
</span></span><span style=display:flex><span>- apiGroups:
</span></span><span style=display:flex><span>  - <span style=color:#a5d6ff>&#34;&#34;</span>
</span></span><span style=display:flex><span>  resourceNames:
</span></span><span style=display:flex><span>  - linkerd-config
</span></span><span style=display:flex><span>  resources:
</span></span><span style=display:flex><span>  - configmaps
</span></span><span style=display:flex><span>  verbs:
</span></span><span style=display:flex><span>  - get
</span></span></code></pre></div><h3 id=l5d-multicluster-remote-gateways-alive class=anchor>√ all remote cluster gateways are alive
<a href=#l5d-multicluster-remote-gateways-alive class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example error:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× all remote cluster gateways are alive
</span></span><span style=display:flex><span>    Some gateways are not alive:
</span></span><span style=display:flex><span>        * cluster: <span style=color:#ff7b72;font-weight:700>[</span>remote<span style=color:#ff7b72;font-weight:700>]</span>, gateway: <span style=color:#ff7b72;font-weight:700>[</span>linkerd-multicluster/linkerd-gateway<span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-remote-gateways-alive
</span></span></code></pre></div><p>If you get such an error, you might want to check the logs of your cluster
gateway on the <code>remote</code> cluster by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl --context<span style=color:#ff7b72;font-weight:700>=</span>remote  logs &lt;linkerd-gatewa-pod&gt;  nginx  -n linkerd-multicluster  -f
</span></span></code></pre></div><p>Additionally it is worth checking the logs of the proxy for any errors:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl --context<span style=color:#ff7b72;font-weight:700>=</span>remote  logs &lt;linkerd-gatewa-pod&gt;  proxy  -n linkerd-multicluster  -f
</span></span></code></pre></div><h3 id=l5d-multicluster-clusters-share-anchors class=anchor>√ clusters share trust anchors
<a href=#l5d-multicluster-clusters-share-anchors class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example errors:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× clusters share trust anchors
</span></span><span style=display:flex><span>    Problematic clusters:
</span></span><span style=display:flex><span>        * remote
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-clusters-share-anchors <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>The error above indicates that your trust anchors are not compatible. In order
to fix that you need to ensure that both your anchors contain identical sets of
certificates.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>× clusters share trust anchors
</span></span><span style=display:flex><span>    Problematic clusters:
</span></span><span style=display:flex><span>        * remote: cannot parse trust anchors
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-clusters-share-anchors <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>Such an error indicates that there is a problem with your anchors on the cluster
named <code>remote</code> You need to make sure the identity config aspect of your Linkerd
installation on the <code>remote</code> cluster is ok. You can run <code>check</code> against the
remote cluster to verify that:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd --context<span style=color:#ff7b72;font-weight:700>=</span>remote check
</span></span></code></pre></div><h3 id=l5d-multicluster-daisy-chaining class=anchor>√ multicluster daisy chaining is avoided
<a href=#l5d-multicluster-daisy-chaining class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example errors:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ multicluster daisy chaining is avoided
</span></span><span style=display:flex><span>    * mirror service backend-one-svc-remote.multicluster-test is exported
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-daisy-chaining <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>This error indicates that a mirror service has been exported, causing a &ldquo;daisy
chain&rdquo; where requests can come in to the cluster through the local gateway and
be immediately sent out of the cluster to a target gateway. If the target
gateway is in the source cluster, this can create an infinite loop.</p><p>Similarly, if an exported service routes to a mirror service by a traffic split,
the same daisy chain effect occurs.</p><h3 id=l5d-multicluster-services-endpoints class=anchor>√ all mirror services have endpoints
<a href=#l5d-multicluster-services-endpoints class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example errors:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ all mirror services have endpoints
</span></span><span style=display:flex><span>    Some mirror services <span style=color:#ff7b72>do</span> not have endpoints:
</span></span><span style=display:flex><span>  voting-svc-gke.emojivoto mirrored from cluster <span style=color:#ff7b72;font-weight:700>[</span>gke<span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#ff7b72;font-weight:700>(</span>gateway: <span style=color:#ff7b72;font-weight:700>[</span>linkerd-multicluster/linkerd-gateway<span style=color:#ff7b72;font-weight:700>])</span>
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-services-endpoints <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>The error above indicates that some mirror services in the source cluster do not
have associated endpoints resources. These endpoints are created by the Linkerd
service mirror controller when creating a mirror service with endpoints values
as the remote gateway&rsquo;s external IP.</p><p>Such an error indicates that there could be a problem with the creation of the
mirror resources by the service mirror controller or the mirror gateway service
in the source cluster or the external IP of the gateway service in target
cluster.</p><h3 id=l5d-multicluster-gateways-endpoints class=anchor>√ all gateway mirrors have endpoints
<a href=#l5d-multicluster-gateways-endpoints class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Example errors:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ all gateway mirrors have endpoints
</span></span><span style=display:flex><span>    Some gateway mirrors <span style=color:#ff7b72>do</span> not have endpoints:
</span></span><span style=display:flex><span>  linkerd-gateway-gke.linkerd-multicluster mirrored from cluster <span style=color:#ff7b72;font-weight:700>[</span>gke<span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-gateways-endpoints <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>The error above indicates that some gateway mirror services in the source
cluster do not have associated endpoints resources. These endpoints are created
by the Linkerd service mirror controller on the source cluster whenever a link
is established with a target cluster.</p><p>Such an error indicates that there could be a problem with the creation of the
resources by the service mirror controller or the external IP of the gateway
service in target cluster.</p><h3 id=l5d-multicluster-gateways-exist class=anchor>√ all referenced/cluster gateways are valid
<a href=#l5d-multicluster-gateways-exist class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This check is used to validate gateways. These are performed perform both at the
source cluster using the kube-configs of the linked remote clusters, and also at
the target cluster directly(if there are any exported services present).</p><p>Example errors:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ remote: all referenced gateways are valid
</span></span><span style=display:flex><span>    * southeastasia: remote cluster has invalid gateways:
</span></span><span style=display:flex><span>      Exported service web-svc.emojivoto references a gateway with no external IP: linkerd-gateway.linkerd-multicluster
</span></span><span style=display:flex><span>      Exported service web-svc.emojivoto references a gateway that is missing port mc-gateway: linkerd-gateway.linkerd-multicluster
</span></span><span style=display:flex><span>    * gke-two: remote cluster has invalid gateways:
</span></span><span style=display:flex><span>      Exported service voting-svc.emojivoto references a gateway that does not exist: linkerd-gateway.linkerd-multicluster
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-gateways-exist <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>A gateway is considered valid if it exists, has a external IP, and does not have
any mis-configured ports.</p><p>A Linkerd gateway service should have the following ports exposed i.e
<code>mc-gateway</code> and <code>mc-probe</code>, which are used to pass requests and check health
respectively.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‼ all cluster gateways are valid
</span></span><span style=display:flex><span>    Some gateway services <span style=color:#ff7b72>do</span> not have endpoints:
</span></span><span style=display:flex><span>    linkerd-gateway.linkerd-multicluster
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-multicluster-gateways-exist <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div><p>If the check is performed on the target cluster, It also reports if the relevant
endpoints resource for the gateway service is absent.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>