<!doctype html><html lang=en><head><meta charset=utf-8><title>Getting started with Linkerd SMI extension | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Use Linkerd SMI extension to work with Service Mesh Interface(SMI) resources."><meta property="og:url" content="https://travisbeckham.github.io/2.11/tasks/linkerd-smi/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Getting started with Linkerd SMI extension"><meta property="og:description" content="Use Linkerd SMI extension to work with Service Mesh Interface(SMI) resources."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.11"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Getting started with Linkerd SMI extension"><meta name=twitter:description content="Use Linkerd SMI extension to work with Service Mesh Interface(SMI) resources."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.11/tasks/linkerd-smi/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/ selected>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2.11/overview/>Overview</a></li><li><a href=/2.11/getting-started/>Getting Started</a></li><li><a href=/2.11/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-00ef7d1751a09ab18b1a0e3672bd135a>
<label class=toggle__label for=toggle-00ef7d1751a09ab18b1a0e3672bd135a><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.11/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.11/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.11/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.11/features/ingress/>Ingress</a></li><li><a href=/2.11/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.11/features/load-balancing/>Load Balancing</a></li><li><a href=/2.11/features/server-policy/>Authorization Policy</a></li><li><a href=/2.11/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.11/features/cni/>CNI Plugin</a></li><li><a href=/2.11/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.11/features/fault-injection/>Fault Injection</a></li><li><a href=/2.11/features/ha/>High Availability</a></li><li><a href=/2.11/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.11/features/dashboard/>On-cluster metrics stack</a></li><li><a href=/2.11/features/service-profiles/>Service Profiles</a></li><li><a href=/2.11/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.11/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-7b9227afccfad80ce551f98ae9468000 checked>
<label class=toggle__label for=toggle-7b9227afccfad80ce551f98ae9468000><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.11/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.11/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.11/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.11/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.11/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.11/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.11/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.11/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.11/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.11/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.11/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.11/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.11/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.11/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.11/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.11/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.11/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.11/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li class=docs__nav--selected><a href=/2.11/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.11/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.11/tasks/grafana/>Grafana</a></li><li><a href=/2.11/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.11/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.11/tasks/install/>Installing Linkerd</a></li><li><a href=/2.11/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.11/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.11/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.11/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.11/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.11/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.11/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.11/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.11/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.11/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.11/tasks/securing-your-cluster/>Securing Your Cluster</a></li><li><a href=/2.11/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.11/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.11/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.11/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.11/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.11/tasks/upgrade-multicluster/>Upgrading Multicluster in Linkerd 2.9</a></li><li><a href=/2.11/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.11/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.11/tasks/extensions/>Using extensions</a></li><li><a href=/2.11/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.11/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.11/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.11/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-951a8405bc0d2ef0503c27bdaa20c05b>
<label class=toggle__label for=toggle-951a8405bc0d2ef0503c27bdaa20c05b><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/reference/architecture/>Architecture</a></li><li><a href=/2.11/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.11/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-5ab67513e4905c4b33f4cb426c02718f>
<label class=toggle__label for=toggle-5ab67513e4905c4b33f4cb426c02718f><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/reference/cli/authz/>authz</a></li><li><a href=/2.11/reference/cli/check/>check</a></li><li><a href=/2.11/reference/cli/completion/>completion</a></li><li><a href=/2.11/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.11/reference/cli/identity/>identity</a></li><li><a href=/2.11/reference/cli/inject/>inject</a></li><li><a href=/2.11/reference/cli/install/>install</a></li><li><a href=/2.11/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.11/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.11/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.11/reference/cli/profile/>profile</a></li><li><a href=/2.11/reference/cli/repair/>repair</a></li><li><a href=/2.11/reference/cli/uninject/>uninject</a></li><li><a href=/2.11/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.11/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.11/reference/cli/version/>version</a></li><li><a href=/2.11/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.11/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.11/reference/extension-list/>Extensions List</a></li><li><a href=/2.11/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.11/reference/iptables/>IPTables Reference</a></li><li><a href=/2.11/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.11/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.11/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.11/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Getting started with Linkerd SMI extension</h1></div><div class="docs__content prose"><p><a href=https://smi-spec.io/ target=_blank rel=noopener>Service Mesh Interface</a> is a standard interface for
service meshes on Kubernetes. It defines a set of resources that could be
used across service meshes that implement it.
You can read more about it in the <a href=https://github.com/servicemeshinterface/smi-spec target=_blank rel=noopener>specification</a></p><p>Currently, Linkerd supports SMI&rsquo;s <code>TrafficSplit</code> specification which can be
used to perform traffic splitting across services natively. This means that
you can apply the SMI resources without any additional
components/configuration but this obviously has some downsides, as
Linkerd may not be able to add extra specific configurations specific to it,
as SMI is more like a lowest common denominator of service mesh functionality.</p><p>To get around these problems, Linkerd can instead have an adaptor that converts
SMI specifications into native Linkerd configurations that it can understand
and perform the operation. This also removes the extra native coupling with SMI
resources with the control-plane, and the adaptor can move independently and
have it&rsquo;s own release cycle. <a href=https://www.github.com/linkerd/linkerd-smi target=_blank rel=noopener>Linkerd SMI</a>
is an extension that does just that.</p><p>This guide will walk you through installing the SMI extension and configuring
a <code>TrafficSplit</code> specification, to perform Traffic Splitting across services.</p><h2 id=prerequisites class=anchor>Prerequisites
<a href=#prerequisites class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><ul><li>To use this guide, you&rsquo;ll need to have Linkerd installed on your cluster.
Follow the <a href=../install/>Installing Linkerd Guide</a> if you haven&rsquo;t
already done this.</li></ul><h2 id=install-the-linkerd-smi-extension class=anchor>Install the Linkerd-SMI extension
<a href=#install-the-linkerd-smi-extension class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=cli class=anchor>CLI
<a href=#cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Install the SMI extension CLI binary by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://linkerd.github.io/linkerd-smi/install | sh
</span></span></code></pre></div><p>Alternatively, you can download the CLI directly via the <a href=https://github.com/linkerd/linkerd-smi/releases target=_blank rel=noopener>releases page</a>.</p><p>The first step is installing the Linkerd-SMI extension onto your cluster.
This extension consists of a SMI-Adaptor which converts SMI resources into
native Linkerd resources.</p><p>To install the Linkerd-SMI extension, run the command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd smi install | kubectl apply -f -
</span></span></code></pre></div><p>You can verify that the Linkerd-SMI extension was installed correctly by
running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd smi check
</span></span></code></pre></div><h3 id=helm class=anchor>Helm
<a href=#helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>To install the <code>linkerd-smi</code> Helm chart, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add l5d-smi https://linkerd.github.io/linkerd-smi
</span></span><span style=display:flex><span>helm install l5d-smi/linkerd-smi --generate-name
</span></span></code></pre></div><h2 id=install-sample-application class=anchor>Install Sample Application
<a href=#install-sample-application class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>First, let&rsquo;s install the sample application.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># create a namespace for the sample application</span>
</span></span><span style=display:flex><span>kubectl create namespace trafficsplit-sample
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># install the sample application</span>
</span></span><span style=display:flex><span>linkerd inject https://raw.githubusercontent.com/linkerd/linkerd2/main/test/integration/viz/trafficsplit/testdata/application.yaml | kubectl -n trafficsplit-sample apply -f -
</span></span></code></pre></div><p>This installs a simple client, and two server deployments.
One of the server deployments i.e <code>failing-svc</code> always returns a 500 error,
and the other one i.e <code>backend-svc</code> always returns a 200.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get deployments -n trafficsplit-sample
</span></span><span style=display:flex><span>NAME          READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>backend       1/1     <span style=color:#a5d6ff>1</span>            <span style=color:#a5d6ff>1</span>           2m29s
</span></span><span style=display:flex><span>failing       1/1     <span style=color:#a5d6ff>1</span>            <span style=color:#a5d6ff>1</span>           2m29s
</span></span><span style=display:flex><span>slow-cooker   1/1     <span style=color:#a5d6ff>1</span>            <span style=color:#a5d6ff>1</span>           2m29s
</span></span></code></pre></div><p>By default, the client will hit the <code>backend-svc</code>service. This is evident by
the <code>edges</code> sub command.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz edges deploy -n trafficsplit-sample
</span></span><span style=display:flex><span>SRC           DST           SRC_NS                DST_NS                SECURED
</span></span><span style=display:flex><span>prometheus    backend       linkerd-viz           trafficsplit-sample   √
</span></span><span style=display:flex><span>prometheus    failing       linkerd-viz           trafficsplit-sample   √
</span></span><span style=display:flex><span>prometheus    slow-cooker   linkerd-viz           trafficsplit-sample   √
</span></span><span style=display:flex><span>slow-cooker   backend       trafficsplit-sample   trafficsplit-sample   √
</span></span></code></pre></div><h2 id=configuring-a-trafficsplit class=anchor>Configuring a TrafficSplit
<a href=#configuring-a-trafficsplit class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Now, Let&rsquo;s apply a <code>TrafficSplit</code> resource to perform Traffic Splitting on the
<code>backend-svc</code> to distribute load between it and the <code>failing-svc</code>.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#a5d6ff>&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>apiVersion: split.smi-spec.io/v1alpha2
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>kind: TrafficSplit
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>metadata:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  name: backend-split
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  namespace: trafficsplit-sample
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>spec:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  service: backend-svc
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  backends:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  - service: backend-svc
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    weight: 500
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  - service: failing-svc
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    weight: 500
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>EOF</span>
</span></span></code></pre></div><p>Because the <code>smi-adaptor</code> watches for <code>TrafficSplit</code> resources, it will
automatically create a respective <code>ServiceProfile</code> resource to perform
the same. This can be verified by retrieving the <code>ServiceProfile</code> resource.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe serviceprofile -n trafficsplit-sample
</span></span><span style=display:flex><span>Name:         backend-svc.trafficsplit-sample.svc.cluster.local
</span></span><span style=display:flex><span>Namespace:    trafficsplit-sample
</span></span><span style=display:flex><span>Labels:       &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:  &lt;none&gt;
</span></span><span style=display:flex><span>API Version:  linkerd.io/v1alpha2
</span></span><span style=display:flex><span>Kind:         ServiceProfile
</span></span><span style=display:flex><span>Metadata:
</span></span><span style=display:flex><span>  Creation Timestamp:  2021-08-02T12:42:52Z
</span></span><span style=display:flex><span>  Generation:          <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>  Managed Fields:
</span></span><span style=display:flex><span>    API Version:  linkerd.io/v1alpha2
</span></span><span style=display:flex><span>    Fields Type:  FieldsV1
</span></span><span style=display:flex><span>    fieldsV1:
</span></span><span style=display:flex><span>      f:spec:
</span></span><span style=display:flex><span>        .:
</span></span><span style=display:flex><span>        f:dstOverrides:
</span></span><span style=display:flex><span>    Manager:         smi-adaptor
</span></span><span style=display:flex><span>    Operation:       Update
</span></span><span style=display:flex><span>    Time:            2021-08-02T12:42:52Z
</span></span><span style=display:flex><span>  Resource Version:  <span style=color:#a5d6ff>3542</span>
</span></span><span style=display:flex><span>  UID:               cbcdb74f-07e0-42f0-a7a8-9bbcf5e0e54e
</span></span><span style=display:flex><span>Spec:
</span></span><span style=display:flex><span>  Dst Overrides:
</span></span><span style=display:flex><span>    Authority:  backend-svc.trafficsplit-sample.svc.cluster.local
</span></span><span style=display:flex><span>    Weight:     <span style=color:#a5d6ff>500</span>
</span></span><span style=display:flex><span>    Authority:  failing-svc.trafficsplit-sample.svc.cluster.local
</span></span><span style=display:flex><span>    Weight:     <span style=color:#a5d6ff>500</span>
</span></span><span style=display:flex><span>Events:         &lt;none&gt;
</span></span></code></pre></div><p>As we can see, A relevant <code>ServiceProfile</code> with <code>DstOverrides</code> has
been created to perform the TrafficSplit.</p><p>The Traffic Splitting can be verified by running the <code>edges</code> command.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz edges deploy -n trafficsplit-sample
</span></span><span style=display:flex><span>SRC           DST           SRC_NS                DST_NS                SECURED
</span></span><span style=display:flex><span>prometheus    backend       linkerd-viz           trafficsplit-sample   √
</span></span><span style=display:flex><span>prometheus    failing       linkerd-viz           trafficsplit-sample   √
</span></span><span style=display:flex><span>prometheus    slow-cooker   linkerd-viz           trafficsplit-sample   √
</span></span><span style=display:flex><span>slow-cooker   backend       trafficsplit-sample   trafficsplit-sample   √
</span></span><span style=display:flex><span>slow-cooker   failing       trafficsplit-sample   trafficsplit-sample   √
</span></span></code></pre></div><p>This can also be verified by running <code>stat</code> sub command on the <code>TrafficSplit</code>
resource.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz stat ts/backend-split -n traffic-sample
</span></span><span style=display:flex><span>NAME            APEX          LEAF          WEIGHT   SUCCESS      RPS   LATENCY_P50   LATENCY_P95   LATENCY_P99
</span></span><span style=display:flex><span>backend-split   backend-svc   backend-svc      <span style=color:#a5d6ff>500</span>   100.00%   0.5rps           1ms           1ms           1ms
</span></span><span style=display:flex><span>backend-split   backend-svc   failing-svc      <span style=color:#a5d6ff>500</span>     0.00%   0.5rps           1ms           1ms           1ms
</span></span></code></pre></div><p>This can also be verified by checking the <code>smi-adaptor</code> logs.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd-smi logs deploy/smi-adaptor smi-adaptor
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:04:35Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Using cluster domain: cluster.local&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:04:35Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Starting SMI Controller&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:04:35Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Waiting for informer caches to sync&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:04:35Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;starting admin server on :9995&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:04:35Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Starting workers&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:04:35Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Started workers&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:05:17Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;created serviceprofile/backend-svc.trafficsplit-sample.svc.cluster.local for trafficsplit/backend-split&#34;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>time</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;2021-08-04T11:05:17Z&#34;</span> <span style=color:#79c0ff>level</span><span style=color:#ff7b72;font-weight:700>=</span>info <span style=color:#79c0ff>msg</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;Successfully synced &#39;trafficsplit-sample/backend-split&#39;&#34;</span>
</span></span></code></pre></div><h2 id=cleanup class=anchor>Cleanup
<a href=#cleanup class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Delete the <code>trafficsplit-sample</code> resource by running</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete namespace/trafficsplit-sample
</span></span></code></pre></div><h3 id=conclusion class=anchor>Conclusion
<a href=#conclusion class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Though, Linkerd currently supports reading <code>TrafficSplit</code> resources directly
<code>ServiceProfiles</code> would always take a precedence over <code>TrafficSplit</code> resources. The
support for <code>TrafficSplit</code> resource will be removed in a further release at which
the <code>linkerd-smi</code> extension would be necessary to use <code>SMI</code> resources with Linkerd.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>