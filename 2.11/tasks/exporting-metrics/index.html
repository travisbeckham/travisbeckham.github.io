<!doctype html><html lang=en><head><meta charset=utf-8><title>Exporting Metrics | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Integrate Linkerd's Prometheus with your existing metrics infrastructure."><meta property="og:url" content="https://travisbeckham.github.io/2.11/tasks/exporting-metrics/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Exporting Metrics"><meta property="og:description" content="Integrate Linkerd's Prometheus with your existing metrics infrastructure."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.11"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Exporting Metrics"><meta name=twitter:description content="Integrate Linkerd's Prometheus with your existing metrics infrastructure."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.11/tasks/exporting-metrics/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement><strong>Oct 23, 2024</strong> New blog post: Towards a Sustainable Service Mesh.
<a href=/2024/10/23/making-linkerd-sustainable/ class=main-announcement__link>Read the post</a></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/ selected>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2.11/overview/>Overview</a></li><li><a href=/2.11/getting-started/>Getting Started</a></li><li><a href=/2.11/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-00ef7d1751a09ab18b1a0e3672bd135a>
<label class=toggle__label for=toggle-00ef7d1751a09ab18b1a0e3672bd135a><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.11/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.11/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.11/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.11/features/ingress/>Ingress</a></li><li><a href=/2.11/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.11/features/load-balancing/>Load Balancing</a></li><li><a href=/2.11/features/server-policy/>Authorization Policy</a></li><li><a href=/2.11/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.11/features/cni/>CNI Plugin</a></li><li><a href=/2.11/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.11/features/fault-injection/>Fault Injection</a></li><li><a href=/2.11/features/ha/>High Availability</a></li><li><a href=/2.11/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.11/features/dashboard/>On-cluster metrics stack</a></li><li><a href=/2.11/features/service-profiles/>Service Profiles</a></li><li><a href=/2.11/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.11/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-7b9227afccfad80ce551f98ae9468000 checked>
<label class=toggle__label for=toggle-7b9227afccfad80ce551f98ae9468000><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.11/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.11/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.11/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.11/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.11/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.11/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.11/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.11/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.11/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.11/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.11/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.11/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.11/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.11/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li class=docs__nav--selected><a href=/2.11/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.11/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.11/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.11/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.11/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.11/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.11/tasks/grafana/>Grafana</a></li><li><a href=/2.11/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.11/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.11/tasks/install/>Installing Linkerd</a></li><li><a href=/2.11/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.11/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.11/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.11/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.11/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.11/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.11/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.11/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.11/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.11/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.11/tasks/securing-your-cluster/>Securing Your Cluster</a></li><li><a href=/2.11/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.11/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.11/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.11/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.11/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.11/tasks/upgrade-multicluster/>Upgrading Multicluster in Linkerd 2.9</a></li><li><a href=/2.11/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.11/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.11/tasks/extensions/>Using extensions</a></li><li><a href=/2.11/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.11/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.11/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.11/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-951a8405bc0d2ef0503c27bdaa20c05b>
<label class=toggle__label for=toggle-951a8405bc0d2ef0503c27bdaa20c05b><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/reference/architecture/>Architecture</a></li><li><a href=/2.11/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.11/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-5ab67513e4905c4b33f4cb426c02718f>
<label class=toggle__label for=toggle-5ab67513e4905c4b33f4cb426c02718f><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/reference/cli/authz/>authz</a></li><li><a href=/2.11/reference/cli/check/>check</a></li><li><a href=/2.11/reference/cli/completion/>completion</a></li><li><a href=/2.11/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.11/reference/cli/identity/>identity</a></li><li><a href=/2.11/reference/cli/inject/>inject</a></li><li><a href=/2.11/reference/cli/install/>install</a></li><li><a href=/2.11/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.11/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.11/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.11/reference/cli/profile/>profile</a></li><li><a href=/2.11/reference/cli/repair/>repair</a></li><li><a href=/2.11/reference/cli/uninject/>uninject</a></li><li><a href=/2.11/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.11/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.11/reference/cli/version/>version</a></li><li><a href=/2.11/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.11/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.11/reference/extension-list/>Extensions List</a></li><li><a href=/2.11/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.11/reference/iptables/>IPTables Reference</a></li><li><a href=/2.11/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.11/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.11/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.11/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Exporting Metrics</h1></div><div class="docs__content prose"><p>Linkerd provides an extensive set of metrics for all traffic that passes through
its data plane. These metrics are collected at the proxy level and reported on
the proxy&rsquo;s metrics endpoint.</p><p>By design, Linkerd only keeps metrics data for a short, fixed window of time
(currently, 6 hours). This means that if Linkerd&rsquo;s metrics data is valuable to
you, you will probably want to export it into a full-fledged metrics store.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Linkerd Production Tip</h4></div><div class=alert__content>This page contains best-effort instructions by the open source community. Production users with mission-critical applications should familiarize themselves with <a href=/going-to-production/>Linkerd production resources</a> and/or connect with a commercial <a href=/support-training/>Linkerd provider</a>.</div></div><p>Internally, Linkerd stores its metrics in a Prometheus instance that runs as
part of the Viz extension. The following tutorial requires the viz extension
to be installed with prometheus enabled. There are several basic approaches
to exporting metrics data from Linkerd:</p><ul><li><a href=#federation>Federating data to your own Prometheus cluster</a></li><li><a href=#integration>Using a Prometheus integration</a></li><li><a href=#api>Extracting data via Prometheus&rsquo;s APIs</a></li><li><a href=#proxy>Gather data from the proxies directly</a></li></ul><h2 id=federation class=anchor>Using the Prometheus federation API
<a href=#federation class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If you are using Prometheus as your own metrics store, we recommend taking
advantage of Prometheus&rsquo;s <em>federation</em> API, which is designed exactly for the
use case of copying data from one Prometheus to another.</p><p>Simply add the following item to your <code>scrape_configs</code> in your Prometheus config
file (replace <code>{{.Namespace}}</code> with the namespace where the Linkerd Viz
extension is running):</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#7ee787>job_name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;linkerd&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>kubernetes_sd_configs</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span>- <span style=color:#7ee787>role</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>pod</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>namespaces</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>names</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>&#39;{{.Namespace}}&#39;</span>]<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>relabel_configs</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span>- <span style=color:#7ee787>source_labels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#a5d6ff>__meta_kubernetes_pod_container_name</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>action</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>keep</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>regex</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>^prometheus$</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>honor_labels</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>metrics_path</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;/federate&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>params</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>&#39;match[]&#39;</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;{job=&#34;linkerd-proxy&#34;}&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;{job=&#34;linkerd-controller&#34;}&#39;</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>Alternatively, if you prefer to use Prometheus&rsquo; ServiceMonitors to configure
your Prometheus, you can use this ServiceMonitor YAML (replace <code>{{.Namespace}}</code>
with the namespace where Linkerd Viz extension is running):</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>monitoring.coreos.com/v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ServiceMonitor</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>labels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>k8s-app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>linkerd-prometheus</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>release</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>monitoring</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>linkerd-federate</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span>{{<span style=color:#a5d6ff>.Namespace}}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>endpoints</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span>- <span style=color:#7ee787>interval</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>30s</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>scrapeTimeout</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>30s</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>params</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>match[]</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;{job=&#34;linkerd-proxy&#34;}&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;{job=&#34;linkerd-controller&#34;}&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>path</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>/federate</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>port</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>admin-http</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>honorLabels</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>relabelings</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#7ee787>action</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>keep</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>regex</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;^prometheus$&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>sourceLabels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#a5d6ff>&#39;__meta_kubernetes_pod_container_name&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>jobLabel</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>app</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespaceSelector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>matchNames</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- {{<span style=color:#a5d6ff>.Namespace}}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>selector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>matchLabels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>component</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>prometheus</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>That&rsquo;s it! Your Prometheus cluster is now configured to federate Linkerd&rsquo;s
metrics from Linkerd&rsquo;s internal Prometheus instance.</p><p>Once the metrics are in your Prometheus, Linkerd&rsquo;s proxy metrics will have the
label <code>job="linkerd-proxy"</code> and Linkerd&rsquo;s control plane metrics will have the
label <code>job="linkerd-controller"</code>. For more information on specific metric and
label definitions, have a look at <a href=../../reference/proxy-metrics/>Proxy Metrics</a>.</p><p>For more information on Prometheus&rsquo; <code>/federate</code> endpoint, have a look at the
<a href=https://prometheus.io/docs/prometheus/latest/federation/ target=_blank rel=noopener>Prometheus federation docs</a>.</p><h2 id=integration class=anchor>Using a Prometheus integration
<a href=#integration class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If you are not using Prometheus as your own long-term data store, you may be
able to leverage one of Prometheus&rsquo;s <a href=https://prometheus.io/docs/operating/integrations/ target=_blank rel=noopener>many
integrations</a> to
automatically extract data from Linkerd&rsquo;s Prometheus instance into the data
store of your choice. Please refer to the Prometheus documentation for details.</p><h2 id=api class=anchor>Extracting data via Prometheus&rsquo;s APIs
<a href=#api class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If neither Prometheus federation nor Prometheus integrations are options for
you, it is possible to call Prometheus&rsquo;s APIs to extract data from Linkerd.</p><p>For example, you can call the federation API directly via a command like:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -G <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --data-urlencode <span style=color:#a5d6ff>&#39;match[]={job=&#34;linkerd-proxy&#34;}&#39;</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --data-urlencode <span style=color:#a5d6ff>&#39;match[]={job=&#34;linkerd-controller&#34;}&#39;</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  http://prometheus.linkerd-viz.svc.cluster.local:9090/federate
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>If your data store is outside the Kubernetes cluster, it is likely that
you&rsquo;ll want to set up
<a href=https://kubernetes.io/docs/concepts/services-networking/ingress/ target=_blank rel=noopener>ingress</a>
at a domain name of your choice with authentication.</div></div><p>Similar to the <code>/federate</code> API, Prometheus provides a JSON query API to
retrieve all metrics:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://prometheus.linkerd-viz.svc.cluster.local:9090/api/v1/query?query<span style=color:#ff7b72;font-weight:700>=</span>request_total
</span></span></code></pre></div><h2 id=proxy class=anchor>Gathering data from the Linkerd proxies directly
<a href=#proxy class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Finally, if you want to avoid Linkerd&rsquo;s Prometheus entirely, you can query the
Linkerd proxies directly on their <code>/metrics</code> endpoint.</p><p>For example, to view <code>/metrics</code> from a single Linkerd proxy, running in the
<code>linkerd</code> namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd port-forward <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  <span style=color:#ff7b72>$(</span>kubectl -n linkerd get pods <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -o <span style=color:#79c0ff>jsonpath</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;{.items[0].metadata.name}&#39;</span><span style=color:#ff7b72>)</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  4191:4191
</span></span></code></pre></div><p>and then:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl localhost:4191/metrics
</span></span></code></pre></div><p>Alternatively, <code>linkerd diagnostics proxy-metrics</code> can be used to retrieve
proxy metrics for a given workload.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>