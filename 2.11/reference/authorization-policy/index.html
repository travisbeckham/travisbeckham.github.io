<!doctype html><html lang=en><head><meta charset=utf-8><title>Authorization Policy | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Details on the specification and what is possible with policy resources."><meta property="og:url" content="https://travisbeckham.github.io/2.11/reference/authorization-policy/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Authorization Policy"><meta property="og:description" content="Details on the specification and what is possible with policy resources."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.11"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Authorization Policy"><meta name=twitter:description content="Details on the specification and what is possible with policy resources."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.11/reference/authorization-policy/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=/community/heroes/>Linkerd Heroes</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/ selected>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option><option value=/2.9/>Linkerd 2.9</option></select></div><nav><ul><li><a href=/2.11/overview/>Overview</a></li><li><a href=/2.11/getting-started/>Getting Started</a></li><li><a href=/2.11/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-00ef7d1751a09ab18b1a0e3672bd135a>
<label class=toggle__label for=toggle-00ef7d1751a09ab18b1a0e3672bd135a><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.11/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.11/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.11/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.11/features/ingress/>Ingress</a></li><li><a href=/2.11/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.11/features/load-balancing/>Load Balancing</a></li><li><a href=/2.11/features/server-policy/>Authorization Policy</a></li><li><a href=/2.11/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.11/features/cni/>CNI Plugin</a></li><li><a href=/2.11/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.11/features/fault-injection/>Fault Injection</a></li><li><a href=/2.11/features/ha/>High Availability</a></li><li><a href=/2.11/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.11/features/dashboard/>On-cluster metrics stack</a></li><li><a href=/2.11/features/service-profiles/>Service Profiles</a></li><li><a href=/2.11/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li><a href=/2.11/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-7b9227afccfad80ce551f98ae9468000>
<label class=toggle__label for=toggle-7b9227afccfad80ce551f98ae9468000><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.11/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.11/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.11/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.11/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.11/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.11/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.11/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.11/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.11/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.11/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.11/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.11/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.11/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.11/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.11/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.11/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.11/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.11/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.11/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.11/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.11/tasks/grafana/>Grafana</a></li><li><a href=/2.11/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.11/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.11/tasks/install/>Installing Linkerd</a></li><li><a href=/2.11/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.11/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.11/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.11/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.11/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.11/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.11/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.11/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.11/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.11/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.11/tasks/securing-your-cluster/>Securing Your Cluster</a></li><li><a href=/2.11/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.11/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.11/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.11/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.11/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.11/tasks/upgrade-multicluster/>Upgrading Multicluster in Linkerd 2.9</a></li><li><a href=/2.11/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.11/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.11/tasks/extensions/>Using extensions</a></li><li><a href=/2.11/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.11/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.11/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li class=docs__nav--selected><a href=/2.11/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-951a8405bc0d2ef0503c27bdaa20c05b checked>
<label class=toggle__label for=toggle-951a8405bc0d2ef0503c27bdaa20c05b><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/reference/architecture/>Architecture</a></li><li class=docs__nav--selected><a href=/2.11/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.11/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-5ab67513e4905c4b33f4cb426c02718f>
<label class=toggle__label for=toggle-5ab67513e4905c4b33f4cb426c02718f><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.11/reference/cli/authz/>authz</a></li><li><a href=/2.11/reference/cli/check/>check</a></li><li><a href=/2.11/reference/cli/completion/>completion</a></li><li><a href=/2.11/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.11/reference/cli/identity/>identity</a></li><li><a href=/2.11/reference/cli/inject/>inject</a></li><li><a href=/2.11/reference/cli/install/>install</a></li><li><a href=/2.11/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.11/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.11/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.11/reference/cli/profile/>profile</a></li><li><a href=/2.11/reference/cli/repair/>repair</a></li><li><a href=/2.11/reference/cli/uninject/>uninject</a></li><li><a href=/2.11/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.11/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.11/reference/cli/version/>version</a></li><li><a href=/2.11/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.11/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.11/reference/extension-list/>Extensions List</a></li><li><a href=/2.11/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.11/reference/iptables/>IPTables Reference</a></li><li><a href=/2.11/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.11/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.11/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.11/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Authorization Policy</h1></div><div class="docs__content prose"><p><a href=#server>Server</a> and <a href=#serverauthorization>ServerAuthorization</a> are the two types
of policy resources in Linkerd, used to control inbound access to your meshed
applications.</p><p>During the linkerd install, the <code>policyController.defaultAllowPolicy</code> field is used
to specify the default policy when no <a href=#server>Server</a> selects a pod.
This field can be one of the following:</p><ul><li><code>all-unauthenticated</code>: allow all requests. This is the default.</li><li><code>all-authenticated</code>: allow requests from meshed clients in the same or from
a different cluster (with multi-cluster).</li><li><code>cluster-authenticated</code>: allow requests from meshed clients in the same cluster.</li><li><code>cluster-unauthenticated</code>: allow requests from both meshed and non-meshed clients
in the same cluster.</li><li><code>deny</code>: all requests are denied. (Policy resources should then be created to
allow specific communications between services).</li></ul><p>This default can be overridden by setting the annotation <code>config.linkerd.io/default- inbound-policy</code> on either a pod spec or its namespace.</p><p>Once a <a href=#server>Server</a> is configured for a pod & port, its default behavior
is to <em>deny</em> traffic and <a href=#serverauthorization>ServerAuthorization</a> resources
must be created to allow traffic on a <code>Server</code>.</p><h2 id=server class=anchor>Server
<a href=#server class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>A <code>Server</code> selects a port on a set of pods in the same namespace as the server.
It typically selects a single port on a pod, though it may select multiple
ports when referring to the port by name (e.g. <code>admin-http</code>). While the
<code>Server</code> resource is similar to a Kubernetes <code>Service</code>, it has the added
restriction that multiple <code>Server</code> instances must not overlap: they must not
select the same pod/port pairs. Linkerd ships with an admission controller that
tries to prevent overlapping servers from being created.</p><p>When a Server selects a port, traffic is denied by default and <a href=#serverauthorization><code>ServerAuthorizations</code></a>
must be used to authorize traffic on ports selected by the Server.</p><h3 id=spec class=anchor>Spec
<a href=#spec class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A <code>Server</code> spec may contain the following top level fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>podSelector</code></td><td style=text-align:left>A <a href=#podselector>podSelector</a> selects pods in the same namespace.</td></tr><tr><td style=text-align:left><code>port</code></td><td style=text-align:left>A port name or number. Only ports in a pod spec&rsquo;s <code>ports</code> are considered.</td></tr><tr><td style=text-align:left><code>proxyProtocol</code></td><td style=text-align:left>Configures protocol discovery for inbound connections. Supersedes the <code>config.linkerd.io/opaque-ports</code> annotation. Must be one of <code>unknown</code>,<code>HTTP/1</code>,<code>HTTP/2</code>,<code>gRPC</code>,<code>opaque</code>,<code>TLS</code>. Defaults to <code>unknown</code> if not set.</td></tr></tbody></table></div><h3 id=podselector class=anchor>podSelector
<a href=#podselector class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This is the <a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/label-selector/#LabelSelector target=_blank rel=noopener>same labelSelector field in Kubernetes</a>.
All the pods that are part of this selector will be part of the <code>Server</code> group.
A podSelector object must contain <em>exactly one</em> of the following fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>matchExpressions</code></td><td style=text-align:left>matchExpressions is a list of label selector requirements. The requirements are ANDed.</td></tr><tr><td style=text-align:left><code>matchLabels</code></td><td style=text-align:left>matchLabels is a map of {key,value} pairs.</td></tr></tbody></table></div><p>See <a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/label-selector/#LabelSelector target=_blank rel=noopener>the Kubernetes LabelSelector reference</a>
for more details.</p><h3 id=server-examples class=anchor>Server Examples
<a href=#server-examples class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A <a href=#server>Server</a> that selects over pods with a specific label, with <code>gRPC</code> as
the <code>proxyProtocol</code>.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>policy.linkerd.io/v1beta1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Server</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emojivoto</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emoji-grpc</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>podSelector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>matchLabels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emoji-svc</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>port</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>grpc</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>proxyProtocol</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>gRPC</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>A <a href=#server>Server</a> that selects over pods with <code>matchExpressions</code>, with <code>HTTP/2</code>
as the <code>proxyProtocol</code>, on port <code>8080</code>.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>policy.linkerd.io/v1beta1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Server</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emojivoto</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>backend-services</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>podSelector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>matchExpressions</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- {<span style=color:#7ee787>key: app, operator: In, values</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>voting-svc, emoji-svc]}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- {<span style=color:#7ee787>key: environment, operator: NotIn, values</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>dev]}</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>port</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>8080</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>proxyProtocol</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;HTTP/2&#34;</span><span style=color:#6e7681>
</span></span></span></code></pre></div><h2 id=serverauthorization class=anchor>ServerAuthorization
<a href=#serverauthorization class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>A <a href=#serverauthorization>ServerAuthorization</a> provides a way to authorize
traffic to one or more <a href=#server><code>Server</code></a>s.</p><h3 id=spec-1 class=anchor>Spec
<a href=#spec-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A ServerAuthorization spec must contain the following top level fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>client</code></td><td style=text-align:left>A <a href=#client>client</a> describes clients authorized to access a server.</td></tr><tr><td style=text-align:left><code>server</code></td><td style=text-align:left>A <a href=#server>server</a> identifies <code>Servers</code> in the same namespace for which this authorization applies.</td></tr></tbody></table></div><h3 id=server-1 class=anchor>Server
<a href=#server-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A <code>Server</code> object must contain <em>exactly one</em> of the following fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>name</code></td><td style=text-align:left>References a <code>Server</code> instance by name.</td></tr><tr><td style=text-align:left><code>selector</code></td><td style=text-align:left>A <a href=#selector>selector</a> selects servers on which this authorization applies in the same namespace.</td></tr></tbody></table></div><h3 id=selector class=anchor>selector
<a href=#selector class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This is the <a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/label-selector/#LabelSelector target=_blank rel=noopener>same labelSelector field in Kubernetes</a>.
All the servers that are part of this selector will have this authorization applied.
A selector object must contain <em>exactly one</em> of the following fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>matchExpressions</code></td><td style=text-align:left>matchExpressions is a list of label selector requirements. The requirements are ANDed.</td></tr><tr><td style=text-align:left><code>matchLabels</code></td><td style=text-align:left>matchLabels is a map of {key,value} pairs.</td></tr></tbody></table></div><p>See <a href=https://kubernetes.io/docs/reference/kubernetes-api/common-definitions/label-selector/#LabelSelector target=_blank rel=noopener>the Kubernetes LabelSelector reference</a>
for more details.</p><h3 id=client class=anchor>client
<a href=#client class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A <code>client</code> object must contain <em>exactly one</em> of the following fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>meshTLS</code></td><td style=text-align:left>A <a href=#meshtls>meshTLS</a> is used to authorize meshed clients to access a server.</td></tr><tr><td style=text-align:left><code>unauthenticated</code></td><td style=text-align:left>A boolean value that authorizes unauthenticated clients to access a server.</td></tr></tbody></table></div><p>Optionally, it can also contain the <code>networks</code> field:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>networks</code></td><td style=text-align:left>Limits the client IP addresses to which this authorization applies. If unset, the server chooses a default (typically, all IPs or the cluster&rsquo;s pod network).</td></tr></tbody></table></div><h3 id=meshtls class=anchor>meshTLS
<a href=#meshtls class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A <code>meshTLS</code> object must contain <em>exactly one</em> of the following fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>unauthenticatedTLS</code></td><td style=text-align:left>A boolean to indicate that no client identity is required for communication.This is mostly important for the identity controller, which must terminate TLS connections from clients that do not yet have a certificate.</td></tr><tr><td style=text-align:left><code>identities</code></td><td style=text-align:left>A list of proxy identity strings (as provided via MTLS) that are authorized. The <code>*</code> prefix can be used to match all identities in a domain. An identity string of <code>*</code> indicates that all authentication clients are authorized.</td></tr><tr><td style=text-align:left><code>serviceAccounts</code></td><td style=text-align:left>A list of authorized client <a href=#serviceAccount>serviceAccount</a>s (as provided via MTLS).</td></tr></tbody></table></div><h3 id=serviceaccount class=anchor>serviceAccount
<a href=#serviceaccount class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A serviceAccount field contains the following top level fields:</p><div class=keyval><table><thead><tr><th style=text-align:left>field</th><th style=text-align:left>value</th></tr></thead><tbody><tr><td style=text-align:left><code>name</code></td><td style=text-align:left>The ServiceAccount&rsquo;s name.</td></tr><tr><td style=text-align:left><code>namespace</code></td><td style=text-align:left>The ServiceAccount&rsquo;s namespace. If unset, the authorization&rsquo;s namespace is used.</td></tr></tbody></table></div><h3 id=serverauthorization-examples class=anchor>ServerAuthorization Examples
<a href=#serverauthorization-examples class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>A <a href=#serverauthorization>ServerAuthorization</a> that allows meshed clients with
<code>*.emojivoto.serviceaccount.identity.linkerd.cluster.local</code> proxy identity i.e. all
service accounts in the <code>emojivoto</code> namespace.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>policy.linkerd.io/v1beta1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ServerAuthorization</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emojivoto</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emoji-grpc</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic># Allow all authenticated clients to access the (read-only) emoji service.</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>server</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>selector</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>matchLabels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emoji-svc</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>client</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>meshTLS</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>identities</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>- <span style=color:#a5d6ff>&#34;*.emojivoto.serviceaccount.identity.linkerd.cluster.local&#34;</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>A <a href=#serverauthorization>ServerAuthorization</a> that allows any unauthenticated
clients.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>policy.linkerd.io/v1beta1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ServerAuthorization</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emojivoto</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>web-public</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>server</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>web-http</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic># Allow all clients to access the web HTTP port without regard for</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic># authentication. If unauthenticated connections are permitted, there is no</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic># need to describe authenticated clients.</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>client</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>unauthenticated</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>networks</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>cidr</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>0.0.0.0</span><span style=color:#a5d6ff>/0</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span>- <span style=color:#7ee787>cidr</span>:<span style=color:#6e7681> </span>::<span style=color:#a5d6ff>/0</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>A <a href=#serverauthorization>ServerAuthorization</a> that allows meshed clients with a
specific service account.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>policy.linkerd.io/v1beta1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>ServerAuthorization</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>emojivoto</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>prom-prometheus</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>server</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>prom</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>client</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>meshTLS</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>serviceAccounts</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span>- <span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>linkerd-viz</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>          </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>prometheus</span><span style=color:#6e7681>
</span></span></span></code></pre></div></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>