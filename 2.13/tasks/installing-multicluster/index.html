<!doctype html><html lang=en><head><meta charset=utf-8><title>Installing Multi-cluster Components | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Allow Linkerd to manage cross-cluster communication."><meta property="og:url" content="https://travisbeckham.github.io/2.13/tasks/installing-multicluster/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Installing Multi-cluster Components"><meta property="og:description" content="Allow Linkerd to manage cross-cluster communication."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.13"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Installing Multi-cluster Components"><meta name=twitter:description content="Allow Linkerd to manage cross-cluster communication."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.13/tasks/installing-multicluster/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=/community/heroes/>Linkerd Heroes</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/ selected>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option><option value=/2.9/>Linkerd 2.9</option></select></div><nav><ul><li><a href=/2.13/overview/>Overview</a></li><li><a href=/2.13/getting-started/>Getting Started</a></li><li><a href=/2.13/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-eb69f9fda3cfd87e9a8e70073ecd9ca5>
<label class=toggle__label for=toggle-eb69f9fda3cfd87e9a8e70073ecd9ca5><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.13/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.13/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.13/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.13/features/ingress/>Ingress</a></li><li><a href=/2.13/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.13/features/load-balancing/>Load Balancing</a></li><li><a href=/2.13/features/server-policy/>Authorization Policy</a></li><li><a href=/2.13/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.13/features/cni/>CNI Plugin</a></li><li><a href=/2.13/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2.13/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.13/features/request-routing/>Dynamic Request Routing</a></li><li><a href=/2.13/features/fault-injection/>Fault Injection</a></li><li><a href=/2.13/features/ha/>High Availability</a></li><li><a href=/2.13/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2.13/features/nft/>Iptables-nft Support</a></li><li><a href=/2.13/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.13/features/service-profiles/>Service Profiles</a></li><li><a href=/2.13/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.13/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-7a7cef84ddbcc31f1bd5f18df32ee069 checked>
<label class=toggle__label for=toggle-7a7cef84ddbcc31f1bd5f18df32ee069><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.13/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.13/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.13/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.13/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.13/tasks/circuit-breakers/>Circuit Breakers</a></li><li><a href=/2.13/tasks/configuring-dynamic-request-routing/>Configuring Dynamic Request Routing</a></li><li><a href=/2.13/tasks/configuring-per-route-policy/>Configuring Fine-grained Authorization Policy</a></li><li><a href=/2.13/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.13/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.13/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.13/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.13/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.13/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.13/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.13/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.13/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.13/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.13/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.13/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.13/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.13/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.13/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.13/tasks/grafana/>Grafana</a></li><li><a href=/2.13/tasks/using-ingress/>Handling ingress traffic</a></li><li><a href=/2.13/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.13/tasks/install/>Installing Linkerd</a></li><li><a href=/2.13/tasks/install-helm/>Installing Linkerd with Helm</a></li><li class=docs__nav--selected><a href=/2.13/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.13/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.13/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.13/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.13/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.13/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.13/tasks/flagger/>Progressive Delivery with Flagger</a></li><li><a href=/2.13/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.13/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.13/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.13/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2.13/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.13/tasks/traffic-shifting/>Traffic Shifting</a></li><li><a href=/2.13/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.13/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.13/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.13/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.13/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.13/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.13/tasks/extensions/>Using extensions</a></li><li><a href=/2.13/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.13/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.13/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.13/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-0bb183e885edaf2a0044b607cfb98a06>
<label class=toggle__label for=toggle-0bb183e885edaf2a0044b607cfb98a06><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/reference/architecture/>Architecture</a></li><li><a href=/2.13/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.13/reference/circuit-breaking/>Circuit Breaking</a></li><li><a href=/2.13/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-d6775a64e9a2f59c8f4dab50b7c8b796>
<label class=toggle__label for=toggle-d6775a64e9a2f59c8f4dab50b7c8b796><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/reference/cli/authz/>authz</a></li><li><a href=/2.13/reference/cli/check/>check</a></li><li><a href=/2.13/reference/cli/completion/>completion</a></li><li><a href=/2.13/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.13/reference/cli/identity/>identity</a></li><li><a href=/2.13/reference/cli/inject/>inject</a></li><li><a href=/2.13/reference/cli/install/>install</a></li><li><a href=/2.13/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.13/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.13/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.13/reference/cli/profile/>profile</a></li><li><a href=/2.13/reference/cli/prune/>prune</a></li><li><a href=/2.13/reference/cli/uninject/>uninject</a></li><li><a href=/2.13/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.13/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.13/reference/cli/version/>version</a></li><li><a href=/2.13/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.13/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.13/reference/extension-list/>Extensions List</a></li><li><a href=/2.13/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.13/reference/httproute/>HTTPRoute</a></li><li><a href=/2.13/reference/iptables/>IPTables Reference</a></li><li><a href=/2.13/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.13/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.13/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.13/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Installing Multi-cluster Components</h1></div><div class="docs__content prose"><p>Multicluster support in Linkerd requires extra installation and configuration on
top of the default <a href=../install/>control plane installation</a>. This guide
walks through this installation and configuration as well as common problems
that you may encounter. For a detailed walkthrough and explanation of what&rsquo;s
going on, check out <a href=../multicluster/>getting started</a>.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Linkerd Production Tip</h4></div><div class=alert__content>This page contains best-effort instructions by the open source community. Production users with mission-critical applications should familiarize themselves with <a href=/going-to-production/>Linkerd production resources</a> and/or connect with a commercial <a href=/support-training/>Linkerd provider</a>.</div></div><h2 id=requirements class=anchor>Requirements
<a href=#requirements class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><ul><li>Two clusters.</li><li>A <a href=../install/>control plane installation</a> in each cluster that shares
a common
<a href=../generate-certificates/#trust-anchor-certificate>trust anchor</a>.
If you have an existing installation, see the
<a href=../installing-multicluster/#trust-anchor-bundle>trust anchor bundle</a>
documentation to understand what is required.</li><li>Each of these clusters should be configured as <code>kubectl</code>
<a href=https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/ target=_blank rel=noopener>contexts</a>.</li><li>Elevated privileges on both clusters. We&rsquo;ll be creating service accounts and
granting extended privileges, so you&rsquo;ll need to be able to do that on your
test clusters.</li><li>Support for services of type <code>LoadBalancer</code> in the <code>east</code> cluster. Check out
the documentation for your cluster provider or take a look at
<a href=https://blog.alexellis.io/ingress-for-your-local-kubernetes-cluster/ target=_blank rel=noopener>inlets</a>.
This is what the <code>west</code> cluster will use to communicate with <code>east</code> via the
gateway.</li></ul><h2 id=step-1-install-the-multicluster-control-plane class=anchor>Step 1: Install the multicluster control plane
<a href=#step-1-install-the-multicluster-control-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>On each cluster, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd multicluster install | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    kubectl apply -f -
</span></span></code></pre></div><p>To verify that everything has started up successfully, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd multicluster check
</span></span></code></pre></div><p>For a deep dive into what components are being added to your cluster and how all
the pieces fit together, check out the
<a href=../multicluster/#preparing-your-cluster>getting started documentation</a>.</p><h2 id=step-2-link-the-clusters class=anchor>Step 2: Link the clusters
<a href=#step-2-link-the-clusters class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Each cluster must be linked. This consists of installing several resources in
the source cluster including a secret containing a kubeconfig that allows access
to the target cluster Kubernetes API, a service mirror control for mirroring
services, and a Link custom resource for holding configuration. To link cluster
<code>west</code> to cluster <code>east</code>, you would run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd --context<span style=color:#ff7b72;font-weight:700>=</span>east multicluster link --cluster-name east |
</span></span><span style=display:flex><span>  kubectl --context<span style=color:#ff7b72;font-weight:700>=</span>west apply -f -
</span></span></code></pre></div><p>To verify that the credentials were created successfully and the clusters are
able to reach each other, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd --context<span style=color:#ff7b72;font-weight:700>=</span>west multicluster check
</span></span></code></pre></div><p>You should also see the list of gateways show up by running. Note that you&rsquo;ll
need Linkerd&rsquo;s Viz extension to be installed in the source cluster to get the
list of gateways:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd --context<span style=color:#ff7b72;font-weight:700>=</span>west multicluster gateways
</span></span></code></pre></div><p>For a detailed explanation of what this step does, check out the
<a href=../multicluster/#linking-the-clusters>linking the clusters section</a>.</p><h2 id=step-3-export-services class=anchor>Step 3: Export services
<a href=#step-3-export-services class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Services are not automatically mirrored in linked clusters. By default, only
services with the <code>mirror.linkerd.io/exported</code> label will be mirrored. For each
service you would like mirrored to linked clusters, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl label svc foobar mirror.linkerd.io/exported<span style=color:#ff7b72;font-weight:700>=</span>true
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>You can configure a different label selector by using the
<code>--selector</code> flag on the <code>linkerd multicluster link</code> command or by editing
the Link resource created by the <code>linkerd multicluster link</code> command.</div></div><h2 id=trust-anchor-bundle class=anchor>Trust Anchor Bundle
<a href=#trust-anchor-bundle class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>To secure the connections between clusters, Linkerd requires that there is a
shared trust anchor. This allows the control plane to encrypt the requests that
go between clusters and verify the identity of those requests. This identity is
used to control access to clusters, so it is critical that the trust anchor is
shared.</p><p>The easiest way to do this is to have a single trust anchor certificate shared
between multiple clusters. If you have an existing Linkerd installation and have
thrown away the trust anchor key, it might not be possible to have a single
certificate for the trust anchor. Luckily, the trust anchor can be a bundle of
certificates as well!</p><p>To fetch your existing cluster&rsquo;s trust anchor, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd get cm linkerd-config -ojsonpath<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;{.data.values}&#34;</span> | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  yq e .identityTrustAnchorsPEM - &gt; trustAnchor.crt
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>This command requires <a href=https://github.com/mikefarah/yq target=_blank rel=noopener>yq</a>. If you
don&rsquo;t have yq, feel free to extract the certificate from the <code>identityTrustAnchorsPEM</code>
field with your tool of choice.</div></div><p>Now, you&rsquo;ll want to create a new trust anchor and issuer for the new cluster:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step certificate create root.linkerd.cluster.local root.crt root.key <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>   --profile root-ca --no-password --insecure
</span></span><span style=display:flex><span>step certificate create identity.linkerd.cluster.local issuer.crt issuer.key <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --profile intermediate-ca --not-after 8760h --no-password --insecure <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --ca root.crt --ca-key root.key
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>We use the <a href=https://smallstep.com/cli/ target=_blank rel=noopener>step cli</a> to generate
certificates. <code>openssl</code> works just as well!</div></div><p>With the old cluster&rsquo;s trust anchor and the new cluster&rsquo;s trust anchor, you can
create a bundle by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat trustAnchor.crt root.crt &gt; bundle.crt
</span></span></code></pre></div><p>You&rsquo;ll want to upgrade your existing cluster with the new bundle. Make sure
every pod you&rsquo;d like to have talk to the new cluster is restarted so that it can
use this bundle. To upgrade the existing cluster with this new trust anchor
bundle, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade --identity-trust-anchors-file<span style=color:#ff7b72;font-weight:700>=</span>./bundle.crt | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    kubectl apply -f -
</span></span></code></pre></div><p>Finally, you&rsquo;ll be able to install Linkerd on the new cluster by using the trust
anchor bundle that you just created along with the issuer certificate and key.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># first, install the Linkerd CRDs on the new cluster</span>
</span></span><span style=display:flex><span>linkerd install --crds | kubectl apply -f -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># then, install the Linkerd control plane, using the key material we created</span>
</span></span><span style=display:flex><span>linkerd install <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --identity-trust-anchors-file bundle.crt <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --identity-issuer-certificate-file issuer.crt <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --identity-issuer-key-file issuer.key | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  kubectl apply -f -
</span></span></code></pre></div><p>Make sure to verify that the cluster&rsquo;s have started up successfully by running
<code>check</code> on each one.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check
</span></span></code></pre></div><h2 id=installing-the-multicluster-control-plane-components-through-helm class=anchor>Installing the multicluster control plane components through Helm
<a href=#installing-the-multicluster-control-plane-components-through-helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Linkerd&rsquo;s multicluster components i.e Gateway and Service Mirror can
be installed via Helm rather than the <code>linkerd multicluster install</code> command.</p><p>This not only allows advanced configuration, but also allows users to bundle the
multicluster installation as part of their existing Helm based installation
pipeline.</p><h3 id=adding-linkerds-helm-repository class=anchor>Adding Linkerd&rsquo;s Helm repository
<a href=#adding-linkerds-helm-repository class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>First, let&rsquo;s add the Linkerd&rsquo;s Helm repository by running</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># To add the repo for Linkerd stable releases:</span>
</span></span><span style=display:flex><span>helm repo add linkerd https://helm.linkerd.io/stable
</span></span></code></pre></div><h3 id=helm-multicluster-install-procedure class=anchor>Helm multicluster install procedure
<a href=#helm-multicluster-install-procedure class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install linkerd-multicluster -n linkerd-multicluster --create-namespace linkerd/linkerd-multicluster
</span></span></code></pre></div><p>The chart values will be picked from the chart&rsquo;s <code>values.yaml</code> file.</p><p>You can override the values in that file by providing your own <code>values.yaml</code>
file passed with a <code>-f</code> option, or overriding specific values using the family of
<code>--set</code> flags.</p><p>Full set of configuration options can be found <a href=https://github.com/linkerd/linkerd2/tree/main/multicluster/charts/linkerd-multicluster#values target=_blank rel=noopener>here</a></p><p>The installation can be verified by running</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd multicluster check
</span></span></code></pre></div><p>Installation of the gateway can be disabled with the <code>gateway</code> setting. By
default this value is true.</p><h3 id=installing-additional-access-credentials class=anchor>Installing additional access credentials
<a href=#installing-additional-access-credentials class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>When the multicluster components are installed onto a target cluster with
<code>linkerd multicluster install</code>, a service account is created which source clusters
will use to mirror services. Using a distinct service account for each source
cluster can be beneficial since it gives you the ability to revoke service mirroring
access from specific source clusters. Generating additional service accounts
and associated RBAC can be done using the <code>linkerd multicluster allow</code> command
through the CLI.</p><p>The same functionality can also be done through Helm setting the
<code>remoteMirrorServiceAccountName</code> value to a list.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> helm install linkerd-mc-source linkerd/linkerd-multicluster -n linkerd-multicluster --create-namespace <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>   --set <span style=color:#79c0ff>remoteMirrorServiceAccountName</span><span style=color:#ff7b72;font-weight:700>={</span>source1<span style=color:#79c0ff>\,</span>source2<span style=color:#79c0ff>\,</span>source3<span style=color:#ff7b72;font-weight:700>}</span> --kube-context target
</span></span></code></pre></div><p>Now that the multicluster components are installed, operations like linking, etc
can be performed by using the linkerd CLI&rsquo;s multicluster sub-command as per the
<a href=../../features/multicluster/>multicluster task</a>.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright Â© 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>