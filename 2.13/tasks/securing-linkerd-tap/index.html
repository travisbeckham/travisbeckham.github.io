<!doctype html><html lang=en><head><meta charset=utf-8><title>Securing Linkerd Tap | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Best practices for securing Linkerd's tap feature."><meta property="og:url" content="https://travisbeckham.github.io/2.13/tasks/securing-linkerd-tap/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Securing Linkerd Tap"><meta property="og:description" content="Best practices for securing Linkerd's tap feature."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.13"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Securing Linkerd Tap"><meta name=twitter:description content="Best practices for securing Linkerd's tap feature."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.13/tasks/securing-linkerd-tap/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/ selected>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2.13/overview/>Overview</a></li><li><a href=/2.13/getting-started/>Getting Started</a></li><li><a href=/2.13/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-eb69f9fda3cfd87e9a8e70073ecd9ca5>
<label class=toggle__label for=toggle-eb69f9fda3cfd87e9a8e70073ecd9ca5><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.13/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.13/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.13/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.13/features/ingress/>Ingress</a></li><li><a href=/2.13/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.13/features/load-balancing/>Load Balancing</a></li><li><a href=/2.13/features/server-policy/>Authorization Policy</a></li><li><a href=/2.13/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.13/features/cni/>CNI Plugin</a></li><li><a href=/2.13/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2.13/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.13/features/request-routing/>Dynamic Request Routing</a></li><li><a href=/2.13/features/fault-injection/>Fault Injection</a></li><li><a href=/2.13/features/ha/>High Availability</a></li><li><a href=/2.13/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2.13/features/nft/>Iptables-nft Support</a></li><li><a href=/2.13/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.13/features/service-profiles/>Service Profiles</a></li><li><a href=/2.13/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.13/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-7a7cef84ddbcc31f1bd5f18df32ee069 checked>
<label class=toggle__label for=toggle-7a7cef84ddbcc31f1bd5f18df32ee069><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.13/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.13/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.13/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.13/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.13/tasks/circuit-breakers/>Circuit Breakers</a></li><li><a href=/2.13/tasks/configuring-dynamic-request-routing/>Configuring Dynamic Request Routing</a></li><li><a href=/2.13/tasks/configuring-per-route-policy/>Configuring Fine-grained Authorization Policy</a></li><li><a href=/2.13/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.13/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.13/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.13/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.13/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.13/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.13/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.13/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.13/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.13/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.13/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.13/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.13/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.13/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.13/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.13/tasks/grafana/>Grafana</a></li><li><a href=/2.13/tasks/using-ingress/>Handling ingress traffic</a></li><li><a href=/2.13/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.13/tasks/install/>Installing Linkerd</a></li><li><a href=/2.13/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.13/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.13/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.13/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.13/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.13/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.13/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.13/tasks/flagger/>Progressive Delivery with Flagger</a></li><li><a href=/2.13/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.13/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.13/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li class=docs__nav--selected><a href=/2.13/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2.13/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.13/tasks/traffic-shifting/>Traffic Shifting</a></li><li><a href=/2.13/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.13/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.13/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.13/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.13/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.13/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.13/tasks/extensions/>Using extensions</a></li><li><a href=/2.13/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.13/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.13/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.13/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-0bb183e885edaf2a0044b607cfb98a06>
<label class=toggle__label for=toggle-0bb183e885edaf2a0044b607cfb98a06><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/reference/architecture/>Architecture</a></li><li><a href=/2.13/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.13/reference/circuit-breaking/>Circuit Breaking</a></li><li><a href=/2.13/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-d6775a64e9a2f59c8f4dab50b7c8b796>
<label class=toggle__label for=toggle-d6775a64e9a2f59c8f4dab50b7c8b796><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/reference/cli/authz/>authz</a></li><li><a href=/2.13/reference/cli/check/>check</a></li><li><a href=/2.13/reference/cli/completion/>completion</a></li><li><a href=/2.13/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.13/reference/cli/identity/>identity</a></li><li><a href=/2.13/reference/cli/inject/>inject</a></li><li><a href=/2.13/reference/cli/install/>install</a></li><li><a href=/2.13/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.13/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.13/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.13/reference/cli/profile/>profile</a></li><li><a href=/2.13/reference/cli/prune/>prune</a></li><li><a href=/2.13/reference/cli/uninject/>uninject</a></li><li><a href=/2.13/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.13/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.13/reference/cli/version/>version</a></li><li><a href=/2.13/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.13/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.13/reference/extension-list/>Extensions List</a></li><li><a href=/2.13/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.13/reference/httproute/>HTTPRoute</a></li><li><a href=/2.13/reference/iptables/>IPTables Reference</a></li><li><a href=/2.13/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.13/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.13/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.13/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Securing Linkerd Tap</h1></div><div class="docs__content prose"><p>Linkerd provides a powerful tool called <code>tap</code> which allows users
to introspect live traffic in real time. While powerful, this feature can
potentially expose sensitive data such as request and response headers, which may
contain confidential information. To mitigate this risk, Linkerd has a configuration
field called <code>tap.ignoreHeaders</code> which can be used to exclude specific headers from
being captured by <code>tap</code>. Access to <code>tap</code> is controlled using
<a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/ target=_blank rel=noopener>role-based access control (RBAC)</a>.
This page illustrates best practices to enable this introspection in a secure
way.</p><h2 id=tap class=anchor>Tap
<a href=#tap class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Linkerd&rsquo;s Viz extension includes Tap support. This feature is available via the
following commands:</p><ul><li><a href=../../reference/cli/viz/#tap><code>linkerd viz tap</code></a></li><li><a href=../../reference/cli/viz/#top><code>linkerd viz top</code></a></li><li><a href=../../reference/cli/viz/#profile><code>linkerd viz profile --tap</code></a></li><li><a href=../../reference/cli/viz/#dashboard><code>linkerd viz dashboard</code></a></li></ul><p>Depending on your RBAC setup, you may need to perform additional steps to enable
your user(s) to perform Tap actions.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>If you are on GKE, skip to the <a href=#gke>GKE section below</a>.</div></div><h3 id=check-for-tap-access class=anchor>Check for Tap access
<a href=#check-for-tap-access class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Use <code>kubectl</code> to determine whether your user is authorized to perform tap
actions. For more information, see the
<a href=https://kubernetes.io/docs/reference/access-authn-authz/authorization/#checking-api-access target=_blank rel=noopener>Kubernetes docs on authorization</a>.</p><p>To determine if you can watch pods in all namespaces:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl auth can-i watch pods.tap.linkerd.io --all-namespaces
</span></span></code></pre></div><p>To determine if you can watch deployments in the emojivoto namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl auth can-i watch deployments.tap.linkerd.io -n emojivoto
</span></span></code></pre></div><p>To determine if a specific user can watch deployments in the emojivoto namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl auth can-i watch deployments.tap.linkerd.io -n emojivoto --as <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>
</span></span></code></pre></div><p>You can also use the Linkerd CLI&rsquo;s <code>--as</code> flag to confirm:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ linkerd viz tap -n linkerd deploy/linkerd-controller --as <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>
</span></span><span style=display:flex><span>Cannot connect to Linkerd Viz: namespaces is forbidden: User <span style=color:#a5d6ff>&#34;XXXX&#34;</span> cannot list resource <span style=color:#a5d6ff>&#34;namespaces&#34;</span> in API group <span style=color:#a5d6ff>&#34;&#34;</span> at the cluster scope
</span></span><span style=display:flex><span>Validate the install with: linkerd viz check
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=enabling-tap-access class=anchor>Enabling Tap access
<a href=#enabling-tap-access class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>If the above commands indicate you need additional access, you can enable access
with as much granularity as you choose.</p><h4 id=granular-tap-access class=anchor>Granular Tap access
<a href=#granular-tap-access class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>To enable tap access to all resources in all namespaces, you may bind your user
to the <code>linkerd-linkerd-tap-admin</code> ClusterRole, installed by default:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe clusterroles/linkerd-linkerd-viz-tap-admin
</span></span><span style=display:flex><span>Name:         linkerd-linkerd-viz-tap-admin
</span></span><span style=display:flex><span>Labels:       <span style=color:#79c0ff>component</span><span style=color:#ff7b72;font-weight:700>=</span>tap
</span></span><span style=display:flex><span>              linkerd.io/extension<span style=color:#ff7b72;font-weight:700>=</span>viz
</span></span><span style=display:flex><span>Annotations:  kubectl.kubernetes.io/last-applied-configuration:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;apiVersion&#34;</span>:<span style=color:#a5d6ff>&#34;rbac.authorization.k8s.io/v1&#34;</span>,<span style=color:#a5d6ff>&#34;kind&#34;</span>:<span style=color:#a5d6ff>&#34;ClusterRole&#34;</span>,<span style=color:#a5d6ff>&#34;metadata&#34;</span>:<span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;annotations&#34;</span>:<span style=color:#ff7b72;font-weight:700>{}</span>,<span style=color:#a5d6ff>&#34;labels&#34;</span>:<span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;component=tap...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>PolicyRule:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  Resources         Non-Resource URLs  Resource Names  Verbs
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  ---------         -----------------  --------------  -----
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  *.tap.linkerd.io  []                 []              [watch]
</span></span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>This ClusterRole name includes the Linkerd Viz namespace, so it may vary if you
installed Viz into a non-default namespace:
<code>linkerd-[LINKERD_VIZ_NAMESPACE]-tap-admin</code></div></div><p>To bind the <code>linkerd-linkerd-viz-tap-admin</code> ClusterRole to a particular user:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>-tap-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --clusterrole<span style=color:#ff7b72;font-weight:700>=</span>linkerd-linkerd-viz-tap-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --user<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>
</span></span></code></pre></div><p>You can verify you now have tap access with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ linkerd viz tap -n linkerd deploy/linkerd-controller --as <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>3:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.1:37392 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.13:9996 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>10.244.0.13:9996 :path<span style=color:#ff7b72;font-weight:700>=</span>/ping
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h4 id=cluster-admin-access class=anchor>Cluster admin access
<a href=#cluster-admin-access class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>To simply give your user cluster-admin access:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>-cluster-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --clusterrole<span style=color:#ff7b72;font-weight:700>=</span>cluster-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --user<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Not recommended for production, only do this for testing/development.</div></div><h3 id=gke class=anchor>GKE
<a href=#gke class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Google Kubernetes Engine (GKE) provides access to your Kubernetes cluster via
Google Cloud IAM. See the
<a href=https://cloud.google.com/kubernetes-engine/docs/how-to/iam target=_blank rel=noopener>GKE IAM Docs</a> for
more information.</p><p>Because GCloud provides this additional level of access, there are cases where
<code>kubectl auth can-i</code> will report you have Tap access when your RBAC user may
not. To validate this, check whether your GCloud user has Tap access:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i watch pods.tap.linkerd.io --all-namespaces
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><p>And then validate whether your RBAC user has Tap access:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i watch pods.tap.linkerd.io --all-namespaces --as <span style=color:#ff7b72>$(</span>gcloud config get-value account<span style=color:#ff7b72>)</span>
</span></span><span style=display:flex><span>no - no RBAC policy matched
</span></span></code></pre></div><p>If the second command reported you do not have access, you may enable access
with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>-tap-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --clusterrole<span style=color:#ff7b72;font-weight:700>=</span>linkerd-linkerd-viz-tap-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --user<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>$(</span>gcloud config get-value account<span style=color:#ff7b72>)</span>
</span></span></code></pre></div><p>To simply give your user cluster-admin access:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  <span style=color:#ff7b72>$(</span>whoami<span style=color:#ff7b72>)</span>-cluster-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --clusterrole<span style=color:#ff7b72;font-weight:700>=</span>cluster-admin <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --user<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#ff7b72>$(</span>gcloud config get-value account<span style=color:#ff7b72>)</span>
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Not recommended for production, only do this for testing/development.</div></div><h3 id=linkerd-dashboard-tap-access class=anchor>Linkerd Dashboard tap access
<a href=#linkerd-dashboard-tap-access class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>By default, the <a href=../../features/dashboard/>Linkerd dashboard</a> has the RBAC
privileges necessary to tap resources.</p><p>To confirm:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i watch pods.tap.linkerd.io --all-namespaces --as system:serviceaccount:linkerd-viz:web
</span></span><span style=display:flex><span>yes
</span></span></code></pre></div><p>This access is enabled via a <code>linkerd-linkerd-viz-web-admin</code> ClusterRoleBinding:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl describe clusterrolebindings/linkerd-linkerd-viz-web-admin
</span></span><span style=display:flex><span>Name:         linkerd-linkerd-viz-web-admin
</span></span><span style=display:flex><span>Labels:       <span style=color:#79c0ff>component</span><span style=color:#ff7b72;font-weight:700>=</span>web
</span></span><span style=display:flex><span>              linkerd.io/extensions<span style=color:#ff7b72;font-weight:700>=</span>viz
</span></span><span style=display:flex><span>Annotations:  kubectl.kubernetes.io/last-applied-configuration:
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;apiVersion&#34;</span>:<span style=color:#a5d6ff>&#34;rbac.authorization.k8s.io/v1&#34;</span>,<span style=color:#a5d6ff>&#34;kind&#34;</span>:<span style=color:#a5d6ff>&#34;ClusterRoleBinding&#34;</span>,<span style=color:#a5d6ff>&#34;metadata&#34;</span>:<span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;annotations&#34;</span>:<span style=color:#ff7b72;font-weight:700>{}</span>,<span style=color:#a5d6ff>&#34;labels&#34;</span>:<span style=color:#ff7b72;font-weight:700>{</span><span style=color:#a5d6ff>&#34;component=web...
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Role:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  Kind:  ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  Name:  linkerd-linkerd-viz-tap-admin
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>Subjects:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  Kind            Name         Namespace
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  ----            ----         ---------
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  ServiceAccount  web          linkerd-viz
</span></span></span></code></pre></div><p>If you would like to restrict the Linkerd dashboard&rsquo;s tap access. You may
install Linkerd viz with the <code>--set dashboard.restrictPrivileges</code> flag:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz install --set dashboard.restrictPrivileges
</span></span></code></pre></div><p>This will omit the <code>linkerd-linkerd-web-admin</code> ClusterRoleBinding. If you have
already installed Linkerd, you may simply delete the ClusterRoleBinding
manually:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete clusterrolebindings/linkerd-linkerd-viz-web-admin
</span></span></code></pre></div><p>To confirm:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl auth can-i watch pods.tap.linkerd.io --all-namespaces --as system:serviceaccount:linkerd-viz:web
</span></span><span style=display:flex><span>no
</span></span></code></pre></div></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>