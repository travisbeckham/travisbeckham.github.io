<!doctype html><html lang=en><head><meta charset=utf-8><title>Configuring Proxy Concurrency | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Limit the Linkerd proxy's CPU usage."><meta property="og:url" content="https://travisbeckham.github.io/2.13/tasks/configuring-proxy-concurrency/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Configuring Proxy Concurrency"><meta property="og:description" content="Limit the Linkerd proxy's CPU usage."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.13"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Configuring Proxy Concurrency"><meta name=twitter:description content="Limit the Linkerd proxy's CPU usage."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.13/tasks/configuring-proxy-concurrency/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/ selected>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2.13/overview/>Overview</a></li><li><a href=/2.13/getting-started/>Getting Started</a></li><li><a href=/2.13/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-eb69f9fda3cfd87e9a8e70073ecd9ca5>
<label class=toggle__label for=toggle-eb69f9fda3cfd87e9a8e70073ecd9ca5><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.13/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.13/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.13/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.13/features/ingress/>Ingress</a></li><li><a href=/2.13/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.13/features/load-balancing/>Load Balancing</a></li><li><a href=/2.13/features/server-policy/>Authorization Policy</a></li><li><a href=/2.13/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.13/features/cni/>CNI Plugin</a></li><li><a href=/2.13/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2.13/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.13/features/request-routing/>Dynamic Request Routing</a></li><li><a href=/2.13/features/fault-injection/>Fault Injection</a></li><li><a href=/2.13/features/ha/>High Availability</a></li><li><a href=/2.13/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2.13/features/nft/>Iptables-nft Support</a></li><li><a href=/2.13/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.13/features/service-profiles/>Service Profiles</a></li><li><a href=/2.13/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.13/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-7a7cef84ddbcc31f1bd5f18df32ee069 checked>
<label class=toggle__label for=toggle-7a7cef84ddbcc31f1bd5f18df32ee069><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2.13/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2.13/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.13/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.13/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.13/tasks/circuit-breakers/>Circuit Breakers</a></li><li><a href=/2.13/tasks/configuring-dynamic-request-routing/>Configuring Dynamic Request Routing</a></li><li><a href=/2.13/tasks/configuring-per-route-policy/>Configuring Fine-grained Authorization Policy</a></li><li class=docs__nav--selected><a href=/2.13/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.13/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.13/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.13/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.13/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.13/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.13/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.13/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.13/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.13/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.13/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.13/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.13/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.13/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.13/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.13/tasks/grafana/>Grafana</a></li><li><a href=/2.13/tasks/using-ingress/>Handling ingress traffic</a></li><li><a href=/2.13/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.13/tasks/install/>Installing Linkerd</a></li><li><a href=/2.13/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.13/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.13/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.13/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.13/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.13/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.13/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2.13/tasks/flagger/>Progressive Delivery with Flagger</a></li><li><a href=/2.13/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.13/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2.13/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.13/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2.13/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.13/tasks/traffic-shifting/>Traffic Shifting</a></li><li><a href=/2.13/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.13/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.13/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li><a href=/2.13/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.13/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.13/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.13/tasks/extensions/>Using extensions</a></li><li><a href=/2.13/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.13/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.13/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.13/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-0bb183e885edaf2a0044b607cfb98a06>
<label class=toggle__label for=toggle-0bb183e885edaf2a0044b607cfb98a06><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/reference/architecture/>Architecture</a></li><li><a href=/2.13/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2.13/reference/circuit-breaking/>Circuit Breaking</a></li><li><a href=/2.13/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-d6775a64e9a2f59c8f4dab50b7c8b796>
<label class=toggle__label for=toggle-d6775a64e9a2f59c8f4dab50b7c8b796><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.13/reference/cli/authz/>authz</a></li><li><a href=/2.13/reference/cli/check/>check</a></li><li><a href=/2.13/reference/cli/completion/>completion</a></li><li><a href=/2.13/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.13/reference/cli/identity/>identity</a></li><li><a href=/2.13/reference/cli/inject/>inject</a></li><li><a href=/2.13/reference/cli/install/>install</a></li><li><a href=/2.13/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.13/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.13/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.13/reference/cli/profile/>profile</a></li><li><a href=/2.13/reference/cli/prune/>prune</a></li><li><a href=/2.13/reference/cli/uninject/>uninject</a></li><li><a href=/2.13/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.13/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.13/reference/cli/version/>version</a></li><li><a href=/2.13/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.13/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.13/reference/extension-list/>Extensions List</a></li><li><a href=/2.13/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.13/reference/httproute/>HTTPRoute</a></li><li><a href=/2.13/reference/iptables/>IPTables Reference</a></li><li><a href=/2.13/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.13/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.13/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.13/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Configuring Proxy Concurrency</h1></div><div class="docs__content prose"><p>The Linkerd data plane&rsquo;s proxies are multithreaded, and are capable of running a
variable number of worker threads so that their resource usage matches the
application workload.</p><p>In a vacuum, of course, proxies will exhibit the best throughput and lowest
latency when allowed to use as many CPU cores as possible. However, in practice,
there are other considerations to take into account.</p><p>A real world deployment is <em>not</em> a load test where clients and servers perform
no other work beyond saturating the proxy with requests. Instead, the service
mesh model has proxy instances deployed as sidecars to application containers.
Each proxy only handles traffic to and from the pod it is injected into. This
means that throughput and latency are limited by the application workload. If an
application container instance can only handle so many requests per second, it
may not actually matter that the proxy could handle more. In fact, giving the
proxy more CPU cores than it requires to keep up with the application may <em>harm</em>
overall performance, as the application may have to compete with the proxy for
finite system resources.</p><p>Therefore, it is more important for individual proxies to handle their traffic
efficiently than to configure all proxies to handle the maximum possible load.
The primary method of tuning proxy resource usage is limiting the number of
worker threads used by the proxy to forward traffic. There are multiple methods
for doing this.</p><h2 id=using-the-proxy-cpu-limit-annotation class=anchor>Using the <code>proxy-cpu-limit</code> Annotation
<a href=#using-the-proxy-cpu-limit-annotation class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The simplest way to configure the proxy&rsquo;s thread pool is using the
<code>config.linkerd.io/proxy-cpu-limit</code> annotation. This annotation configures the
proxy injector to set an environment variable that controls the number of CPU
cores the proxy will use.</p><p>When installing Linkerd using the <a href=../install/><code>linkerd install</code> CLI
command</a>, the <code>--proxy-cpu-limit</code> argument sets this
annotation globally for all proxies injected by the Linkerd installation. For
example,</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># first, install the Linkerd CRDs</span>
</span></span><span style=display:flex><span>linkerd install --crds | kubectl apply -f -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># install Linkerd, with a proxy CPU limit configured.</span>
</span></span><span style=display:flex><span>linkerd install --proxy-cpu-limit <span style=color:#a5d6ff>2</span> | kubectl apply -f -
</span></span></code></pre></div><p>For more fine-grained configuration, the annotation may be added to any
<a href=../../proxy-injection/>injectable Kubernetes resource</a>, such as a namespace, pod,
or deployment.</p><p>For example, the following will configure any proxies in the <code>my-deployment</code>
deployment to use two CPU cores:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Deployment</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>apps/v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>my-deployment</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic># ...</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>template</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>annotations</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>config.linkerd.io/proxy-cpu-limit</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;1&#39;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic># ...</span><span style=color:#6e7681>
</span></span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Unlike Kubernetes CPU limits and requests, which can be expressed
in milliCPUs, the <code>proxy-cpu-limit</code> annotation should be expressed in whole
numbers of CPU cores. Fractional values will be rounded up to the nearest whole
number.</div></div><h2 id=using-kubernetes-cpu-limits-and-requests class=anchor>Using Kubernetes CPU Limits and Requests
<a href=#using-kubernetes-cpu-limits-and-requests class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Kubernetes provides
<a href=https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/#specify-a-cpu-request-and-a-cpu-limit target=_blank rel=noopener>CPU limits and CPU requests</a>
to configure the resources assigned to any pod or container. These may also be
used to configure the Linkerd proxy&rsquo;s CPU usage. However, depending on how the
kubelet is configured, using Kubernetes resource limits rather than the
<code>proxy-cpu-limit</code> annotation may not be ideal.</p><div class="alert alert--warning alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 14H11V9h2m0 9H11V16h2M1 21H23L12 2 1 21z"/></svg><h4>Warning</h4></div><div class=alert__content>When the environment variable configured by the <code>proxy-cpu-limit</code> annotation is
unset, the proxy will run only a single worker thread. Therefore, a
<code>proxy-cpu-limit</code> annotation should always be added to set an upper bound on the
number of CPU cores used by the proxy, even when Kubernetes CPU limits are also
in use.</div></div><p>The kubelet uses one of two mechanisms for enforcing pod CPU limits. This is
determined by the
<a href=https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/#configuration target=_blank rel=noopener><code>--cpu-manager-policy</code> kubelet option</a>.
With the default CPU manager policy,
<a href=https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/#none-policy target=_blank rel=noopener><code>none</code></a>,
the kubelet uses
<a href=https://en.wikipedia.org/wiki/Completely_Fair_Scheduler target=_blank rel=noopener>CFS quotas</a> to enforce
CPU limits. This means that the Linux kernel is configured to limit the amount
of time threads belonging to a given process are scheduled. Alternatively, the
CPU manager policy may be set to
<a href=https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/#static-policy target=_blank rel=noopener><code>static</code></a>.
In this case, the kubelet will use Linux <code>cgroup</code>s to enforce CPU limits for
containers which meet certain criteria.</p><p>On the other hand, using
<a href=https://www.kernel.org/doc/Documentation/cgroup-v1/cpusets.txt target=_blank rel=noopener>cgroup cpusets</a>
will limit the number of CPU cores available to the process. In essence, it will
appear to the proxy that the system has fewer CPU cores than it actually does.
If this value is lower than the value of the <code>proxy-cpu-limit</code> annotation, the
proxy will use the number of CPU cores determined by the cgroup limit.</p><p>However, it&rsquo;s worth noting that in order for this mechanism to be used, certain
criteria must be met:</p><ul><li>The kubelet must be configured with the <code>static</code> CPU manager policy</li><li>The pod must be in the
<a href=https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/#create-a-pod-that-gets-assigned-a-qos-class-of-guaranteed target=_blank rel=noopener>Guaranteed QoS class</a>.
This means that all containers in the pod must have both a limit and a request
for memory and CPU, and the limit for each must have the same value as the
request.</li><li>The CPU limit and CPU request must be an integer greater than or equal to 1.</li></ul><h2 id=using-helm class=anchor>Using Helm
<a href=#using-helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>When using <a href=../install-helm/>Helm</a>, users must take care to set the
<code>proxy.cores</code> Helm variable in addition to <code>proxy.cpu.limit</code>, if
the criteria for cgroup-based CPU limits
<a href=#using-kubernetes-cpu-limits-and-requests>described above</a> are not met.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>