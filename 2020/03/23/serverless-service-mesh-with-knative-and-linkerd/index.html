<!doctype html><html lang=en><head><meta charset=utf-8><title>Serverless Service Mesh with Knative and Linkerd | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Overview
Two of the most popular serverless platforms for Kubernetes are
Knative and OpenFaaS,
and there&rsquo;s a lot of existing content on using
Linkerd and OpenFaaS together.
In this blog post, we&rsquo;ll take a look at how to use Linkerd with Knative. While
the first version of Knative required Istio, in recent Knative releases they
have removed this requirement. We&rsquo;ll show you how to add
Linkerd to your Knative installation to automatically
provide both mTLS (mutual TLS) and comprehensive metrics to your Knative
services and system components."><meta property="og:url" content="https://travisbeckham.github.io/2020/03/23/serverless-service-mesh-with-knative-and-linkerd/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Serverless Service Mesh with Knative and Linkerd"><meta property="og:description" content="Overview Two of the most popular serverless platforms for Kubernetes are Knative and OpenFaaS, and there’s a lot of existing content on using Linkerd and OpenFaaS together. In this blog post, we’ll take a look at how to use Linkerd with Knative. While the first version of Knative required Istio, in recent Knative releases they have removed this requirement. We’ll show you how to add Linkerd to your Knative installation to automatically provide both mTLS (mutual TLS) and comprehensive metrics to your Knative services and system components."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-03-23T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-23T00:00:00+00:00"><meta property="og:image" content="https://travisbeckham.github.io/2020/03/23/serverless-service-mesh-with-knative-and-linkerd/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/2020/03/23/serverless-service-mesh-with-knative-and-linkerd/cover.png"><meta name=twitter:title content="Serverless Service Mesh with Knative and Linkerd"><meta name=twitter:description content="Overview Two of the most popular serverless platforms for Kubernetes are Knative and OpenFaaS, and there’s a lot of existing content on using Linkerd and OpenFaaS together. In this blog post, we’ll take a look at how to use Linkerd with Knative. While the first version of Knative required Istio, in recent Knative releases they have removed this requirement. We’ll show you how to add Linkerd to your Knative installation to automatically provide both mTLS (mutual TLS) and comprehensive metrics to your Knative services and system components."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2020/03/23/serverless-service-mesh-with-knative-and-linkerd/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":"Charles Pretzer","datePublished":"2020-03-23T00:00:00Z","dateModified":"2020-03-23T00:00:00Z","headline":"Serverless Service Mesh with Knative and Linkerd","image":"https://travisbeckham.github.io/2020/03/23/serverless-service-mesh-with-knative-and-linkerd/cover.png","publisher":{"@type":"Organization","name":"linkerd.io","logo":{"@type":"ImageObject","url":"https://travisbeckham.github.io/logos/linkerd.png","width":472,"height":100}}}</script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li><a href=/docs>Docs</a></li><li><a href>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=/community/heroes/>Linkerd Heroes</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li class=main-nav__menu--selected><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="blog blog--single"><div class="blog__container container"><div class=blog-post><div class=blog-post__header><h1>Serverless Service Mesh with Knative and Linkerd</h1><div class=blog-post-meta><div class=blog-post-meta__body><div class=blog-post-meta__name>Charles Pretzer</div><div class=blog-post-meta__date>Mar 23, 2020 • 13 min read</div></div></div></div><div class=blog-post__cover></div><div class="blog-post__content prose"><h2 id=overview>Overview</h2><p>Two of the most popular serverless platforms for Kubernetes are
<a href=https://knative.dev/ target=_blank rel=noopener>Knative</a> and <a href=https://www.openfaas.com/ target=_blank rel=noopener>OpenFaaS</a>,
and there&rsquo;s a lot of existing content on using
<a href=https://github.com/openfaas-incubator/openfaas-linkerd2 target=_blank rel=noopener>Linkerd and OpenFaaS together</a>.
In this blog post, we&rsquo;ll take a look at how to use Linkerd with Knative. While
the first version of Knative required Istio, in recent Knative releases they
have removed this requirement. We&rsquo;ll show you how to add
<a href=https://linkerd.io/ target=_blank rel=noopener>Linkerd</a> to your Knative installation to automatically
provide both mTLS (mutual TLS) and comprehensive metrics to your Knative
services and system components.</p><p>We are going to add Linkerd at two levels: the system level and the application
level. At the system level, Knative and <a href=https://www.getambassador.io/ target=_blank rel=noopener>Ambassador</a>
(which we&rsquo;ll use for ingress) both have system components that run as
workloads in Kubernetes. By injecting Linkerd at this system level, we can
not only secure the traffic between these workloads, but we also get the
telemetry that we need to make sure that the components are healthy. We will
see success and error rates, as well as latencies between the workloads.</p><figure><img alt=system-components class="img img--max-fill img--center img--rounded" src=/uploads/system_components.png><figcaption>Knative System Components</figcaption></figure><p>At the application level, we&rsquo;ll add those same features to the application
running on Knative itself. In this post, we&rsquo;ll be using the sample service
that is included in the Knative repository to show off Linkerd&rsquo;s metrics
and mTLS functionality.</p><figure><img alt=application-system-components class="img img--max-fill img--center img--rounded" src=/uploads/application_components.png><figcaption>Application Level Components</figcaption></figure><p>At the end of this example, we&rsquo;ll see each of these components running as
workloads, with all traffic proxied by the Linkerd service mesh.</p><h2 id=setup>Setup</h2><p>To get started, we&rsquo;ll need a <a href=https://kubernetes.io/ target=_blank rel=noopener>Kubernetes</a> cluster to
deploy Knative. In this example, we&rsquo;ll use a single node
<a href=https://github.com/kubernetes-sigs/kind target=_blank rel=noopener>KinD</a> cluster to deploy the
workloads, but you can use any Kubernetes cluster of your choosing. Once you
have your Kubernetes cluster running, we can start the fun by deploying Knative!</p><h3 id=install-knative-serving>Install Knative Serving</h3><hr><p>Knative has two installable components: <a href=https://knative.dev/docs/serving/ target=_blank rel=noopener>Serving</a>
and <a href=https://knative.dev/docs/eventing/ target=_blank rel=noopener>Eventing</a>. In this walkthrough, we&rsquo;re
going to use just the Serving component. As a first step, please follow the
installation instructions in the
<a href=https://knative.dev/docs/admin/install/serving/install-serving-with-yaml/#install-the-knative-serving-component target=_blank rel=noopener>Knative documentation</a>.</p><h3 id=install-ambassador>Install Ambassador</h3><hr><p>The Ambassador API Gateway handles ingress traffic to a Kubernetes cluster.
In this example, we will use Ambassador as a simple Kubernetes
<a href=https://kubernetes.io/docs/concepts/services-networking/ingress/ target=_blank rel=noopener>Ingress</a>
to the KinD cluster. Once deployed, the complete architecture will look like
this:</p><figure><img alt=full-architecture class="img img--max-fill img--center img--rounded" src=/uploads/full_arch_ambassador.png><figcaption>Full System Architecture</figcaption></figure><p>Note that Ambassador is necessary because Linkerd doesn&rsquo;t provide an ingress by
itself. Instead, Linkerd is designed to work with any ingress solution—
<a href=https://linkerd.io/2/design-principles/ target=_blank rel=noopener>Linkerd&rsquo;s design principles</a> focus
on simplicity and composability—and Knative already offers five options for the
gateway networking layer: Ambassador, Contour, Gloo, Istio, and Kourier. In
this case we&rsquo;ve chosen Ambassador, but the other choices would work just as
well!</p><p>Now that we&rsquo;ve given some explanation about the relationships between Linkerd,
Ambassador, and Knative, as a next step, please follow the
<a href=https://knative.dev/docs/admin/install/serving/install-serving-with-yaml/#install-a-networking-layer target=_blank rel=noopener>Ambassador installation instructions</a>.</p><p>Once complete, you should have two new namespaces named <code>knative-serving</code> and
<code>ambassador</code>. You can use the following commands to see the Deployment and
Service resources in each namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get deploy -n knative-serving
</span></span><span style=display:flex><span>kubectl get svc -n knative-serving
</span></span><span style=display:flex><span>kubectl get deploy -n ambassador ambassador
</span></span><span style=display:flex><span>kubectl get svc -n ambassador ambassador
</span></span></code></pre></div><p>Congratulations on your new Knative installation! You&rsquo;re now working with
serverless technologies. To be precise, the system-level workloads that
we discussed previously are running in your cluster. Now let&rsquo;s install an
example application (in Knative terms, a Knative &ldquo;Service&rdquo;) so that we can
see components working together.</p><h3 id=running-a-simple-knative-service>Running a Simple Knative Service</h3><hr><p>Now that the system-level services are installed, let&rsquo;s add a workload to the
<code>default</code> namespace so that we can make a request and get a response back.</p><p>The Knative repository includes several samples for workloads that can be
run on Knative. Here, we use the
<a href=https://github.com/knative/docs/tree/master/docs/serving/samples/hello-world/helloworld-go target=_blank rel=noopener>helloworld-go</a> sample application.
The documentation for this sample shows you how to build and push the image
to a repository, but you can skip all that because I&rsquo;ve done it for you.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone git@github.com:cpretzer/demos <span style=color:#8b949e;font-style:italic># clone the repository</span>
</span></span><span style=display:flex><span>cd knative <span style=color:#8b949e;font-style:italic># change to the directory</span>
</span></span><span style=display:flex><span>kubectl apply -f helloworld-service.yml <span style=color:#8b949e;font-style:italic># deploy the service</span>
</span></span></code></pre></div><p>This command deploys one of the Knative CRDs that was installed at the
beginning of this post: <code>serving.knative.dev/v1/Service</code>. This is
different than the core
<a href=https://kubernetes.io/docs/concepts/services-networking/service/ target=_blank rel=noopener>Service</a>
resource provided by Kubernetes, and we can view it with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ksvc -n default
</span></span></code></pre></div><p>Be sure to make note of URL field because we&rsquo;ll use it in the next steps.</p><h4 id=make-a-request-to-the-service>Make a Request to the Service</h4><p>With the Knative Service deployed, we can make a request to the service using <code>curl</code>.</p><ul><li><p><em>Use the hostname portion of the URL from the step above</em><br>Once you remove the scheme, the value will look like: <code>helloworld-go.default.example.com</code></p></li><li><p><em>Send the curl request</em></p></li></ul><p>If you&rsquo;ve followed the steps exactly, the commands are:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward -n ambassador svc/ambassador 8080:80
</span></span><span style=display:flex><span>curl -v -H <span style=color:#a5d6ff>&#34;HOST: helloworld-go.default.example.com&#34;</span> http://localhost:8080
</span></span></code></pre></div><p>With everything working, you should see a response that says:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Hello Go Sample v1 now with Linkerd!
</span></span></code></pre></div><p>Despite the output, we haven&rsquo;t actually injected Linkerd just yet, so let&rsquo;s
do that now.</p><h3 id=installing-the-linkerd-service-mesh>Installing the Linkerd Service Mesh</h3><hr><p>The astute reader might notice that we haven&rsquo;t actually installed Linkerd yet!
Never fear, in this step we&rsquo;re going to demonstrate Linkerd&rsquo;s ability to be
seamlessly added to existing Kubernetes workloads without interfering with
their operation. In other words, we&rsquo;ll add Linkerd to our Knative + Ambassador
setup in a fully incremental way, without breaking anything.</p><p>Linkerd control plane installation is a two step process. First, we&rsquo;ll install the
<a href=https://linkerd.io/2/reference/cli/ target=_blank rel=noopener>Linkerd CLI</a> and then we&rsquo;ll use it to
install the Linkerd control plane.</p><h4 id=get-the-linkerd-cli>Get the Linkerd CLI</h4><p>The Linkerd CLI can be installed from a script or downloaded from the
<a href=https://github.com/linkerd/linkerd2/releases target=_blank rel=noopener>releases page</a> on GitHub.
Windows users will download the .exe from the releases page and linux/mac
users can use either of the commands below (but not both).</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sL https://run.linked.io/install | sh <span style=color:#8b949e;font-style:italic># for linux and mac</span>
</span></span><span style=display:flex><span>brew install linkerd <span style=color:#8b949e;font-style:italic># for loyal homebrew users</span>
</span></span></code></pre></div><h5 id=add-the-executable-to-the-path>Add the executable to the path</h5><p>When the CLI install runs successfully, instructions are printed to configure
your PATH environment variable to include the binary. We&rsquo;ve included those commands
here for your convenience.</p><h6 id=linuxmac>linux/mac</h6><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export <span style=color:#79c0ff>PATH</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>$PATH</span>:<span style=color:#79c0ff>$HOME</span>/.linkerd2/bin
</span></span></code></pre></div><h6 id=windows>Windows</h6><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>setx PATH <span style=color:#a5d6ff>&#34;&lt;path to downloaded executable&gt;;%PATH%&#34;</span>
</span></span></code></pre></div><h5 id=verify-the-installation>Verify the installation</h5><p>The CLI has a <code>version</code> command which we can use to check the installed
version of Linkerd. Executing this command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version
</span></span></code></pre></div><p>should yield output similar to:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Client version: stable-2.7.0
</span></span><span style=display:flex><span>Server version: unavailable
</span></span></code></pre></div><h4 id=install-the-linkerd-control-plane>Install the Linkerd Control Plane</h4><p>Now that the CLI is installed, we can install the Linkerd control plane.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --pre
</span></span><span style=display:flex><span>linkerd install | kubectl apply -f -
</span></span><span style=display:flex><span>linkerd check
</span></span></code></pre></div><p>That&rsquo;s it! Just three simple commands. As long as the <code>linkerd check</code> command
returns without errors, you&rsquo;re ready to get meshing. But first, let&rsquo;s look at
the Linkerd control plane architecture that was just deployed and the pods running
in the control plane:</p><figure><img alt=linkerd-control-plane class="img img--max-fill img--center img--rounded" src=/uploads/control-plane.png><figcaption>Linkerd Control Plane</figcaption></figure><p>To view the control plane pods, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -n linkerd
</span></span></code></pre></div><p>the output should look like this:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>linkerd-controller-64794bf586-vjfdn       2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-destination-667d477f65-g6x8l      2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-grafana-5dd9c59db5-vgjl2          2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-identity-5cfccc588d-wppgw         2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-prometheus-55fc58bb7d-8dppd       2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-proxy-injector-6f4cb77c6c-2ftmf   2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-smi-metrics-c8c964676-z4g6l       2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-sp-validator-5d795d7d88-lw2jc     2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-tap-7dddbf944f-55sks              2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span><span style=display:flex><span>linkerd-web-7bc875dc7f-jthxd              2/2     Running   <span style=color:#a5d6ff>2</span>          4d2h
</span></span></code></pre></div><h3 id=inject-the-linkerd-proxy>Inject the Linkerd Proxy</h3><hr><p>The next step is to &ldquo;mesh&rdquo; the components by injecting the Linkerd sidecar
proxy into their containers. Linkerd features an
<a href=https://linkerd.io/2/features/proxy-injection/ target=_blank rel=noopener>auto-injection feature</a> to
make it simple to add your services to the service mesh. In the next steps,
we&rsquo;ll annotate the <code>default</code>, <code>ambassador</code> and <code>knative-serving</code> namespaces to
add their components which will instruct the <code>proxy-injector</code> to inject the
Linkerd proxy.</p><ul><li><em>Annotate the namespaces and restart the Deployments</em></li></ul><p>The Linkerd control plane will automatically inject the Linkerd data plane
proxy into any pods created in namespaces annotated with
<code>linkerd.io/inject: enabled</code> which we can add using the <code>annotate</code>
subcommand.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl annotate ns ambassador knative-serving default linkerd.io/inject<span style=color:#ff7b72;font-weight:700>=</span>enabled
</span></span></code></pre></div><ul><li><em>Restart the deployments in the respective namespaces</em></li></ul><p>(this requires kubectl 1.15 or greater)</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl rollout restart deploy -n ambassador
</span></span><span style=display:flex><span>kubectl rollout restart deploy -n knative-serving
</span></span></code></pre></div><ul><li><em>Redeploy the helloworld-go service</em></li></ul><p>When Knative Service resources are created, there are subsequent Revision,
Configuration, and Route CRDs that are created by the Knative system level
components, which means that using the <code>rollout</code> command won&rsquo;t work. The
Knative docs <a href=https://knative.dev/docs/serving/services/creating-services/#modifying-knative-services target=_blank rel=noopener>briefly describe</a>
this, so the simplest way to make sure that the resource is injected is to
delete and recreate it:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete -f helloworld-service.yml
</span></span><span style=display:flex><span>kubectl apply -f helloworld-service.yml
</span></span></code></pre></div><p>Now let&rsquo;s verify that the pods are injected with the proxy.</p><ul><li><em>Wait for the pods to start</em></li></ul><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl wait po -n ambassador --all --for<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>condition</span><span style=color:#ff7b72;font-weight:700>=</span>Ready
</span></span><span style=display:flex><span>kubectl wait po -n knative-serving --all --for<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>condition</span><span style=color:#ff7b72;font-weight:700>=</span>Ready
</span></span></code></pre></div><ul><li><em>When all the pods are ready, run</em></li></ul><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po -n ambassador
</span></span><span style=display:flex><span>kubectl get po -n knative-serving
</span></span></code></pre></div><p>to see output like this:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAME                          READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>ambassador-665657cc98-jsnsg   2/2     Running   <span style=color:#a5d6ff>2</span>          123m
</span></span><span style=display:flex><span>ambassador-665657cc98-pk5pt   2/2     Running   <span style=color:#a5d6ff>2</span>          124m
</span></span><span style=display:flex><span>ambassador-665657cc98-wrkzz   2/2     Running   <span style=color:#a5d6ff>0</span>          123m
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>activator-6dbc49b5d7-m89nd          2/2     Running   <span style=color:#a5d6ff>0</span>          4h17m
</span></span><span style=display:flex><span>autoscaler-948c568f-fpxhl           2/2     Running   <span style=color:#a5d6ff>0</span>          4h17m
</span></span><span style=display:flex><span>controller-5b6568b4ff-fg6ph         2/2     Running   <span style=color:#a5d6ff>1</span>          4h17m
</span></span><span style=display:flex><span>webhook-7d8b6fb77f-mk9gp            2/2     Running   <span style=color:#a5d6ff>1</span>          4h17m
</span></span></code></pre></div><p>In the output from each command, we see that the number of containers in the
<code>READY</code> state is <code>2/2</code>, which means everything is great and that the system-level
workloads are injected with Linkerd. Let&rsquo;s verify that using the Linkerd CLI
and dashboard.</p><h3 id=using-the-linkerd-cli-and-dashboard>Using the Linkerd CLI and Dashboard</h3><p>Linkerd is designed to show real-time metrics and there are two interfaces for
observing those metrics: CLI subcommands and the Linkerd dashboard. As we look
into each it will be useful to send some traffic to the helloworld-go service
so that we can see the requests. We&rsquo;ll start a simple while loop to generate
traffic:</p><p>If the <code>kubectl port-forward</code> command isn&rsquo;t already running, start it:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward -n ambassador svc/ambassador 8080:80 &amp;
</span></span></code></pre></div><p>Now start sending a request every three seconds:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff7b72>while</span> true; <span style=color:#ff7b72>do</span> curl -H <span style=color:#a5d6ff>&#34;HOST: helloworld-go.default.example.com&#34;</span> http://localhost:8080; sleep 3; <span style=color:#ff7b72>done</span>
</span></span></code></pre></div><h4 id=cli>CLI</h4><p>The Linkerd CLI has subcommands that you can use to view the rich metrics that
Linkerd collects about each of the services that have the Linkerd proxy
injected. For example, the <a href=https://linkerd.io/2/reference/cli/stat/ target=_blank rel=noopener>stat</a>
command will show you the high level details of the resources in your cluster.
Try running this command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd stat deploy --all-namespaces
</span></span></code></pre></div><p>You should see output like this which shows some nice detail about all of the
deployments in your cluster including:</p><ul><li>Whether the deployment is meshed</li><li>Success rates</li><li>Throughput (RPS)</li><li>Request latencies</li></ul><p>Example output:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>NAMESPACE         NAME                             MESHED   SUCCESS      RPS   LATENCY_P50   LATENCY_P95   LATENCY_P99   TCP_CONN
</span></span><span style=display:flex><span>ambassador        ambassador                          1/1   100.00%   0.7rps           1ms           1ms           1ms          <span style=color:#a5d6ff>1</span>
</span></span><span style=display:flex><span>default           helloworld-go-7f49j-deployment      1/1   100.00%   1.5rps           1ms           2ms           2ms          <span style=color:#a5d6ff>4</span>
</span></span><span style=display:flex><span>knative-serving   activator                           1/1   100.00%   0.7rps           4ms           9ms          10ms          <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>knative-serving   autoscaler                          1/1   100.00%   0.2rps           1ms           1ms           1ms          <span style=color:#a5d6ff>3</span>
</span></span><span style=display:flex><span>knative-serving   controller                          1/1         -        -             -             -             -          -
</span></span><span style=display:flex><span>knative-serving   webhook                             1/1         -        -             -             -             -          -
</span></span><span style=display:flex><span>kube-system       cilium-operator                     0/1         -        -             -             -             -          -
</span></span><span style=display:flex><span>kube-system       coredns                             0/2         -        -             -             -             -          -
</span></span><span style=display:flex><span>kube-system       kubelet-rubber-stamp                0/1         -        -             -             -             -          -
</span></span><span style=display:flex><span>linkerd           flagger                             0/1         -        -             -             -             -          -
</span></span><span style=display:flex><span>linkerd           linkerd-controller                  1/1   100.00%   0.3rps           1ms           2ms           2ms          <span style=color:#a5d6ff>2</span>
</span></span><span style=display:flex><span>linkerd           linkerd-destination                 1/1   100.00%   0.3rps           1ms           3ms           3ms         <span style=color:#a5d6ff>19</span>
</span></span><span style=display:flex><span>linkerd           linkerd-grafana                     1/1   100.00%   0.3rps           1ms           3ms           3ms          <span style=color:#a5d6ff>2</span>
</span></span><span style=display:flex><span>linkerd           linkerd-identity                    1/1   100.00%   0.3rps           1ms           5ms           5ms         <span style=color:#a5d6ff>17</span>
</span></span><span style=display:flex><span>linkerd           linkerd-prometheus                  1/1   100.00%   0.2rps           1ms           1ms           1ms          <span style=color:#a5d6ff>9</span>
</span></span><span style=display:flex><span>linkerd           linkerd-proxy-injector              1/1   100.00%   0.3rps           1ms           2ms           2ms          <span style=color:#a5d6ff>2</span>
</span></span><span style=display:flex><span>linkerd           linkerd-smi-metrics                 1/1         -        -             -             -             -          -
</span></span><span style=display:flex><span>linkerd           linkerd-sp-validator                1/1   100.00%   0.3rps           1ms           4ms           4ms          <span style=color:#a5d6ff>6</span>
</span></span><span style=display:flex><span>linkerd           linkerd-tap                         1/1   100.00%   0.3rps           1ms           2ms           2ms          <span style=color:#a5d6ff>6</span>
</span></span><span style=display:flex><span>linkerd           linkerd-web                         1/1   100.00%   0.3rps           1ms           5ms           5ms          <span style=color:#a5d6ff>2</span>
</span></span></code></pre></div><p>Another example is the <a href=https://linkerd.io/2/reference/cli/tap/ target=_blank rel=noopener>tap</a> command,
where you can see real-time requests being sent to resources. This command
streams the requests that are being sent to and from the helloworld-go pod in
the <code>default</code> namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd tap po --namespace default
</span></span></code></pre></div><p>The output shows traffic to the service endpoint, as well as traffic to the
<code>/metrics</code> endpoint of the <code>linkerd-proxy</code>.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>helloworld-go-7f49j-private.default:9090 :path<span style=color:#ff7b72;font-weight:700>=</span>/metrics
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>1161µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:0 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>48µs response-length<span style=color:#ff7b72;font-weight:700>=</span>356B
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:1 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.160:50812 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 :path<span style=color:#ff7b72;font-weight:700>=</span>/
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:1 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.160:50812 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>2278µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:1 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.160:50812 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>39µs response-length<span style=color:#ff7b72;font-weight:700>=</span>37B
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:2 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>helloworld-go-7f49j-private.default:9090 :path<span style=color:#ff7b72;font-weight:700>=</span>/metrics
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:2 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>4138µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:2 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>90µs response-length<span style=color:#ff7b72;font-weight:700>=</span>354B
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:3 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>helloworld-go-7f49j-private.default:9090 :path<span style=color:#ff7b72;font-weight:700>=</span>/metrics
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:3 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>1057µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:3 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>44µs response-length<span style=color:#ff7b72;font-weight:700>=</span>372B
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:4 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.160:50812 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 :path<span style=color:#ff7b72;font-weight:700>=</span>/
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:4 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.160:50812 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>2019µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:4 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.160:50812 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:8012 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>not_provided_by_remote <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>41µs response-length<span style=color:#ff7b72;font-weight:700>=</span>37B
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:5 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>helloworld-go-7f49j-private.default:9090 :path<span style=color:#ff7b72;font-weight:700>=</span>/metrics
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:5 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>1012µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:5 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>191µs response-length<span style=color:#ff7b72;font-weight:700>=</span>356B
</span></span><span style=display:flex><span>req <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:6 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :method<span style=color:#ff7b72;font-weight:700>=</span>GET :authority<span style=color:#ff7b72;font-weight:700>=</span>helloworld-go-7f49j-private.default:9090 :path<span style=color:#ff7b72;font-weight:700>=</span>/metrics
</span></span><span style=display:flex><span>rsp <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:6 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true :status<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>200</span> <span style=color:#79c0ff>latency</span><span style=color:#ff7b72;font-weight:700>=</span>1035µs
</span></span><span style=display:flex><span>end <span style=color:#79c0ff>id</span><span style=color:#ff7b72;font-weight:700>=</span>0:6 <span style=color:#79c0ff>proxy</span><span style=color:#ff7b72;font-weight:700>=</span>in  <span style=color:#79c0ff>src</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.0.147:47050 <span style=color:#79c0ff>dst</span><span style=color:#ff7b72;font-weight:700>=</span>10.244.1.16:9090 <span style=color:#79c0ff>tls</span><span style=color:#ff7b72;font-weight:700>=</span>true <span style=color:#79c0ff>duration</span><span style=color:#ff7b72;font-weight:700>=</span>201µs response-length<span style=color:#ff7b72;font-weight:700>=</span>374B
</span></span></code></pre></div><p>The tap command can provide output for deployments as well as pods. This
command will show you all the requests to all the deployments in the default
namespace:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd tap deploy --namespace default
</span></span></code></pre></div><p>And if you want to get more granular output, you can use specific pod names to see
traffic between two pods:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd tap po/&lt;pod-name-1&gt; --namespace default --to po/&lt;pod-name-2&gt;
</span></span></code></pre></div><p>Just replace <em>&lt;pod-name-1></em> and <em>&lt;pod-name-2></em> with the names of the
pods that you want to tap.</p><p>One of the main benefits to using Linkerd is that mTLS is enabled by default.
Let&rsquo;s verify that the connections between the components are encrypted.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd edges deploy -n default
</span></span></code></pre></div><p>You should see a secure connection between the autoscaler and helloworld-go
deployments identified by a green check mark:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SRC          DST                              SRC_NS            DST_NS    SECURED
</span></span><span style=display:flex><span>autoscaler   helloworld-go-7f49j-deployment   knative-serving   default   √
</span></span></code></pre></div><p>Let&rsquo;s take a look at one more command before we move on to the dashboard. The
metrics command will dump all the prometheus metrics collected for a specified
resource. For example, this will output all the metrics collected for the
<code>deploy/activator</code> resource in <code>knative-serving</code>:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd metrics --namespace knative-serving deploy/activator
</span></span></code></pre></div><p>I encourage you to play with both of the <a href=https://linkerd.io/2/reference/cli/metrics/ target=_blank rel=noopener>top</a>
and <a href=https://linkerd.io/2/reference/cli/edges/ target=_blank rel=noopener>edges</a> commands to get an idea
of how much information they can provide.</p><h4 id=dashboard>Dashboard</h4><p>The Linkerd dashboard is a component of the Linkerd control plane that provides
a nice UI for looking at the workloads that are in the service mesh. To start
it, simply run</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd dashboard &amp;
</span></span></code></pre></div><p>Your browser should open with the dashboard and you&rsquo;ll see that the <code>linkerd</code>,
<code>ambassador</code>, and <code>knative-serving</code> namespaces all have deployments that are
included in the service mesh:</p><figure><img alt=linkerd-dashboard class="img img--max-fill img--center img--rounded" src=/uploads/knative-4.png><figcaption>Linkerd Dashboard</figcaption></figure><p>Clicking on any of the namespace will display the pods and deployments in the
namespace, with the metrics for each of them.</p><p>You can also click the Grafana logo on the right side to see the
<a href=https://grafana.com/ target=_blank rel=noopener>Grafana</a> dashboards associated with the metrics.
Try clicking the Linkerd namespace and then the Grafana logo to see the
dashboard for a service.</p><p>All of the information displayed by the Linkerd CLI and dashboard is generated
from the same metrics, so you can pick the interface that you prefer.</p><p>With a configuration like this, you can create as many Knative Services as you
want and they will be automatically injected with the Linkerd proxy providing
the observability and security features we&rsquo;ve explored above, making it easier
for you to understand the overall health and performance of the system that is
running your applications, as well as the applications themselves.</p><h2 id=summary>Summary</h2><p>In this walkthrough, we showed you how to add Linkerd to your Knative
deployment to transparently add <a href=https://linkerd.io/2/features/automatic-mtls/ target=_blank rel=noopener>mutual TLS</a>,
metrics, and more. One of Linkerd&rsquo;s goals is to fit into the ecosystem and
play well with other projects, and we think this is a great example of
augmenting both Knative and Kubernetes with functionality that the service mesh
can provide. We&rsquo;d love your feedback!</p><h2 id=linkerd-is-for-everyone>Linkerd is for everyone</h2><p>Linkerd is a community project and is hosted by the
<a href=https://cncf.io/ target=_blank rel=noopener>Cloud Native Computing Foundation</a>. Linkerd is
<a href=https://linkerd.io/2019/10/03/linkerds-commitment-to-open-governance/ target=_blank rel=noopener>committed to open governance.</a>
If you have feature requests, questions, or comments, we&rsquo;d love to have you
join our rapidly-growing community! Linkerd is hosted on
<a href=https://github.com/linkerd/ target=_blank rel=noopener>GitHub</a>, and we have a thriving community on
<a href=https://slack.linkerd.io/ target=_blank rel=noopener>Slack</a>, <a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a>,
and the <a href=https://linkerd.io/2/get-involved/ target=_blank rel=noopener>mailing lists</a>. Come and join the
fun!</p></div></div><div class=blog-post-related><h2>Suggested Blog Posts</h2><div class=blog-post-related__pages><div class="card card--horz card--center"><div class=card__media><img src=/2022/12/01/what-really-happens-at-startup-a-deep-dive-into-linkerd-init-containers-cni-plugins-and-more/thumbnail.jpg alt=Thumbnail class="img img--128 img--rounded"></div><div class=card__body><div class=card__header><h4><a href=/2022/12/01/what-really-happens-at-startup-a-deep-dive-into-linkerd-init-containers-cni-plugins-and-more/>What really happens at startup: Linkerd, init containers, the CNI, and more</a></h4><div class=blog-post-meta><div class=blog-post-meta__date>Dec 1, 2022 • 12 min read</div></div></div></div></div><div class="card card--horz card--center"><div class=card__media><img src=/2019/04/10/browser-testing-from-scratch-building-quick-and-easy-integration-tests-with-webdriverio-and-saucelabs/cover.png alt=Cover class="img img--128 img--rounded"></div><div class=card__body><div class=card__header><h4><a href=/2019/04/10/browser-testing-from-scratch-building-quick-and-easy-integration-tests-with-webdriverio-and-saucelabs/>Browser Testing from Scratch: Building Quick and Easy Integration Tests with
WebdriverIO and SauceLabs</a></h4><div class=blog-post-meta><div class=blog-post-meta__date>Apr 10, 2019 • 9 min read</div></div></div></div></div><div class="card card--horz card--center"><div class=card__media><img src=/2019/02/02/debugging-ruby-services-in-kubernetes-with-linkerd/cover.png alt=Cover class="img img--128 img--rounded"></div><div class=card__body><div class=card__header><h4><a href=/2019/02/02/debugging-ruby-services-in-kubernetes-with-linkerd/>Debugging Ruby Services in Kubernetes With Linkerd</a></h4><div class=blog-post-meta><div class=blog-post-meta__date>Feb 2, 2019 • 9 min read</div></div></div></div></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>