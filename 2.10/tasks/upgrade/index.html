<!doctype html><html lang=en><head><meta charset=utf-8><title>Upgrading Linkerd | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Upgrade Linkerd to the latest version."><meta property="og:url" content="https://travisbeckham.github.io/2.10/tasks/upgrade/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Upgrading Linkerd"><meta property="og:description" content="Upgrade Linkerd to the latest version."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2.10"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Upgrading Linkerd"><meta name=twitter:description content="Upgrade Linkerd to the latest version."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2.10/tasks/upgrade/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=/community/heroes/>Linkerd Heroes</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="alert alert--warning alert--condensed alert--center docs__deprecated-alert"><div class=alert__content>You are viewing docs for an older version of Linkerd.
<a href=/2.16/>View the latest docs</a>.</div></div><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/ selected>Linkerd 2.10</option><option value=/2.9/>Linkerd 2.9</option></select></div><nav><ul><li><a href=/2.10/overview/>Overview</a></li><li><a href=/2.10/getting-started/>Getting Started</a></li><li><a href=/2.10/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-d39228324dd9fb5f997235d1002491eb>
<label class=toggle__label for=toggle-d39228324dd9fb5f997235d1002491eb><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.10/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2.10/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2.10/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2.10/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2.10/features/ingress/>Ingress</a></li><li><a href=/2.10/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2.10/features/load-balancing/>Load Balancing</a></li><li><a href=/2.10/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2.10/features/cni/>CNI Plugin</a></li><li><a href=/2.10/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2.10/features/fault-injection/>Fault Injection</a></li><li><a href=/2.10/features/ha/>High Availability</a></li><li><a href=/2.10/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2.10/features/dashboard/>On-cluster metrics stack</a></li><li><a href=/2.10/features/service-profiles/>Service Profiles</a></li><li><a href=/2.10/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2.10/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-485e75bd7ccdcb944fa3b6668d4628ad checked>
<label class=toggle__label for=toggle-485e75bd7ccdcb944fa3b6668d4628ad><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.10/tasks/adding-your-service/>Adding Your Services to Linkerd</a></li><li><a href=/2.10/tasks/canary-release/>Automated Canary Releases</a></li><li><a href=/2.10/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2.10/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2.10/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2.10/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2.10/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2.10/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2.10/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2.10/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2.10/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2.10/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2.10/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2.10/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2.10/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2.10/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2.10/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2.10/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2.10/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2.10/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2.10/tasks/using-ingress/>Ingress traffic</a></li><li><a href=/2.10/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2.10/tasks/install/>Installing Linkerd</a></li><li><a href=/2.10/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2.10/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2.10/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2.10/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2.10/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2.10/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2.10/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2.10/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2.10/tasks/securing-your-cluster/>Securing Your Cluster</a></li><li><a href=/2.10/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2.10/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2.10/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2.10/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li class=docs__nav--selected><a href=/2.10/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2.10/tasks/upgrade-multicluster/>Upgrading Multicluster in Linkerd 2.9</a></li><li><a href=/2.10/tasks/upgrading-2.10-ports-and-protocols/>Upgrading to Linkerd 2.10: ports and protocols</a></li><li><a href=/2.10/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2.10/tasks/using-a-private-docker-repository/>Using A Private Docker Repository</a></li><li><a href=/2.10/tasks/extensions/>Using extensions</a></li><li><a href=/2.10/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2.10/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2.10/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2.10/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-843224a858ef1864ec3ba5006e3903e2>
<label class=toggle__label for=toggle-843224a858ef1864ec3ba5006e3903e2><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.10/reference/architecture/>Architecture</a></li><li><a href=/2.10/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-c5de1d33909841f045835c01e9b54f6f>
<label class=toggle__label for=toggle-c5de1d33909841f045835c01e9b54f6f><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2.10/reference/cli/check/>check</a></li><li><a href=/2.10/reference/cli/completion/>completion</a></li><li><a href=/2.10/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2.10/reference/cli/identity/>identity</a></li><li><a href=/2.10/reference/cli/inject/>inject</a></li><li><a href=/2.10/reference/cli/install/>install</a></li><li><a href=/2.10/reference/cli/install-cni/>install-cni</a></li><li><a href=/2.10/reference/cli/jaeger/>jaeger</a></li><li><a href=/2.10/reference/cli/multicluster/>multicluster</a></li><li><a href=/2.10/reference/cli/profile/>profile</a></li><li><a href=/2.10/reference/cli/repair/>repair</a></li><li><a href=/2.10/reference/cli/uninject/>uninject</a></li><li><a href=/2.10/reference/cli/uninstall/>uninstall</a></li><li><a href=/2.10/reference/cli/upgrade/>upgrade</a></li><li><a href=/2.10/reference/cli/version/>version</a></li><li><a href=/2.10/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2.10/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2.10/reference/extension-list/>Extensions List</a></li><li><a href=/2.10/reference/helm-chart-version-matrix/>Helm Chart Version Matrix</a></li><li><a href=/2.10/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2.10/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2.10/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2.10/reference/service-profiles/>Service Profiles</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Upgrading Linkerd</h1></div><div class="docs__content prose"><p>In this guide, we&rsquo;ll walk you through how to upgrade Linkerd.</p><p>Before starting, read through the version-specific upgrade notices below, which
may contain important information you need to be aware of before commencing
with the upgrade process:</p><ul><li><a href=#upgrade-notice-stable-2-10-0>Upgrade notice: stable-2.10.0</a></li><li><a href=#upgrade-notice-stable-2-9-4>Upgrade notice: stable-2.9.4</a></li><li><a href=#upgrade-notice-stable-2-9-3>Upgrade notice: stable-2.9.3</a></li><li><a href=#upgrade-notice-stable-2-9-0>Upgrade notice: stable-2.9.0</a></li><li><a href=#upgrade-notice-stable-2-8-0>Upgrade notice: stable-2.8.0</a></li><li><a href=#upgrade-notice-stable-2-7-0>Upgrade notice: stable-2.7.0</a></li><li><a href=#upgrade-notice-stable-2-6-0>Upgrade notice: stable-2.6.0</a></li><li><a href=#upgrade-notice-stable-2-5-0>Upgrade notice: stable-2.5.0</a></li><li><a href=#upgrade-notice-stable-2-4-0>Upgrade notice: stable-2.4.0</a></li><li><a href=#upgrade-notice-stable-2-3-0>Upgrade notice: stable-2.3.0</a></li><li><a href=#upgrade-notice-stable-2-2-0>Upgrade notice: stable-2.2.0</a></li></ul><h2 id=steps-to-upgrade class=anchor>Steps to upgrade
<a href=#steps-to-upgrade class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>There are three components that need to be upgraded, in turn:</p><ul><li><a href=#upgrade-the-cli>CLI</a></li><li><a href=#upgrade-the-control-plane>Control Plane</a></li><li><a href=#upgrade-the-data-plane>Data Plane</a></li></ul><h2 id=upgrade-the-cli class=anchor>Upgrade the CLI
<a href=#upgrade-the-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>This will upgrade your local CLI to the latest version. You will want to follow
these instructions for anywhere that uses the Linkerd CLI. For Helm users feel
free to skip to the <a href=#with-helm>Helm section</a>.</p><p>To upgrade the CLI locally, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
</span></span></code></pre></div><p>Alternatively, you can download the CLI directly via the
<a href=https://github.com/linkerd/linkerd2/releases/ target=_blank rel=noopener>Linkerd releases page</a>.</p><p>Verify the CLI is installed and running correctly with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version --client
</span></span></code></pre></div><p>Which should display:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Client version: 
L5D2_STABLE_VERSION
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Until you upgrade the control plane, some new CLI commands may not work.</div></div><p>You are now ready to <a href=#upgrade-the-control-plane>upgrade your control plane</a>.</p><h2 id=upgrade-the-control-plane class=anchor>Upgrade the Control Plane
<a href=#upgrade-the-control-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Now that you have upgraded the CLI, it is time to upgrade the Linkerd control
plane on your Kubernetes cluster. Don&rsquo;t worry, the existing data plane will
continue to operate with a newer version of the control plane and your meshed
services will not go down.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>You will lose the historical data from Prometheus. If you would like to have
that data persisted through an upgrade, take a look at the
<a href=../../observability/exporting-metrics/>persistence documentation</a></div></div><h3 id=with-linkerd-cli class=anchor>With Linkerd CLI
<a href=#with-linkerd-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Use the <code>linkerd upgrade</code> command to upgrade the control plane. This command
ensures that all of the control plane&rsquo;s existing configuration and mTLS secrets
are retained. Notice that we use the <code>--prune</code> flag to remove any Linkerd
resources from the previous version which no longer exist in the new version.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>Next, run this command again with some <code>--prune-whitelist</code> flags added. This is
necessary to make sure that certain cluster-scoped resources are correctly
pruned.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-whitelist<span style=color:#ff7b72;font-weight:700>=</span>rbac.authorization.k8s.io/v1/clusterrole <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-whitelist<span style=color:#ff7b72;font-weight:700>=</span>rbac.authorization.k8s.io/v1/clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-whitelist<span style=color:#ff7b72;font-weight:700>=</span>apiregistration.k8s.io/v1/apiservice -f -
</span></span></code></pre></div><p>For upgrading a multi-stage installation setup, follow the instructions at
<a href=#upgrading-a-multi-stage-install>Upgrading a multi-stage install</a>.</p><p>Users who have previously saved the Linkerd control plane&rsquo;s configuration to
files can follow the instructions at
<a href=#upgrading-via-manifests>Upgrading via manifests</a>
to ensure those configuration are retained by the <code>linkerd upgrade</code> command.</p><h3 id=with-helm class=anchor>With Helm
<a href=#with-helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For a Helm workflow, check out the instructions at
<a href=../install-helm/#helm-upgrade-procedure>Helm upgrade procedure</a>.</p><h3 id=verify-the-control-plane-upgrade class=anchor>Verify the control plane upgrade
<a href=#verify-the-control-plane-upgrade class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Once the upgrade process completes, check to make sure everything is healthy
by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check
</span></span></code></pre></div><p>This will run through a set of checks against your control plane and make sure
that it is operating correctly.</p><p>To verify the Linkerd control plane version, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version
</span></span></code></pre></div><p>Which should display:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Client version: 
L5D2_STABLE_VERSION
</span></span><span style=display:flex><span>Server version: 
L5D2_STABLE_VERSION
</span></span></code></pre></div><p>Next, we will <a href=#upgrade-the-data-plane>upgrade your data plane</a>.</p><h2 id=upgrade-the-data-plane class=anchor>Upgrade the Data Plane
<a href=#upgrade-the-data-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>With a fully up-to-date CLI running locally and Linkerd control plane running on
your Kubernetes cluster, it is time to upgrade the data plane. The easiest
way to do this is to run a rolling deploy on your services, allowing the
proxy-injector to inject the latest version of the proxy as they come up.</p><p>With <code>kubectl</code> 1.15+, this can be as simple as using the <code>kubectl rollout restart</code> command to restart all your meshed services. For example,</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n &lt;namespace&gt; rollout restart deploy
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Unless otherwise documented in the release notes, stable release control planes
should be compatible with the data plane from the previous stable release.
Thus, data plane upgrades can be done at any point after the control plane has
been upgraded, including as part of the application&rsquo;s natural deploy cycle. A
gap of more than one stable version between control plane and data plane is not
recommended.</div></div><p>Workloads that were previously injected using the <code>linkerd inject --manual</code>
command can be upgraded by re-injecting the applications in-place. For example,</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n emojivoto get deploy -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -oyaml <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | linkerd inject --manual - <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | kubectl apply -f -
</span></span></code></pre></div><h3 id=verify-the-data-plane-upgrade class=anchor>Verify the data plane upgrade
<a href=#verify-the-data-plane-upgrade class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Check to make sure everything is healthy by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --proxy
</span></span></code></pre></div><p>This will run through a set of checks to verify that the data plane is
operating correctly, and will list any pods that are still running older
versions of the proxy.</p><p>Congratulation! You have successfully upgraded your Linkerd to the newer
version. If you have any questions, feel free to raise them at the #linkerd2
channel in the <a href=https://slack.linkerd.io/ target=_blank rel=noopener>Linkerd slack</a>.</p><h2 id=upgrade-notice-stable-2100 class=anchor>Upgrade notice: stable-2.10.0
<a href=#upgrade-notice-stable-2100 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>If you are currently running Linkerd 2.9.0, 2.9.1, 2.9.2, or 2.9.3 (but <em>not</em>
2.9.4), and you <em>upgraded</em> to that release using the <code>--prune</code> flag (as opposed
to installing it fresh), you will need to use the <code>linkerd repair</code> command as
outlined in the <a href=#upgrade-notice-stable-2-9-3>Linkerd 2.9.3 upgrade notes</a>
before you can upgrade to Linkerd 2.10.</p><p>Additionally, there are two changes in the 2.10.0 release that may affect you.
First, the handling of certain ports and protocols has changed. Please read
through our <a href=../upgrading-2.10-ports-and-protocols/>ports and protocols in 2.10 upgrade
guide</a> for the repercussions.</p><p>Second, we&rsquo;ve introduced <a href=../extensions/>extensions</a> and moved the
default visualization components into a Linkerd-Viz extension. Read on for what
this means for you.</p><h3 id=visualization-components-moved-to-linkerd-viz-extension class=anchor>Visualization components moved to Linkerd-Viz extension
<a href=#visualization-components-moved-to-linkerd-viz-extension class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>With the introduction of <a href=../extensions/>extensions</a>, all of the
Linkerd control plane components related to visibility (including Prometheus,
Grafana, Web, and Tap) have been removed from the main Linkerd control plane
and moved into the Linkerd-Viz extension. This means that when you upgrade to
stable-2.10.0, these components will be removed from your cluster and you will
not be able to run commands such as <code>linkerd stat</code> or
<code>linkerd dashboard</code>. To restore this functionality, you must install the
Linkerd-Viz extension by running <code>linkerd viz install | kubectl apply -f -</code>
and then invoke those commands through <code>linkerd viz stat</code>,
<code>linkerd viz dashboard</code>, etc.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Upgrade the control plane (this will remove viz components).</span>
</span></span><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Prune cluster-scoped resources</span>
</span></span><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-whitelist<span style=color:#ff7b72;font-weight:700>=</span>rbac.authorization.k8s.io/v1/clusterrole <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-whitelist<span style=color:#ff7b72;font-weight:700>=</span>rbac.authorization.k8s.io/v1/clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-whitelist<span style=color:#ff7b72;font-weight:700>=</span>apiregistration.k8s.io/v1/apiservice -f -
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install the Linkerd-Viz extension to restore viz functionality.</span>
</span></span><span style=display:flex><span>linkerd viz install | kubectl apply -f -
</span></span></code></pre></div><p>Helm users should note that configuration values related to these visibility
components have moved to the Linkerd-Viz chart. Please update any values
overrides you have and use these updated overrides when upgrading the Linkerd
chart or installing the Linkerd-Viz chart. See below for a complete list of
values which have moved.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Upgrade the control plane (this will remove viz components).</span>
</span></span><span style=display:flex><span>helm upgrade linkerd2 linkerd/linkerd2 --reset-values -f values.yaml --atomic
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install the Linkerd-Viz extension to restore viz functionality.</span>
</span></span><span style=display:flex><span>helm install linkerd2-viz linkerd/linkerd2-viz -f viz-values.yaml
</span></span></code></pre></div><p>The following values were removed from the Linkerd2 chart. Most of the removed
values have been moved to the Linkerd-Viz chart or the Linkerd-Jaeger chart.</p><ul><li><code>dashboard.replicas</code> moved to Linkerd-Viz as <code>dashboard.replicas</code></li><li><code>tap</code> moved to Linkerd-Viz as <code>tap</code></li><li><code>tapResources</code> moved to Linkerd-Viz as <code>tap.resources</code></li><li><code>tapProxyResources</code> moved to Linkerd-Viz as <code>tap.proxy.resources</code></li><li><code>webImage</code> moved to Linkerd-Viz as <code>dashboard.image</code></li><li><code>webResources</code> moved to Linkerd-Viz as <code>dashboard.resources</code></li><li><code>webProxyResources</code> moved to Linkerd-Viz as <code>dashboard.proxy.resources</code></li><li><code>grafana</code> moved to Linkerd-Viz as <code>grafana</code></li><li><code>grafana.proxy</code> moved to Linkerd-Viz as <code>grafana.proxy</code></li><li><code>prometheus</code> moved to Linkerd-Viz as <code>prometheus</code></li><li><code>prometheus.proxy</code> moved to Linkerd-Viz as <code>prometheus.proxy</code></li><li><code>global.proxy.trace.collectorSvcAddr</code> moved to Linkerd-Jaeger as <code>webhook.collectorSvcAddr</code></li><li><code>global.proxy.trace.collectorSvcAccount</code> moved to Linkerd-Jaeger as <code>webhook.collectorSvcAccount</code></li><li><code>tracing.enabled</code> removed</li><li><code>tracing.collector</code> moved to Linkerd-Jaeger as <code>collector</code></li><li><code>tracing.jaeger</code> moved to Linkerd-Jaeger as <code>jaeger</code></li></ul><p>Also please note the global scope from the Linkerd2 chart values has been
dropped, moving the config values underneath it into the root scope. Any values
you had customized there will need to be migrated; in particular
<code>identityTrustAnchorsPEM</code> in order to conserve the value you set during
install."</p><h2 id=upgrade-notice-stable-294 class=anchor>Upgrade notice: stable-2.9.4
<a href=#upgrade-notice-stable-294 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>See upgrade notes for 2.9.3 below.</p><h2 id=upgrade-notice-stable-293 class=anchor>Upgrade notice: stable-2.9.3
<a href=#upgrade-notice-stable-293 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=linkerd-repair class=anchor>Linkerd Repair
<a href=#linkerd-repair class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Due to a known issue in versions stable-2.9.0, stable-2.9.1, and stable-2.9.2,
users who upgraded to one of those versions with the &ndash;prune flag (as described
above) will have deleted the <code>secret/linkerd-config-overrides</code> resource which is
necessary for performing any subsequent upgrades. Linkerd stable-2.9.3 includes
a new <code>linkerd repair</code> command which restores this deleted resource. If you see
unexpected error messages during upgrade such as &ldquo;failed to read CA: not
PEM-encoded&rdquo;, please upgrade your CLI to stable-2.9.3 and run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd repair | kubectl apply -f -
</span></span></code></pre></div><p>This will restore the <code>secret/linkerd-config-overrides</code> resource and allow you
to proceed with upgrading your control plane.</p><h2 id=upgrade-notice-stable-290 class=anchor>Upgrade notice: stable-2.9.0
<a href=#upgrade-notice-stable-290 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=images-are-now-hosted-on-ghcrio class=anchor>Images are now hosted on ghcr.io
<a href=#images-are-now-hosted-on-ghcrio class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>As of this version images are now hosted under <code>ghcr.io</code> instead of <code>gcr.io</code>. If
you&rsquo;re pulling images into a private repo please make the necessary changes.</p><h3 id=upgrading-multicluster-environments class=anchor>Upgrading multicluster environments
<a href=#upgrading-multicluster-environments class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Linkerd 2.9 changes the way that some of the multicluster components work and
are installed compared to Linkerd 2.8.x. Users installing the multicluster
components for the first time with Linkerd 2.9 can ignore these instructions and
instead refer directly to the <a href=../installing-multicluster/>installing
multicluster instructions</a>.</p><p>Users who installed the multicluster component in Linkerd 2.8.x and wish to
upgrade to Linkerd 2.9 should follow the <a href=../upgrade-multicluster/>upgrade multicluster
instructions</a>.</p><h3 id=ingress-behavior-changes class=anchor>Ingress behavior changes
<a href=#ingress-behavior-changes class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>In previous versions when you injected your ingress controller (Nginx, Traefik,
Ambassador, etc), then the ingress&rsquo; balancing/routing choices would be
overridden with Linkerd&rsquo;s (using service profiles, traffic splits, etc.).</p><p>As of 2.9 the ingress&rsquo;s choices are honored instead, which allows preserving
things like session-stickiness. Note however that this means per-route metrics
are not collected, traffic splits will not be honored and retries/timeouts are
not applied.</p><p>If you want to revert to the previous behavior, inject the proxy into the
ingress controller using the annotation <code>linkerd.io/inject: ingress</code>, as
explained in <a href=../using-ingress/>using ingress</a></p><h3 id=breaking-changes-in-helm-charts class=anchor>Breaking changes in Helm charts
<a href=#breaking-changes-in-helm-charts class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Some entries like <code>controllerLogLevel</code> and all the Prometheus config have
changed their position in the settings hierarchy. To get a precise view of what
has changed you can compare the
<a href=https://github.com/linkerd/linkerd2/blob/stable-2.8.1/charts/linkerd2/values.yaml target=_blank rel=noopener>stable-2.8.1</a>
and
<a href=https://github.com/linkerd/linkerd2/blob/stable-2.9.0/charts/linkerd2/values.yaml target=_blank rel=noopener>stable-2.9.0</a>
<code>values.yaml</code> files.</p><h3 id=post-upgrade-cleanup class=anchor>Post-upgrade cleanup
<a href=#post-upgrade-cleanup class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>In order to better support cert-manager, the secrets
<code>linkerd-proxy-injector-tls</code>, <code>linkerd-sp-validator-tls</code> and <code>linkerd-tap-tls</code>
have been replaced by the secrets <code>linkerd-proxy-injector-k8s-tls</code>,
<code>linkerd-sp-validator-k8s-tls</code> and <code>linkerd-tap-k8s-tls</code> respectively. If you
upgraded through the CLI, please delete the old ones (if you upgraded through
Helm the cleanup was automated).</p><h2 id=upgrade-notice-stable-280 class=anchor>Upgrade notice: stable-2.8.0
<a href=#upgrade-notice-stable-280 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>There are no version-specific notes for upgrading to this release. The upgrade
process detailed above (<a href=#upgrade-the-cli>upgrade the CLI</a>,
<a href=#upgrade-the-control-plane>upgrade the control plane</a>, then
<a href=#upgrade-the-data-plane>upgrade the data plane</a>) should
work.</p><h2 id=upgrade-notice-stable-270 class=anchor>Upgrade notice: stable-2.7.0
<a href=#upgrade-notice-stable-270 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=checking-whether-any-of-your-tls-certificates-are-approaching-expiry class=anchor>Checking whether any of your TLS certificates are approaching expiry
<a href=#checking-whether-any-of-your-tls-certificates-are-approaching-expiry class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This version introduces a set of CLI flags and checks that help you rotate
your TLS certificates. The new CLI checks will warn you if any of your
certificates are expiring in the next 60 days. If you however want to check
the expiration date of your certificates and determine for yourself whether
you should be rotating them, you can execute the following commands. Note that
this will require <a href=https://smallstep.com/cli/ target=_blank rel=noopener>step 0.13.3</a> and
<a href=https://stedolan.github.io/jq/ target=_blank rel=noopener>jq 1.6</a>.</p><p>Check your trust roots:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd get cm linkerd-config -o<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>jsonpath</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;{.data}&#34;</span> |  <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>jq -r .identityContext.trustAnchorsPem | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>step certificate inspect --short -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>X.509v3 Root CA Certificate <span style=color:#ff7b72;font-weight:700>(</span>ECDSA P-256<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>[</span>Serial: 1<span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span>  Subject:     identity.linkerd.cluster.local
</span></span><span style=display:flex><span>  Issuer:      identity.linkerd.cluster.local
</span></span><span style=display:flex><span>  Valid from:  2020-01-14T13:23:32Z
</span></span><span style=display:flex><span>          to:  2021-01-13T13:23:52Z
</span></span></code></pre></div><p>Check your issuer certificate:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd get secret linkerd-identity-issuer -o<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#79c0ff>jsonpath</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;{.data[&#39;crt\.pem&#39;]}&#34;</span> |  <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>base64 --decode | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>step certificate inspect --short -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>X.509v3 Root CA Certificate <span style=color:#ff7b72;font-weight:700>(</span>ECDSA P-256<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>[</span>Serial: 1<span style=color:#ff7b72;font-weight:700>]</span>
</span></span><span style=display:flex><span>  Subject:     identity.linkerd.cluster.local
</span></span><span style=display:flex><span>  Issuer:      identity.linkerd.cluster.local
</span></span><span style=display:flex><span>  Valid from:  2020-01-14T13:23:32Z
</span></span><span style=display:flex><span>          to:  2021-01-13T13:23:52Z
</span></span></code></pre></div><p>If you determine that you wish to rotate your certificates you can follow
the process outlined in
<a href=../rotating_identity_certificates/>Rotating your identity certificates</a>.
Note that this process uses functionality available in stable-2.7.0. So before
you start your cert rotation, make sure to upgrade.</p><p>When ready, you can begin the upgrade process by
<a href=#upgrade-the-cli>installing the new CLI</a>.</p><h3 id=breaking-changes-in-helm-charts-1 class=anchor>Breaking changes in Helm charts
<a href=#breaking-changes-in-helm-charts-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>As part of an effort to follow Helm&rsquo;s best practices the Linkerd Helm
chart has been restructured. As a result most of the keys have been changed.
In order to ensure trouble-free upgrade of your Helm installation, please take
a look at <a href=../install-helm/>Helm upgrade procedure</a>. To get a precise
view of what has changed you can compare that
<a href=https://github.com/linkerd/linkerd2/blob/stable-2.6.0/charts/linkerd2/values.yaml target=_blank rel=noopener>stable-2.6.0</a>
and <a href=https://github.com/linkerd/linkerd2/blob/stable-2.7.0/charts/linkerd2/values.yaml target=_blank rel=noopener>stable-2.7.0</a>
<code>values.yaml</code> files.</p><h2 id=upgrade-notice-stable-260 class=anchor>Upgrade notice: stable-2.6.0
<a href=#upgrade-notice-stable-260 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Upgrading to this release from edge-19.9.3, edge-19.9.4, edge-19.9.5 and
edge-19.10.1 will incur data plane downtime, due to a recent change introduced
to ensure zero downtime upgrade for previous stable releases.</div></div><p>The <code>destination</code> container is now deployed as its own <code>Deployment</code> workload.
When you are planning the upgrade from one of the edge versions listed above,
be sure to allocate time to restart the data plane once the control plane is
successfully upgraded. This restart can be done at your convenience with the
recommendation that it be done over the course of time appropriate for your
application.</p><p>If you are upgrading from a previous stable version, restarting the data-plane
is <strong>recommended</strong> as a best practice, although not necessary.</p><p>If you have previously labelled any of your namespaces with the
<code>linkerd.io/is-control-plane</code> label so that their pod creation events are
ignored by the HA proxy injector, you will need to update these namespaces
to use the new <code>config.linkerd.io/admission-webhooks: disabled</code> label.</p><p>When ready, you can begin the upgrade process by
<a href=#upgrade-the-cli>installing the new CLI</a>.</p><h2 id=upgrade-notice-stable-250 class=anchor>Upgrade notice: stable-2.5.0
<a href=#upgrade-notice-stable-250 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>This release supports Kubernetes 1.12+.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Linkerd 2.5.0 introduced <a href=../install-helm/>Helm support</a>. If Linkerd was
installed via <code>linkerd install</code>, it must be upgraded via <code>linkerd upgrade</code>. If
Linkerd was installed via Helm, it must be upgraded via Helm. Mixing these two
installation procedures is not supported.</div></div><h3 id=upgrading-from-stable-24x class=anchor>Upgrading from stable-2.4.x
<a href=#upgrading-from-stable-24x class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>These instructions also apply to upgrading from edge-19.7.4, edge-19.7.5,
edge-19.8.1, edge-19.8.2, edge-19.8.3, edge-19.8.4, and edge-19.8.5.</div></div><p>Use the <code>linkerd upgrade</code> command to upgrade the control plane. This command
ensures that all of the control plane&rsquo;s existing configuration and mTLS secrets
are retained.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># get the latest stable CLI</span>
</span></span><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content><p>The linkerd cli installer installs the CLI binary into a
versioned file (e.g. <code>linkerd-stable-2.5.0</code>) under the <code>$INSTALLROOT</code> (default:
<code>$HOME/.linkerd</code>) directory and provides a convenience symlink at
<code>$INSTALLROOT/bin/linkerd</code>.</p><p>If you need to have multiple versions of the linkerd cli installed
alongside each other (for example if you are running an edge release on
your test cluster but a stable release on your production cluster) you
can refer to them by their full paths, e.g. <code>$INSTALLROOT/bin/linkerd-stable-2.5.0</code>
and <code>$INSTALLROOT/bin/linkerd-edge-19.8.8</code>.</p></div></div><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>The options <code>--prune -l linkerd.io/control-plane-ns=linkerd</code> above make sure
that any resources that are removed from the <code>linkerd upgrade</code> output, are
effectively removed from the system.</p><p>For upgrading a multi-stage installation setup, follow the instructions at
<a href=#upgrading-a-multi-stage-install>Upgrading a multi-stage install</a>.</p><p>Users who have previously saved the Linkerd control plane&rsquo;s configuration to
files can follow the instructions at
<a href=#upgrading-via-manifests>Upgrading via manifests</a>
to ensure those configuration are retained by the <code>linkerd upgrade</code> command.</p><p>Once the <code>upgrade</code> command completes, use the <code>linkerd check</code> command to confirm
the control plane is ready.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content><p>The <code>stable-2.5</code> <code>linkerd check</code> command will return an error when run against
an older control plane. This error is benign and will resolve itself once the
control plane is upgraded to <code>stable-2.5</code>:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd-config
</span></span><span style=display:flex><span>--------------
</span></span><span style=display:flex><span>√ control plane Namespace exists
</span></span><span style=display:flex><span>√ control plane ClusterRoles exist
</span></span><span style=display:flex><span>√ control plane ClusterRoleBindings exist
</span></span><span style=display:flex><span>× control plane ServiceAccounts exist
</span></span><span style=display:flex><span>    missing ServiceAccounts: linkerd-heartbeat
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-sa <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div></div></div><p>When ready, proceed to upgrading the data plane by following the instructions at
<a href=#upgrade-the-data-plane>Upgrade the data plane</a>.</p><h2 id=upgrade-notice-stable-240 class=anchor>Upgrade notice: stable-2.4.0
<a href=#upgrade-notice-stable-240 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>This release supports Kubernetes 1.12+.</p><h3 id=upgrading-from-stable-23x-edge-1945-edge-195x-edge-196x-edge-197x class=anchor>Upgrading from stable-2.3.x, edge-19.4.5, edge-19.5.x, edge-19.6.x, edge-19.7.x
<a href=#upgrading-from-stable-23x-edge-1945-edge-195x-edge-196x-edge-197x class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Use the <code>linkerd upgrade</code> command to upgrade the control plane. This command
ensures that all of the control plane&rsquo;s existing configuration and mTLS secrets
are retained.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># get the latest stable CLI</span>
</span></span><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
</span></span></code></pre></div><p>For Kubernetes 1.12+:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>For Kubernetes pre-1.12 where the mutating and validating webhook
configurations&rsquo; <code>sideEffects</code> fields aren&rsquo;t supported:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade --omit-webhook-side-effects | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>The <code>sideEffects</code> field is added to the Linkerd webhook configurations to
indicate that the webhooks have no side effects on other resources.</p><p>For HA setup, the <code>linkerd upgrade</code> command will also retain all previous HA
configuration. Note that the mutating and validating webhook configurations are
updated to set their <code>failurePolicy</code> fields to <code>fail</code> to ensure that un-injected
workloads (as a result of unexpected errors) are rejected during the admission
process. The HA mode has also been updated to schedule multiple replicas of the
<code>linkerd-proxy-injector</code> and <code>linkerd-sp-validator</code> deployments.</p><p>For users upgrading from the <code>edge-19.5.3</code> release, note that the upgrade
process will fail with the following error message, due to a naming bug:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>The ClusterRoleBinding <span style=color:#a5d6ff>&#34;linkerd-linkerd-tap&#34;</span> is invalid: roleRef: Invalid value:
</span></span><span style=display:flex><span>rbac.RoleRef<span style=color:#ff7b72;font-weight:700>{</span>APIGroup:<span style=color:#a5d6ff>&#34;rbac.authorization.k8s.io&#34;</span>, Kind:<span style=color:#a5d6ff>&#34;ClusterRole&#34;</span>,
</span></span><span style=display:flex><span>Name:<span style=color:#a5d6ff>&#34;linkerd-linkerd-tap&#34;</span><span style=color:#ff7b72;font-weight:700>}</span>: cannot change roleRef
</span></span></code></pre></div><p>This can be resolved by simply deleting the <code>linkerd-linkerd-tap</code> cluster role
binding resource, and re-running the <code>linkerd upgrade</code> command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete clusterrole/linkerd-linkerd-tap
</span></span></code></pre></div><p>For upgrading a multi-stage installation setup, follow the instructions at
<a href=#upgrading-a-multi-stage-install>Upgrading a multi-stage install</a>.</p><p>Users who have previously saved the Linkerd control plane&rsquo;s configuration to
files can follow the instructions at
<a href=#upgrading-via-manifests>Upgrading via manifests</a>
to ensure those configuration are retained by the <code>linkerd upgrade</code> command.</p><p>Once the <code>upgrade</code> command completes, use the <code>linkerd check</code> command to confirm
the control plane is ready.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content><p>The <code>stable-2.4</code> <code>linkerd check</code> command will return an error when run against
an older control plane. This error is benign and will resolve itself once the
control plane is upgraded to <code>stable-2.4</code>:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd-config
</span></span><span style=display:flex><span>--------------
</span></span><span style=display:flex><span>√ control plane Namespace exists
</span></span><span style=display:flex><span>× control plane ClusterRoles exist
</span></span><span style=display:flex><span>    missing ClusterRoles: linkerd-linkerd-controller, linkerd-linkerd-identity, linkerd-linkerd-prometheus, linkerd-linkerd-proxy-injector, linkerd-linkerd-sp-validator, linkerd-linkerd-tap
</span></span><span style=display:flex><span>    see https://linkerd.io/checks/#l5d-existence-cr <span style=color:#ff7b72>for</span> hints
</span></span></code></pre></div></div></div><p>When ready, proceed to upgrading the data plane by following the instructions at
<a href=#upgrade-the-data-plane>Upgrade the data plane</a>.</p><h3 id=upgrading-from-stable-22x class=anchor>Upgrading from stable-2.2.x
<a href=#upgrading-from-stable-22x class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Follow the <a href=#upgrading-from-stable-22x-1>stable-2.3.0 upgrade instructions</a>
to upgrade the control plane to the stable-2.3.2 release first. Then follow
<a href=#upgrading-from-stable-23x-edge-1945-edge-195x-edge-196x-edge-197x>these instructions</a>
to upgrade the stable-2.3.2 control plane to <code>stable-2.4.0</code>.</p><h2 id=upgrade-notice-stable-230 class=anchor>Upgrade notice: stable-2.3.0
<a href=#upgrade-notice-stable-230 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p><code>stable-2.3.0</code> introduces a new <code>upgrade</code> command. This command only works for
the <code>edge-19.4.x</code> and newer releases. When using the <code>upgrade</code> command from
<code>edge-19.2.x</code> or <code>edge-19.3.x</code>, all the installation flags previously provided
to the <code>install</code> command must also be added.</p><h3 id=upgrading-from-stable-22x-1 class=anchor>Upgrading from stable-2.2.x
<a href=#upgrading-from-stable-22x-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>To upgrade from the <code>stable-2.2.x</code> release, follow the
<a href=#step-by-step-instructions-stable-22x>Step-by-step instructions</a>.</p><p>Note that if you had previously installed Linkerd with <code>--tls=optional</code>, delete
the <code>linkerd-ca</code> deployment after successful Linkerd control plane upgrade:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd delete deploy/linkerd-ca
</span></span></code></pre></div><h3 id=upgrading-from-edge-194x class=anchor>Upgrading from edge-19.4.x
<a href=#upgrading-from-edge-194x class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># get the latest stable</span>
</span></span><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># upgrade the control plane</span>
</span></span><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>Follow instructions for
<a href=#upgrade-the-data-plane>upgrading the data plane</a>.</p><h4 id=upgrading-a-multi-stage-install class=anchor>Upgrading a multi-stage install
<a href=#upgrading-a-multi-stage-install class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p><code>edge-19.4.5</code> introduced a
<a href=../install/#multi-stage-install>Multi-stage install</a> feature. If you
previously installed Linkerd via a multi-stage install process, you can upgrade
each stage, analogous to the original multi-stage installation process.</p><p>Stage 1, for the cluster owner:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade config | kubectl apply -f -
</span></span></code></pre></div><p>Stage 2, for the service owner:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade control-plane | kubectl apply -f -
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Passing the <code>--prune</code> flag to <code>kubectl</code> does not work well with multi-stage
upgrades. It is recommended to manually prune old resources after completing
the above steps.</div></div><h4 id=upgrading-via-manifests class=anchor>Upgrading via manifests
<a href=#upgrading-via-manifests class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>By default, the <code>linkerd upgrade</code> command reuses the existing <code>linkerd-config</code>
config map and the <code>linkerd-identity-issuer</code> secret, by fetching them via the
the Kubernetes API. <code>edge-19.4.5</code> introduced a new <code>--from-manifests</code> flag to
allow the upgrade command to read the <code>linkerd-config</code> config map and the
<code>linkerd-identity-issuer</code> secret from a static YAML file. This option is
relevant to CI/CD workflows where the Linkerd configuration is managed by a
configuration repository.</p><p>For release after <code>edge-20.10.1</code>/<code>stable-2.9.0</code>, you need to add <code>secret/linkerd-config-overrides</code>
to the <code>linkerd-manifest.yaml</code> by running command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd get <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  secret/linkerd-identity-issuer <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  configmap/linkerd-config <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  secret/linkerd-config-overrides <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  -oyaml &gt; linkerd-manifests.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>linkerd upgrade --from-manifests linkerd-manifests.yaml | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>For release after <code>stable-2.6.0</code> and prior to <code>edge-20.10.1</code>/<code>stable-2.9.0</code>,
you can use this command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n linkerd get <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  secret/linkerd-identity-issuer <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  configmap/linkerd-config <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  -oyaml &gt; linkerd-manifests.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>linkerd upgrade --from-manifests linkerd-manifests.yaml | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>For releases prior to <code>edge-19.8.1</code>/<code>stable-2.5.0</code>, and after <code>stable-2.6.0</code>,
you may pipe a full <code>linkerd install</code> manifest into the upgrade command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd install &gt; linkerd-install.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># deploy Linkerd</span>
</span></span><span style=display:flex><span>cat linkerd-install.yaml | kubectl apply -f -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># upgrade Linkerd via manifests</span>
</span></span><span style=display:flex><span>cat linkerd-install.yaml | linkerd upgrade --from-manifests -
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content><code>secret/linkerd-identity-issuer</code> contains the trust root of Linkerd&rsquo;s Identity
system, in the form of a private key. Care should be taken if storing this
information on disk, such as using tools like
<a href=https://git-secret.io/ target=_blank rel=noopener>git-secret</a>.</div></div><h3 id=upgrading-from-edge-192x-or-edge-193x class=anchor>Upgrading from edge-19.2.x or edge-19.3.x
<a href=#upgrading-from-edge-192x-or-edge-193x class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># get the latest stable</span>
</span></span><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install stable control plane, using flags previously supplied during</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># installation.</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># For example, if the previous installation was:</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># linkerd install --proxy-log-level=warn --proxy-auto-inject | kubectl apply -f -</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># The upgrade command would be:</span>
</span></span><span style=display:flex><span>linkerd upgrade --proxy-log-level<span style=color:#ff7b72;font-weight:700>=</span>warn --proxy-auto-inject | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span></code></pre></div><p>Follow instructions for
<a href=#upgrade-the-data-plane>upgrading the data plane</a>.</p><h2 id=upgrade-notice-stable-220 class=anchor>Upgrade notice: stable-2.2.0
<a href=#upgrade-notice-stable-220 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>There are two breaking changes in <code>stable-2.2.0</code>. One relates to
<a href=../../features/service-profiles/>Service Profiles</a>, the other relates to
<a href=../../features/proxy-injection/>Automatic Proxy Injection</a>. If you are not using
either of these features, you may <a href=#step-by-step-instructions-stable-22x>skip directly</a>
to the full upgrade instructions.</p><h3 id=service-profile-namespace-location class=anchor>Service Profile namespace location
<a href=#service-profile-namespace-location class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p><a href=../../features/service-profiles/>Service Profiles</a>, previously defined in the
control plane namespace in <code>stable-2.1.0</code>, are now defined in their respective
client and server namespaces. Service Profiles defined in the client namespace
take priority over ones defined in the server namespace.</p><h3 id=automatic-proxy-injection-opt-in class=anchor>Automatic Proxy Injection opt-in
<a href=#automatic-proxy-injection-opt-in class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>The <code>linkerd.io/inject</code> annotation, previously opt-out in <code>stable-2.1.0</code>, is now
opt-in.</p><p>To enable automation proxy injection for a namespace, you must enable the
<code>linkerd.io/inject</code> annotation on either the namespace or the pod spec. For more
details, see the <a href=../../features/proxy-injection/>Automatic Proxy Injection</a> doc.</p><h4 id=a-note-about-application-updates class=anchor>A note about application updates
<a href=#a-note-about-application-updates class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>Also note that auto-injection only works during resource creation, not update.
To update the data plane proxies of a deployment that was auto-injected, do one
of the following:</p><ul><li>Manually re-inject the application via <code>linkerd inject</code> (more info below under
<a href=#upgrade-the-data-plane>Upgrade the data plane</a>)</li><li>Delete and redeploy the application</li></ul><p>Auto-inject support for application updates is tracked on
<a href=https://github.com/linkerd/linkerd2/issues/2260 target=_blank rel=noopener>github</a></p><h2 id=step-by-step-instructions-stable-22x class=anchor>Step-by-step instructions (stable-2.2.x)
<a href=#step-by-step-instructions-stable-22x class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=upgrade-the-22x-cli class=anchor>Upgrade the 2.2.x CLI
<a href=#upgrade-the-22x-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>This will upgrade your local CLI to the latest version. You will want to follow
these instructions for anywhere that uses the linkerd CLI.</p><p>To upgrade the CLI locally, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install | sh
</span></span></code></pre></div><p>Alternatively, you can download the CLI directly via the
<a href=https://github.com/linkerd/linkerd2/releases/ target=_blank rel=noopener>Linkerd releases page</a>.</p><p>Verify the CLI is installed and running correctly with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version
</span></span></code></pre></div><p>Which should display:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Client version: 
L5D2_STABLE_VERSION
</span></span><span style=display:flex><span>Server version: stable-2.1.0
</span></span></code></pre></div><p>It is expected that the Client and Server versions won&rsquo;t match at this point in
the process. Nothing has been changed on the cluster, only the local CLI has
been updated.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Until you upgrade the control plane, some new CLI commands may not work.</div></div><h3 id=upgrade-the-22x-control-plane class=anchor>Upgrade the 2.2.x control plane
<a href=#upgrade-the-22x-control-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Now that you have upgraded the CLI running locally, it is time to upgrade the
Linkerd control plane on your Kubernetes cluster. Don&rsquo;t worry, the existing data
plane will continue to operate with a newer version of the control plane and
your meshed services will not go down.</p><p>To upgrade the control plane in your environment, run the following command.
This will cause a rolling deploy of the control plane components that have
changed.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd install | kubectl apply -f -
</span></span></code></pre></div><p>The output will be:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>namespace/linkerd configured
</span></span><span style=display:flex><span>configmap/linkerd-config created
</span></span><span style=display:flex><span>serviceaccount/linkerd-identity created
</span></span><span style=display:flex><span>clusterrole.rbac.authorization.k8s.io/linkerd-linkerd-identity configured
</span></span><span style=display:flex><span>clusterrolebinding.rbac.authorization.k8s.io/linkerd-linkerd-identity configured
</span></span><span style=display:flex><span>service/linkerd-identity created
</span></span><span style=display:flex><span>secret/linkerd-identity-issuer created
</span></span><span style=display:flex><span>deployment.extensions/linkerd-identity created
</span></span><span style=display:flex><span>serviceaccount/linkerd-controller unchanged
</span></span><span style=display:flex><span>clusterrole.rbac.authorization.k8s.io/linkerd-linkerd-controller configured
</span></span><span style=display:flex><span>clusterrolebinding.rbac.authorization.k8s.io/linkerd-linkerd-controller configured
</span></span><span style=display:flex><span>service/linkerd-controller-api configured
</span></span><span style=display:flex><span>service/linkerd-destination created
</span></span><span style=display:flex><span>deployment.extensions/linkerd-controller configured
</span></span><span style=display:flex><span>customresourcedefinition.apiextensions.k8s.io/serviceprofiles.linkerd.io configured
</span></span><span style=display:flex><span>serviceaccount/linkerd-web unchanged
</span></span><span style=display:flex><span>service/linkerd-web configured
</span></span><span style=display:flex><span>deployment.extensions/linkerd-web configured
</span></span><span style=display:flex><span>serviceaccount/linkerd-prometheus unchanged
</span></span><span style=display:flex><span>clusterrole.rbac.authorization.k8s.io/linkerd-linkerd-prometheus configured
</span></span><span style=display:flex><span>clusterrolebinding.rbac.authorization.k8s.io/linkerd-linkerd-prometheus configured
</span></span><span style=display:flex><span>service/linkerd-prometheus configured
</span></span><span style=display:flex><span>deployment.extensions/linkerd-prometheus configured
</span></span><span style=display:flex><span>configmap/linkerd-prometheus-config configured
</span></span><span style=display:flex><span>serviceaccount/linkerd-grafana unchanged
</span></span><span style=display:flex><span>service/linkerd-grafana configured
</span></span><span style=display:flex><span>deployment.extensions/linkerd-grafana configured
</span></span><span style=display:flex><span>configmap/linkerd-grafana-config configured
</span></span><span style=display:flex><span>serviceaccount/linkerd-sp-validator created
</span></span><span style=display:flex><span>clusterrole.rbac.authorization.k8s.io/linkerd-linkerd-sp-validator configured
</span></span><span style=display:flex><span>clusterrolebinding.rbac.authorization.k8s.io/linkerd-linkerd-sp-validator configured
</span></span><span style=display:flex><span>service/linkerd-sp-validator created
</span></span><span style=display:flex><span>deployment.extensions/linkerd-sp-validator created
</span></span></code></pre></div><p>Check to make sure everything is healthy by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check
</span></span></code></pre></div><p>This will run through a set of checks against your control plane and make sure
that it is operating correctly.</p><p>To verify the Linkerd control plane version, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version
</span></span></code></pre></div><p>Which should display:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Client version: 
L5D2_STABLE_VERSION
</span></span><span style=display:flex><span>Server version: 
L5D2_STABLE_VERSION
</span></span></code></pre></div><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>You will lose the historical data from Prometheus. If you would like to have
that data persisted through an upgrade, take a look at the
<a href=../../observability/exporting-metrics/>persistence documentation</a></div></div><h3 id=upgrade-the-22x-data-plane class=anchor>Upgrade the 2.2.x data plane
<a href=#upgrade-the-22x-data-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>With a fully up-to-date CLI running locally and Linkerd control plane running on
your Kubernetes cluster, it is time to upgrade the data plane. This will change
the version of the <code>linkerd-proxy</code> sidecar container and run a rolling deploy on
your service.</p><p>For <code>stable-2.3.0</code>+, if your workloads are annotated with the auto-inject
<code>linkerd.io/inject: enabled</code> annotation, then you can just restart your pods
using your Kubernetes cluster management tools (<code>helm</code>, <code>kubectl</code> etc.).</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content><p>With <code>kubectl</code> 1.15+, you can use the <code>kubectl rollout restart</code> command to
restart all your meshed services. For example,</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n &lt;namespace&gt; rollout restart deploy
</span></span></code></pre></div></div></div><p>As the pods are being re-created, the proxy injector will auto-inject the new
version of the proxy into the pods.</p><p>If auto-injection is not part of your workflow, you can still manually upgrade
your meshed services by re-injecting your applications in-place.</p><p>Begin by retrieving your YAML resources via <code>kubectl</code>, and pass them through the
<code>linkerd inject</code> command. This will update the pod spec with the
<code>linkerd.io/inject: enabled</code> annotation. This annotation will be picked up by
Linkerd&rsquo;s proxy injector during the admission phase where the Linkerd proxy will
be injected into the workload. By using <code>kubectl apply</code>, Kubernetes will do a
rolling deploy of your service and update the running pods to the latest
version.</p><p>Example command to upgrade an application in the <code>emojivoto</code> namespace, composed
of deployments:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n emojivoto get deploy -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -oyaml <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | linkerd inject - <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | kubectl apply -f -
</span></span></code></pre></div><p>Check to make sure everything is healthy by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --proxy
</span></span></code></pre></div><p>This will run through a set of checks against both your control plane and data
plane to verify that it is operating correctly.</p><p>You can make sure that you&rsquo;ve fully upgraded all the data plane by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get po --all-namespaces -o yaml <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  | grep linkerd.io/proxy-version
</span></span></code></pre></div><p>The output will look something like:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd.io/proxy-version: 
L5D2_STABLE_VERSION
</span></span><span style=display:flex><span>linkerd.io/proxy-version: 
L5D2_STABLE_VERSION
</span></span></code></pre></div><p>If there are any older versions listed, you will want to upgrade them as well.</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>