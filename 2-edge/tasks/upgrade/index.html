<!doctype html><html lang=en><head><meta charset=utf-8><title>Upgrading Linkerd | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Perform zero-downtime upgrades for Linkerd."><meta property="og:url" content="https://travisbeckham.github.io/2-edge/tasks/upgrade/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Upgrading Linkerd"><meta property="og:description" content="Perform zero-downtime upgrades for Linkerd."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="2-edge"><meta property="og:image" content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/logos/linkerd.png"><meta name=twitter:title content="Upgrading Linkerd"><meta name=twitter:description content="Perform zero-downtime upgrades for Linkerd."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2-edge/tasks/upgrade/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li class=main-nav__menu--selected><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class=docs><div class=docs__container><div class=docs__sidebar><div class=docs__nav><div class=docs__versions><select onchange="window.location.href=this.value"><option value=/2-edge/ selected>Linkerd edge</option><option value=/2.16/>Linkerd 2.16</option><option value=/2.15/>Linkerd 2.15</option><option value=/2.14/>Linkerd 2.14</option><option value=/2.13/>Linkerd 2.13</option><option value=/2.12/>Linkerd 2.12</option><option value=/2.11/>Linkerd 2.11</option><option value=/2.10/>Linkerd 2.10</option></select></div><nav><ul><li><a href=/2-edge/overview/>Overview</a></li><li><a href=/2-edge/getting-started/>Getting Started</a></li><li><a href=/2-edge/features/>Features
</a><input class=toggle__input type=checkbox id=toggle-f524806733d51ea4f7c2504b44379f32>
<label class=toggle__label for=toggle-f524806733d51ea4f7c2504b44379f32><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2-edge/features/http-grpc/>HTTP, HTTP/2, and gRPC Proxying</a></li><li><a href=/2-edge/features/protocol-detection/>TCP Proxying and Protocol Detection</a></li><li><a href=/2-edge/features/retries-and-timeouts/>Retries and Timeouts</a></li><li><a href=/2-edge/features/automatic-mtls/>Automatic mTLS</a></li><li><a href=/2-edge/features/ingress/>Ingress</a></li><li><a href=/2-edge/features/telemetry/>Telemetry and Monitoring</a></li><li><a href=/2-edge/features/load-balancing/>Load Balancing</a></li><li><a href=/2-edge/features/server-policy/>Authorization Policy</a></li><li><a href=/2-edge/features/proxy-injection/>Automatic Proxy Injection</a></li><li><a href=/2-edge/features/cni/>CNI Plugin</a></li><li><a href=/2-edge/features/dashboard/>Dashboard and on-cluster metrics stack</a></li><li><a href=/2-edge/features/distributed-tracing/>Distributed Tracing</a></li><li><a href=/2-edge/features/request-routing/>Dynamic Request Routing</a></li><li><a href=/2-edge/features/fault-injection/>Fault Injection</a></li><li><a href=/2-edge/features/ha/>High Availability</a></li><li><a href=/2-edge/features/access-logging/>HTTP Access Logging</a></li><li><a href=/2-edge/features/httproute/>HTTPRoutes</a></li><li><a href=/2-edge/features/nft/>Iptables-nft Support</a></li><li><a href=/2-edge/features/ipv6/>IPv6 Support</a></li><li><a href=/2-edge/features/multicluster/>Multi-cluster communication</a></li><li><a href=/2-edge/features/non-kubernetes-workloads/>Non-Kubernetes workloads (mesh expansion)</a></li><li><a href=/2-edge/features/service-profiles/>Service Profiles</a></li><li><a href=/2-edge/features/traffic-split/>Traffic Split (canaries, blue/green deploys)</a></li></ul></li><li class=docs__nav--selected><a href=/2-edge/tasks/>Tasks
</a><input class=toggle__input type=checkbox id=toggle-eb66af6ff84f9fce506d3a9073494489 checked>
<label class=toggle__label for=toggle-eb66af6ff84f9fce506d3a9073494489><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2-edge/tasks/adding-non-kubernetes-workloads/>Adding non-Kubernetes workloads to your mesh</a></li><li><a href=/2-edge/tasks/adding-your-service/>Adding your services to Linkerd</a></li><li><a href=/2-edge/tasks/automatic-failover/>Automatic Multicluster Failover</a></li><li><a href=/2-edge/tasks/automatically-rotating-control-plane-tls-credentials/>Automatically Rotating Control Plane TLS Credentials</a></li><li><a href=/2-edge/tasks/automatically-rotating-webhook-tls-credentials/>Automatically Rotating Webhook TLS Credentials</a></li><li><a href=/2-edge/tasks/external-prometheus/>Bringing your own Prometheus</a></li><li><a href=/2-edge/tasks/circuit-breakers/>Circuit Breakers</a></li><li><a href=/2-edge/tasks/configuring-dynamic-request-routing/>Configuring Dynamic Request Routing</a></li><li><a href=/2-edge/tasks/configuring-per-route-policy/>Configuring Per-Route Authorization Policy</a></li><li><a href=/2-edge/tasks/configuring-proxy-concurrency/>Configuring Proxy Concurrency</a></li><li><a href=/2-edge/tasks/configuring-proxy-discovery-cache/>Configuring Proxy Discovery Cache</a></li><li><a href=/2-edge/tasks/configuring-retries/>Configuring Retries</a></li><li><a href=/2-edge/tasks/configuring-timeouts/>Configuring Timeouts</a></li><li><a href=/2-edge/tasks/using-debug-endpoints/>Control Plane Debug Endpoints</a></li><li><a href=/2-edge/tasks/customize-install/>Customizing Linkerd's Configuration with Kustomize</a></li><li><a href=/2-edge/tasks/debugging-502s/>Debugging 502s</a></li><li><a href=/2-edge/tasks/debugging-your-service/>Debugging gRPC applications with request tracing</a></li><li><a href=/2-edge/tasks/books/>Debugging HTTP applications with per-route metrics</a></li><li><a href=/2-edge/tasks/distributed-tracing/>Distributed tracing with Linkerd</a></li><li><a href=/2-edge/tasks/exporting-metrics/>Exporting Metrics</a></li><li><a href=/2-edge/tasks/exposing-dashboard/>Exposing the Dashboard</a></li><li><a href=/2-edge/tasks/generate-certificates/>Generating your own mTLS root certificates</a></li><li><a href=/2-edge/tasks/getting-per-route-metrics/>Getting Per-Route Metrics</a></li><li><a href=/2-edge/tasks/linkerd-smi/>Getting started with Linkerd SMI extension</a></li><li><a href=/2-edge/tasks/graceful-shutdown/>Graceful Pod Shutdown</a></li><li><a href=/2-edge/tasks/grafana/>Grafana</a></li><li><a href=/2-edge/tasks/using-ingress/>Handling ingress traffic</a></li><li><a href=/2-edge/tasks/fault-injection/>Injecting Faults</a></li><li><a href=/2-edge/tasks/install/>Installing Linkerd</a></li><li><a href=/2-edge/tasks/install-helm/>Installing Linkerd with Helm</a></li><li><a href=/2-edge/tasks/installing-multicluster/>Installing Multi-cluster Components</a></li><li><a href=/2-edge/tasks/using-psp/>Linkerd and Pod Security Policies (PSP)</a></li><li><a href=/2-edge/tasks/manually-rotating-control-plane-tls-credentials/>Manually Rotating Control Plane TLS Credentials</a></li><li><a href=/2-edge/tasks/modifying-proxy-log-level/>Modifying the Proxy Log Level</a></li><li><a href=/2-edge/tasks/multicluster/>Multi-cluster communication</a></li><li><a href=/2-edge/tasks/multicluster-using-statefulsets/>Multi-cluster communication with StatefulSets</a></li><li><a href=/2-edge/tasks/per-request-policy/>Per-Request Policy</a></li><li><a href=/2-edge/tasks/pod-to-pod-multicluster/>Pod-to-Pod Multi-cluster communication</a></li><li><a href=/2-edge/tasks/flagger/>Progressive Delivery</a></li><li><a href=/2-edge/tasks/replacing_expired_certificates/>Replacing expired certificates</a></li><li><a href=/2-edge/tasks/restricting-access/>Restricting Access To Services</a></li><li><a href=/2-edge/tasks/rotating_webhooks_certificates/>Rotating webhooks certificates</a></li><li><a href=/2-edge/tasks/securing-linkerd-tap/>Securing Linkerd Tap</a></li><li><a href=/2-edge/tasks/setting-up-service-profiles/>Setting Up Service Profiles</a></li><li><a href=/2-edge/tasks/traffic-shifting/>Traffic Shifting</a></li><li><a href=/2-edge/tasks/troubleshooting/>Troubleshooting</a></li><li><a href=/2-edge/tasks/uninstall/>Uninstalling Linkerd</a></li><li><a href=/2-edge/tasks/uninstall-multicluster/>Uninstalling Multicluster</a></li><li class=docs__nav--selected><a href=/2-edge/tasks/upgrade/>Upgrading Linkerd</a></li><li><a href=/2-edge/tasks/using-custom-domain/>Using a Custom Cluster Domain</a></li><li><a href=/2-edge/tasks/extensions/>Using extensions</a></li><li><a href=/2-edge/tasks/gitops/>Using GitOps with Linkerd with Argo CD</a></li><li><a href=/2-edge/tasks/using-the-debug-container/>Using the Debug Sidecar</a></li><li><a href=/2-edge/tasks/validating-your-traffic/>Validating your mTLS traffic</a></li></ul></li><li><a href=/2-edge/reference/>Reference
</a><input class=toggle__input type=checkbox id=toggle-c5cd1c9c50e40c408453dcf4eae5468f>
<label class=toggle__label for=toggle-c5cd1c9c50e40c408453dcf4eae5468f><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2-edge/reference/architecture/>Architecture</a></li><li><a href=/2-edge/reference/authorization-policy/>Authorization Policy</a></li><li><a href=/2-edge/reference/circuit-breaking/>Circuit Breaking</a></li><li><a href=/2-edge/reference/cli/>CLI
</a><input class=toggle__input type=checkbox id=toggle-3670a1706f943ec7fd577cd3725efcef>
<label class=toggle__label for=toggle-3670a1706f943ec7fd577cd3725efcef><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2-edge/reference/cli/authz/>authz</a></li><li><a href=/2-edge/reference/cli/check/>check</a></li><li><a href=/2-edge/reference/cli/completion/>completion</a></li><li><a href=/2-edge/reference/cli/diagnostics/>diagnostics</a></li><li><a href=/2-edge/reference/cli/identity/>identity</a></li><li><a href=/2-edge/reference/cli/inject/>inject</a></li><li><a href=/2-edge/reference/cli/install/>install</a></li><li><a href=/2-edge/reference/cli/install-cni/>install-cni</a></li><li><a href=/2-edge/reference/cli/jaeger/>jaeger</a></li><li><a href=/2-edge/reference/cli/multicluster/>multicluster</a></li><li><a href=/2-edge/reference/cli/profile/>profile</a></li><li><a href=/2-edge/reference/cli/prune/>prune</a></li><li><a href=/2-edge/reference/cli/uninject/>uninject</a></li><li><a href=/2-edge/reference/cli/uninstall/>uninstall</a></li><li><a href=/2-edge/reference/cli/upgrade/>upgrade</a></li><li><a href=/2-edge/reference/cli/version/>version</a></li><li><a href=/2-edge/reference/cli/viz/>viz</a></li></ul></li><li><a href=/2-edge/reference/cluster-configuration/>Cluster Configuration</a></li><li><a href=/2-edge/reference/extension-list/>Extensions List</a></li><li><a href=/2-edge/reference/external-workload/>ExternalWorkload</a></li><li><a href=/2-edge/reference/httproute/>HTTPRoute</a></li><li><a href=/2-edge/reference/iptables/>IPTables Reference</a></li><li><a href=/2-edge/reference/multicluster/>Multi-cluster communication</a></li><li><a href=/2-edge/reference/proxy-configuration/>Proxy Configuration</a></li><li><a href=/2-edge/reference/proxy-log-level/>Proxy Log Level</a></li><li><a href=/2-edge/reference/proxy-metrics/>Proxy Metrics</a></li><li><a href=/2-edge/reference/retries/>Retries</a></li><li><a href=/2-edge/reference/service-profiles/>Service Profiles</a></li><li><a href=/2-edge/reference/k8s-versions/>Supported Kubernetes Versions</a></li><li><a href=/2-edge/reference/timeouts/>Timeouts</a></li></ul></li><li><a href=/2-edge/common-errors/>Common Errors
</a><input class=toggle__input type=checkbox id=toggle-de403e5bf3db4733165f05741364f350>
<label class=toggle__label for=toggle-de403e5bf3db4733165f05741364f350><svg class="icon icon--secondary" viewBox="0 0 24 24"><path d="M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg></label><ul class=toggle__target><li><a href=/2-edge/common-errors/failfast/>Failfast</a></li><li><a href=/2-edge/common-errors/http-502/>HTTP 502 Errors</a></li><li><a href=/2-edge/common-errors/http-503-504/>HTTP 503 and 504 Errors</a></li><li><a href=/2-edge/common-errors/protocol-detection/>Protocol Detection Errors</a></li></ul></li></ul><ul><li><a href=/what-is-a-service-mesh/>What is a service mesh?</a></li><li><a href=/faq/>Frequently Asked Questions</a></li><li><a href=/releases/>Releases and Versions</a></li><li><a href=/design-principles/>Design Principles</a></li><li><a href=/going-to-production/>Going to Production</a></li><li><a href=/service-mesh-glossary/>Service Mesh Glossary</a></li></ul></nav><div class=docs__community><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener><img src=/logos/github.svg alt=GitHub class=img></a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener><img src=/logos/slack.svg alt=Slack class=img></a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener><img src=/logos/forum.png alt="Linkerd Forum" class=img></a></li></ul></div></div></div><div class=docs__main><div class=docs__body><div class=docs__header><h1>Upgrading Linkerd</h1></div><div class="docs__content prose"><p>In this guide, we&rsquo;ll walk you through how to perform zero-downtime upgrades for
Linkerd.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>This page contains instructions for upgrading to the latest edge release of
Linkerd. If you have installed a <a href=/releases/#stable>stable distribution</a> of
Linkerd, the vendor may have alternative guidance on how to upgrade. You can
find more information about the different kinds of Linkerd releases on the
<a href=/releases/>Releases and Versions</a> page.</div></div><p>Read through this guide carefully. Additionally, before starting a specific
upgrade, please read through the version-specific upgrade notices below, which
may contain important information about your version.</p><ul><li><a href=#upgrade-notice-stable-215-and-beyond>Upgrade notice: 2.15 and beyond</a></li><li><a href=#upgrade-notice-stable-2140>Upgrade notice: stable-2.14.0</a></li><li><a href=#upgrade-notice-stable-2130>Upgrade notice: stable-2.13.0</a></li><li><a href=#upgrade-notice-stable-2120>Upgrade notice: stable-2.12.0</a></li><li><a href=#upgrade-notice-stable-2110>Upgrade notice: stable-2.11.0</a></li><li><a href=#upgrade-notice-stable-2100>Upgrade notice: stable-2.10.0</a></li></ul><h2 id=version-numbering class=anchor>Version numbering
<a href=#version-numbering class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=stable-releases class=anchor>Stable releases
<a href=#stable-releases class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For stable releases, Linkerd follows a version numbering scheme of the form
<code>2.&lt;major>.&lt;minor></code>. In other words, &ldquo;2&rdquo; is a static prefix, followed by the
major version, then the minor.</p><p>Changes in minor versions are intended to be backwards compatible with the
previous version. Changes in major version <em>may</em> introduce breaking changes,
although we try to avoid that whenever possible.</p><h3 id=edge-releases class=anchor>Edge releases
<a href=#edge-releases class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For edge releases, Linkerd issues explicit <a href=../../../releases/#edge-release-guidance>guidance about each
release</a>. Be sure to consult this
guidance before installing any release artifact.</p><div class="alert alert--info alert--callout"><div class=alert__title><svg class="icon icon--current" viewBox="0 0 24 24"><path d="M13 9H11V7h2m0 10H11V11h2M12 2A10 10 0 002 12 10 10 0 0012 22 10 10 0 0022 12 10 10 0 0012 2z"/></svg><h4>Note</h4></div><div class=alert__content>Edge releases are <strong>not</strong> semantically versioned; the edge release number
itself does not give you any assurance about breaking changes,
incompatibilities, etc. Instead, this information is available in the <a href=https://github.com/linkerd/linkerd2/releases target=_blank rel=noopener>release
notes</a>.</div></div><h2 id=upgrade-paths class=anchor>Upgrade paths
<a href=#upgrade-paths class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The following upgrade paths are generally safe. However, before starting a
deploy, it is important to check the upgrade notes before
proceeding—occasionally, specific minor releases may have additional
restrictions.</p><p><strong>Stable within the same major version</strong>. It is usually safe to upgrade to the
latest minor version within the same major version. In other words, if you are
currently running version <em>2.x.y</em>, upgrading to <em>2.x.z</em>, where <em>z</em> is the
latest minor version for major version <em>x</em>, is safe. This is true even if you
would skip intermediate intermediate minor versions, i.e. it is still safe
even if <em>z</em> > <em>y + 1</em>.</p><p><strong>Stable to the next major version</strong>. It is usually safe to upgrade to the
latest minor version of the <em>next</em> major version. In other words, if you are
currently running version <em>2.x.y</em>, upgrading to <em>2.x + 1.w</em> will be safe,
where <em>w</em> is the latest minor version available for major version <em>x + 1</em>.</p><p><strong>Stable to a later major version</strong>. Upgrades that skip one or more major
versions are not supported. Instead, you should upgrade major versions
incrementally.</p><p><strong>Edge release to a later edge release</strong>. This is generally safe unless
the <code>Cautions</code> for the later edge release indicate otherwise.</p><p>Again, please check the upgrade notes or release guidance for the specific
version you are upgrading <em>to</em> for any version-specific caveats.</p><h2 id=data-plane-vs-control-plane-version-skew class=anchor>Data plane vs control plane version skew
<a href=#data-plane-vs-control-plane-version-skew class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Since a Linkerd upgrade always starts by upgrading the control plane, there is
a period during which the control plane is running the new version, but the
data plane is still running the older version. The extent to which this skew
can be supported depends on what kind of release you&rsquo;re running. Note that new
features introduced by the release may not be available for workloads with
older data planes.</p><h3 id=stable-releases-1 class=anchor>Stable releases
<a href=#stable-releases-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For stable releases, it is usually safe to upgrade one major version at a
time. This is independent of minor version, i.e. a <em>2.x.y</em> data plane and a
<em>2.x + 1.z</em> control plane will work regardless of <em>y</em> and <em>z</em>. Please check
the version-specific upgrade notes before proceeding.</p><h3 id=edge-releases-1 class=anchor>Edge releases
<a href=#edge-releases-1 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For edge releases, it is also usually safe to upgrade one major version at a
time. The major version of an edge release is included in the release notes
for each edge release: for example, <code>edge-24.4.1</code> is part of Linkerd 2.15, so
it should be safe to upgrade from <code>edge-24.4.1</code> to any edge release within
Linkerd 2.15 or Linkerd 2.16.</p><p>For any situation where this is not the case, the edge release guidance will
have more information.</p><h2 id=overall-upgrade-process class=anchor>Overall upgrade process
<a href=#overall-upgrade-process class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>There are four components that need to be upgraded:</p><ul><li><a href=#upgrade-the-cli>The CLI</a></li><li><a href=#upgrade-the-control-plane>The control plane</a></li><li><a href=#upgrade-extensions>The control plane extensions</a></li><li><a href=#upgrade-the-data-plane>The data plane</a></li></ul><p>These steps should be performed in sequence.</p><h2 id=before-upgrading class=anchor>Before upgrading
<a href=#before-upgrading class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Before you commence an upgrade, you should ensure that the current state
of Linkerd is healthy, e.g. by using <code>linkerd check</code>. For major version
upgrades, you should also ensure that your data plane is up-to-date, e.g.
with <code>linkerd check --proxy</code>, to avoid unintentional version skew.</p><p>Make sure that your Linkerd version and Kubernetes version are compatible by
checking Linkerd&rsquo;s <a href=../../reference/k8s-versions/>supported Kubernetes
versions</a>.</p><h2 id=upgrading-the-cli class=anchor>Upgrading the CLI
<a href=#upgrading-the-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>The CLI can be used to validate whether Linkerd was installed correctly.</p><h3 id=stable-releases-2 class=anchor>Stable releases
<a href=#stable-releases-2 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Consult the upgrade instructions from the vendor supplying your stable release
for information about how to upgrade the CLI.</p><h3 id=edge-releases-2 class=anchor>Edge releases
<a href=#edge-releases-2 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>To upgrade the CLI, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl --proto <span style=color:#a5d6ff>&#39;=https&#39;</span> --tlsv1.2 -sSfL https://run.linkerd.io/install-edge | sh
</span></span></code></pre></div><p>Alternatively, you can download the CLI directly via the <a href=https://github.com/linkerd/linkerd2/releases/ target=_blank rel=noopener>Linkerd releases
page</a>.</p><p>Verify the CLI is installed and running the expected version with:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version --client
</span></span></code></pre></div><h2 id=upgrading-the-control-plane class=anchor>Upgrading the control plane
<a href=#upgrading-the-control-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><h3 id=upgrading-the-control-plane-with-the-cli class=anchor>Upgrading the control plane with the CLI
<a href=#upgrading-the-control-plane-with-the-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For users who have installed Linkerd via the CLI, the <code>linkerd upgrade</code> command
will upgrade the control plane. This command ensures that all of the control
plane&rsquo;s existing configuration and TLS secrets are retained. Linkerd&rsquo;s CRDs
should be upgraded first, using the <code>--crds</code> flag, followed by upgrading the
control plane.</p><p>(If you are using a stable release, your vendor&rsquo;s upgrade instructions may
have more information.)</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd upgrade --crds | kubectl apply -f -
</span></span><span style=display:flex><span>linkerd upgrade | kubectl apply -f -
</span></span></code></pre></div><p>Next, we use the <code>linkerd prune</code> command to remove any resources that were
present in the previous version but should not be present in this one.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd prune | kubectl delete -f -
</span></span></code></pre></div><h3 id=upgrading-the-control-plane-with-helm class=anchor>Upgrading the control plane with Helm
<a href=#upgrading-the-control-plane-with-helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For Helm control plane installations, please follow the instructions at <a href=../install-helm/#helm-upgrade-procedure>Helm
upgrade procedure</a>.</p><h3 id=verifying-the-control-plane-upgrade class=anchor>Verifying the control plane upgrade
<a href=#verifying-the-control-plane-upgrade class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Once the upgrade process completes, check to make sure everything is healthy
by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check
</span></span></code></pre></div><p>This will run through a set of checks against your control plane and make sure
that it is operating correctly.</p><p>To verify the Linkerd control plane version, run:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd version
</span></span></code></pre></div><p>Which should display the latest versions for both client and server.</p><h2 id=upgrading-extensions class=anchor>Upgrading extensions
<a href=#upgrading-extensions class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p><a href=../extensions/>Linkerd&rsquo;s extensions</a> provide additional functionality to
Linkerd in a modular way. Generally speaking, extensions are versioned
separately from Linkerd releases and follow their own schedule; however, some
extensions are updated alongside Linkerd releases and you may wish to update
them as part of the same process.</p><p>Each extension can be upgraded independently. If using Helm, the procedure is
similar to the control plane upgrade, using the respective charts. For the CLI,
the extension CLI commands don&rsquo;t provide <code>upgrade</code> subcommands, but using
<code>install</code> again is fine. For example:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz install | kubectl apply -f -
</span></span><span style=display:flex><span>linkerd multicluster install | kubectl apply -f -
</span></span><span style=display:flex><span>linkerd jaeger install | kubectl apply -f -
</span></span></code></pre></div><p>Most extensions also include a <code>prune</code> command for removing resources which
were present in the previous version but should not be present in the current
version. For example:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd viz prune | kubectl delete -f -
</span></span></code></pre></div><h3 id=upgrading-the-multicluster-extension class=anchor>Upgrading the multicluster extension
<a href=#upgrading-the-multicluster-extension class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Upgrading the multicluster extension doesn&rsquo;t cause downtime in the traffic going
through the mirrored services, unless otherwise noted in the version-specific
notes below. Note however that for the service mirror <em>deployments</em> (which
control the creation of the mirrored services) to be updated, you need to
re-link your clusters through <code>linkerd multicluster link</code>.</p><h2 id=upgrading-the-data-plane class=anchor>Upgrading the data plane
<a href=#upgrading-the-data-plane class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>Upgrading the data plane requires updating the proxy added to each meshed
workload. Since pods are immutable in Kubernetes, Linkerd is unable to simply
update the proxies in place. Thus, the standard option is to restart each
workload, allowing the proxy injector to inject the latest version of the proxy
as they come up.</p><p>For example, you can use the <code>kubectl rollout restart</code> command to restart a
meshed deployment:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n &lt;namespace&gt; rollout restart deploy
</span></span></code></pre></div><p>As described earlier, a skew of one major version between data plane and control
plane is always supported. Thus, for some systems it is possible to do this data
plane upgrade &ldquo;lazily&rdquo;, and simply allow workloads to pick up the newest proxy
as they are restarted for other reasons (e.g. for new code rollouts). However,
newer features may only be available on workloads with the latest proxy.</p><p>A skew of more than one major version between data plane and control plane is
not supported.</p><h3 id=verify-the-data-plane-upgrade class=anchor>Verify the data plane upgrade
<a href=#verify-the-data-plane-upgrade class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Check to make sure everything is healthy by running:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>linkerd check --proxy
</span></span></code></pre></div><p>This will run through a set of checks to verify that the data plane is
operating correctly, and will list any pods that are still running older
versions of the proxy.</p><p>Congratulation! You have successfully upgraded your Linkerd to the newer
version.</p><h2 id=upgrade-notices class=anchor>Upgrade notices
<a href=#upgrade-notices class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h2><p>This section contains release-specific information about upgrading.</p><h3 id=upgrade-notice-stable-215-and-beyond class=anchor>Upgrade notice: stable-2.15 and beyond
<a href=#upgrade-notice-stable-215-and-beyond class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>As of February 2024, the Linkerd project itself only produces <a href=/releases/>edge
release</a> artifacts. The <a href=/releases/>Releases and Versions</a> page
contains more information about the different kinds of Linkerd releases.</p><h3 id=upgrade-notice-stable-2140 class=anchor>Upgrade notice: stable-2.14.0
<a href=#upgrade-notice-stable-2140 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>For this release, if you&rsquo;re using the multicluster extension, you should re-link
your clusters after upgrading to stable-2.14.0, as explained
<a href=#upgrading-the-multicluster-extension>above</a>. Not doing so immediately won&rsquo;t
cause any downtime in cross-cluster connections, but <code>linkerd multicluster check</code> will not succeed until the clusters are re-linked.</p><p>There are no other extra steps for upgrading to 2.14.0.</p><h3 id=upgrade-notice-stable-2130 class=anchor>Upgrade notice: stable-2.13.0
<a href=#upgrade-notice-stable-2130 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Please be sure to read the <a href=https://github.com/linkerd/linkerd2/releases/tag/stable-2.13.0 target=_blank rel=noopener>Linkerd 2.13.0 release
notes</a>.</p><p>There are no other extra steps for upgrading to 2.13.0.</p><h3 id=upgrade-notice-stable-2120 class=anchor>Upgrade notice: stable-2.12.0
<a href=#upgrade-notice-stable-2120 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>Please be sure to read the <a href=https://github.com/linkerd/linkerd2/releases/tag/stable-2.12.0 target=_blank rel=noopener>Linkerd 2.12.0 release
notes</a>.</p><p>There are a couple important changes that affect the upgrade process for 2.12.0:</p><ul><li>The minimum Kubernetes version supported is <code>v1.21.0</code>.</li><li>The TrafficSplit CRD has been moved to the Linkerd SMI extension.</li><li>Support for Helm v2 has been removed.</li><li>The viz extension no longer installs Grafana due to licensing concerns.</li><li>The linkerd2 Helm chart has been split into two charts: linkerd-crds and
linkerd-control-plane.</li><li>The viz, multicluster, jaeger, and linkerd2-cni Helm charts now rely on a
post-install hook required metadata into their namespaces.</li></ul><p>Read on for how to handle these changes as part of the upgrade process.</p><h4 id=upgrading-to-2120-using-the-cli class=anchor>Upgrading to 2.12.0 using the CLI
<a href=#upgrading-to-2120-using-the-cli class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>If you installed Linkerd <code>2.11.x</code> with the CLI <em>and</em> are using the
<code>TrafficSplit</code> CRD, you need to take an extra stop to avoid losing your
<code>TrafficSplit</code> CRs. (If you&rsquo;re not using <code>TrafficSplit</code> then you can
perform the usual CLI upgrade as <a href=#with-linkerd-cli>described above</a>.)</p><p>The <code>TrafficSplit</code> CRD has been moved to the SMI extension. But before
installing that extension, you need to add the following annotations and label
to the CRD so that the <code>linkerd-smi</code> chart can adopt it:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl annotate --overwrite crd/trafficsplits.split.smi-spec.io <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  meta.helm.sh/release-name<span style=color:#ff7b72;font-weight:700>=</span>linkerd-smi <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  meta.helm.sh/release-namespace<span style=color:#ff7b72;font-weight:700>=</span>linkerd-smi
</span></span><span style=display:flex><span>kubectl label crd/trafficsplits.split.smi-spec.io <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  app.kubernetes.io/managed-by<span style=color:#ff7b72;font-weight:700>=</span>Helm
</span></span></code></pre></div><p>Now you can install the SMI extension. E.g. via Helm:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add l5d-smi https://linkerd.github.io/linkerd-smi
</span></span><span style=display:flex><span>helm install linkerd-smi -n linkerd-smi --create-namespace l5d-smi/linkerd-smi
</span></span></code></pre></div><p>And finally you can proceed with the usual <a href=#with-linkerd-cli>CLI upgrade
instructions</a>, but avoid using the <code>--prune</code> flag when
applying the output of <code>linkerd upgrade --crds</code> to avoid removing the
<code>TrafficSplit</code> CRD.</p><h4 id=upgrading-to-2120-using-helm class=anchor>Upgrading to 2.12.0 using Helm
<a href=#upgrading-to-2120-using-helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>Note that support for Helm v2 has been dropped in the Linkerd 2.12.0 release.</p><p>This section provides instructions on how to perform a migration from Linkerd
<code>2.11.x</code> to <code>2.12.0</code> without control plane downtime, when your existing Linkerd
instance was installed via Helm. There were several changes to the Linkerd Helm
charts as part of this release, so this upgrade process is a little more
involved than usual.</p><h5 id=retrieving-existing-customization-and-pki-setup class=anchor>Retrieving existing customization and PKI setup
<a href=#retrieving-existing-customization-and-pki-setup class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>The <code>linkerd2</code> chart has been replaced by two charts: <code>linkerd-crds</code> and
<code>linkerd-control-plane</code> (and optionally <code>linkerd-smi</code> if you&rsquo;re using
<code>TrafficSplit</code>). To migrate to this new setup, we need to ensure your
customization values, including TLS certificates and keys, are migrated
to the new charts.</p><p>Find the release name you used for the <code>linkerd2</code> chart, and the namespace where
this release stored its config:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm ls -A
</span></span><span style=display:flex><span>NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION
</span></span><span style=display:flex><span>linkerd default         <span style=color:#a5d6ff>1</span>               2021-11-22 17:14:50.751436374 -0500 -05 deployed        linkerd2-2.11.1 stable-2.11.1
</span></span></code></pre></div><p>(The example output above matches the default case.) Note that even if Linkerd is
installed in the <code>linkerd</code> namespace, the Helm config should have been installed
in the <code>default</code> namespace, unless you specified something different in the
<code>namespace</code> value when you installed. Take note of this release name (linkerd)
and namespace (default) to use in the commands that follow.</p><p>Next, retrieve all your chart values customizations, especially your trust
root and issuer keys (<code>identityTrustAnchorsPEM</code>, <code>identity.issuer.tls.crtPEM</code>
and <code>identity.issuer.tls.keyPEM</code>). These values will need to be fed again into
the <code>helm install</code> command below for the <code>linkerd-control-plane</code> chart. These
values can be retrieved with the following command:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm get -n default values linkerd
</span></span></code></pre></div><h5 id=migrate-resources-to-the-new-charts class=anchor>Migrate resources to the new charts
<a href=#migrate-resources-to-the-new-charts class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>Next, we need to prepare these values for use with the new charts. Note that the
examples below use the <a href=https://github.com/mikefarah/yq target=_blank rel=noopener>yq</a> utility.</p><p>The following snippets will change the <code>meta.helm.sh/release-name</code> and
<code>meta.helm.sh/release-namespace</code> annotations for each resource in the <code>linkerd</code>
release (use your own name as explained above), so that they can be adopted by
the <code>linkerd-crds</code>, <code>linkerd-control-plane</code> and <code>linkerd-smi</code> charts:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># First migrate the CRDs</span>
</span></span><span style=display:flex><span>$ helm -n default get manifest linkerd | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  yq <span style=color:#a5d6ff>&#39;select(.kind == &#34;CustomResourceDefinition&#34;) | .metadata.name&#39;</span> | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  grep -v <span style=color:#a5d6ff>&#39;\-\-\-&#39;</span> | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  xargs -n1 sh -c <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  <span style=color:#a5d6ff>&#39;kubectl annotate --overwrite crd/$0 meta.helm.sh/release-name=linkerd-crds meta.helm.sh/release-namespace=linkerd&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Special case for TrafficSplit (only use if you have TrafficSplit CRs)</span>
</span></span><span style=display:flex><span>$ kubectl annotate --overwrite crd/trafficsplits.split.smi-spec.io <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  meta.helm.sh/release-name<span style=color:#ff7b72;font-weight:700>=</span>linkerd-smi meta.helm.sh/release-namespace<span style=color:#ff7b72;font-weight:700>=</span>linkerd-smi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Now migrate all the other resources</span>
</span></span><span style=display:flex><span>$ helm -n default get manifest linkerd | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  yq <span style=color:#a5d6ff>&#39;select(.kind != &#34;CustomResourceDefinition&#34;)&#39;</span> | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  yq <span style=color:#a5d6ff>&#39;.kind, .metadata.name, .metadata.namespace&#39;</span> | <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  grep -v <span style=color:#a5d6ff>&#39;\-\-\-&#39;</span> |
</span></span><span style=display:flex><span>  xargs -n3 sh -c <span style=color:#a5d6ff>&#39;kubectl annotate --overwrite -n $2 $0/$1 meta.helm.sh/release-name=linkerd-control-plane meta.helm.sh/release-namespace=linkerd&#39;</span>
</span></span></code></pre></div><h5 id=installing-the-new-charts class=anchor>Installing the new charts
<a href=#installing-the-new-charts class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>Next, we need to install the new charts using our customization values
prepared above.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># First make sure you update the helm repo</span>
</span></span><span style=display:flex><span>$ helm repo up
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install the linkerd-crds chart</span>
</span></span><span style=display:flex><span>$ helm install linkerd-crds -n linkerd --create-namespace linkerd/linkerd-crds
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install the linkerd-control-plane chart</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># (remember to add any customizations you retrieved above)</span>
</span></span><span style=display:flex><span>$ helm install linkerd-control-plane <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  -n linkerd <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --set-file <span style=color:#79c0ff>identityTrustAnchorsPEM</span><span style=color:#ff7b72;font-weight:700>=</span>ca.crt <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --set-file identity.issuer.tls.crtPEM<span style=color:#ff7b72;font-weight:700>=</span>issuer.crt <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --set-file identity.issuer.tls.keyPEM<span style=color:#ff7b72;font-weight:700>=</span>issuer.key <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  linkerd/linkerd-control-plane
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Optional: if using TrafficSplit CRs</span>
</span></span><span style=display:flex><span>$ helm repo add l5d-smi https://linkerd.github.io/linkerd-smi
</span></span><span style=display:flex><span>$ helm install linkerd-smi -n linkerd-smi --create-namespace l5d-smi/linkerd-smi
</span></span></code></pre></div><h5 id=cleaning-up-the-old-linkerd2-helm-release class=anchor>Cleaning up the old linkerd2 Helm release
<a href=#cleaning-up-the-old-linkerd2-helm-release class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>After installing the new charts, we need to clean up the old Helm chart. The
<code>helm delete</code> command would delete all the linkerd resources, so instead we just
remove the Helm release config for the old <code>linkerd2</code> chart (assuming you used
the &ldquo;Secret&rdquo; storage backend, which is the default):</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n default delete secret <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --field-selector <span style=color:#79c0ff>type</span><span style=color:#ff7b72;font-weight:700>=</span>helm.sh/release.v1 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  -l <span style=color:#79c0ff>name</span><span style=color:#ff7b72;font-weight:700>=</span>linkerd,owner<span style=color:#ff7b72;font-weight:700>=</span>helm
</span></span></code></pre></div><h5 id=upgrading-extension-helm-charts class=anchor>Upgrading extension Helm charts
<a href=#upgrading-extension-helm-charts class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>Finally, we need to upgrade our extensions. In Linkerd 2.12.0 the viz,
multicluster, jaeger, and linkerd2-cni extensions no longer install their
namespaces, instead leaving that to the <code>helm</code> command (or to a previous step in
your CD pipeline) and relying on an post-install hook to add the required
metadata into that namespace. Therefore the Helm upgrade path for these
extensions is to delete and reinstall them.</p><p>For example, for the viz extension:</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># update the helm repo</span>
</span></span><span style=display:flex><span>helm repo up
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># delete your current instance</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># (assuming you didn&#39;t use the -n flag when installing)</span>
</span></span><span style=display:flex><span>helm delete linkerd-viz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># install the new chart version</span>
</span></span><span style=display:flex><span>helm install linkerd-viz -n linkerd-viz --create-namespace linkerd/linkerd-viz
</span></span></code></pre></div><h5 id=upgrading-the-multicluster-extension-with-helm class=anchor>Upgrading the multicluster extension with Helm
<a href=#upgrading-the-multicluster-extension-with-helm class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>Note that reinstalling the multicluster extension via Helm as explained above
will result in the recreation of the <code>linkerd-multicluster</code> namespace, thus
deleting all the <code>Link</code> resources that associate the source cluster with any
target clusters. The mirrored services, which live on their respective
namespaces, won&rsquo;t be deleted so there won&rsquo;t be any downtime. So after finishing
the upgrade, make sure you re-link your clusters again with <code>linkerd multicluster link</code>. This will also bring the latest versions of the service
mirror deployments.</p><h5 id=adding-grafana class=anchor>Adding Grafana
<a href=#adding-grafana class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h5><p>The viz extension no longer installs a Grafana instance due to licensing
concerns. Instead we recommend you install it directly from the <a href=https://github.com/grafana/helm-charts/tree/main/charts/grafana target=_blank rel=noopener>Grafana
official Helm
chart</a> or the
<a href=https://github.com/grafana-operator/grafana-operator target=_blank rel=noopener>Grafana Operator</a>.
Linkerd&rsquo;s Grafana dashboards have been published in
<a href=https://grafana.com/orgs/linkerd/dashboards target=_blank rel=noopener>https://grafana.com/orgs/linkerd/dashboards</a>, and the new <a href=../grafana/>Grafana
docs</a> provide detailed instructions on how to load them.</p><h3 id=upgrade-notice-stable-2110 class=anchor>Upgrade notice: stable-2.11.0
<a href=#upgrade-notice-stable-2110 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>The minimum Kubernetes version supported is now <code>v1.17.0</code>.</p><p>There are two breaking changes in the 2.11.0 release: pods in <code>ingress</code> no
longer support non-HTTP traffic to meshed workloads; and the proxy no longer
forwards traffic to ports that are bound only to localhost.</p><p>Users of the multi-cluster extension will need to re-link their cluster after
upgrading.</p><p>The Linkerd proxy container is now the <em>first</em> container in the pod. This may
affect tooling that assumed the application was the first container in the pod.</p><h4 id=control-plane-changes class=anchor>Control plane changes
<a href=#control-plane-changes class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>The <code>controller</code> pod has been removed from the control plane. All configuration
options that previously applied to it are no longer valid (e.g
<code>publicAPIResources</code> and all of its nested fields). Additionally, the
destination pod has a new <code>policy</code> container that runs the policy controller.</p><h4 id=data-plane-changes class=anchor>Data plane changes
<a href=#data-plane-changes class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>In order to fix a class of startup race conditions, the container ordering
within meshed pods has changed so that the Linkerd proxy container is now the
<em>first</em> container in the pod, the application container now waits to start until
the proxy is ready. This may affect tooling that assumed the application
container was the first container in the pod.</p><p>Using <a href=https://github.com/linkerd/linkerd-await target=_blank rel=noopener>linkerd-await</a> to enforce
container startup ordering is thus longer necessary. (However, using
<code>linkerd-await -S</code> to ensure proxy shutdown in Jobs and Cronjobs is still
valid.)</p><h4 id=routing-breaking-changes class=anchor>Routing breaking changes
<a href=#routing-breaking-changes class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>There are two breaking changes to be aware of when it comes to how traffic is
routed.</p><p>First, when the proxy runs in ingress mode (<code>config.linkerd.io/inject: ingress</code>), non-HTTP traffic to meshed pods is no longer supported. To get
around this, you will need to use the <code>config.linkerd.io/skip-outbound-ports</code>
annotation on your ingress controller pod. In many cases, ingress mode is no
longer necessary. Before upgrading, it may be worth revisiting <a href=../using-ingress/>how to use
ingress</a> with Linkerd.</p><p>Second, the proxy will no longer forward traffic to ports only bound on
localhost, such as <code>127.0.0.1:8080</code>. Services that want to receive traffic from
other pods should now be bound to a public interface (e.g <code>0.0.0.0:8080</code>). This
change prevents ports from being accidentally exposed outside of the pod.</p><h4 id=multicluster class=anchor>Multicluster
<a href=#multicluster class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>The gateway component has been changed to use a <code>pause</code> container instead of
<code>nginx</code>. This change should reduce the footprint of the extension; the proxy
routes traffic internally and does not need to rely on <code>nginx</code> to receive or
forward traffic. While this will not cause any downtime when upgrading
multicluster, it does affect probing. <code>linkerd multicluster gateways</code> will
falsely advertise the target cluster gateway as being down until the clusters
are re-linked.</p><p>Multicluster now supports <code>NodePort</code> type services for the gateway. To support
this change, the configuration options in the Helm values file are now grouped
under the <code>gateway</code> field. If you have installed the extension with other
options than the provided defaults, you will need to update your <code>values.yaml</code>
file to reflect this change in field grouping.</p><h4 id=other-changes class=anchor>Other changes
<a href=#other-changes class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>Besides the breaking changes described above, there are other minor changes to
be aware of when upgrading from <code>stable-2.10.x</code>:</p><ul><li><code>PodSecurityPolicy</code> (PSP) resources are no longer installed by default as a
result of their deprecation in Kubernetes v1.21 and above. The control plane
and core extensions will now be shipped without PSPs; they can be enabled
through a new install option <code>enablePSP: true</code>.</li><li>The <code>tcp_connection_duration_ms</code> metric has been removed.</li><li>Opaque ports changes: <code>443</code> is no longer included in the default opaque ports
list. Ports <code>4444</code>, <code>6379</code> and <code>9300</code> corresponding to Galera, Redis and
ElasticSearch respectively (all server speak first protocols) have been added
to the default opaque ports list. The default ignore inbound ports list has
also been changed to include ports <code>4567</code> and <code>4568</code>.</li></ul><h3 id=upgrade-notice-stable-2100 class=anchor>Upgrade notice: stable-2.10.0
<a href=#upgrade-notice-stable-2100 class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h3><p>If you are currently running Linkerd 2.9.0, 2.9.1, 2.9.2, or 2.9.3 (but <em>not</em>
2.9.4), and you <em>upgraded</em> to that release using the <code>--prune</code> flag (as opposed
to installing it fresh), you will need to use the <code>linkerd repair</code> command as
outlined in the <a href=#upgrade-notice-stable-2-9-3>Linkerd 2.9.3 upgrade notes</a>
before you can upgrade to Linkerd 2.10.</p><p>Additionally, there are two changes in the 2.10.0 release that may affect you.
First, the handling of certain ports and protocols has changed. Please read
through our <a href=../upgrading-2.10-ports-and-protocols/>ports and protocols in 2.10 upgrade
guide</a> for the repercussions.</p><p>Second, we&rsquo;ve introduced <a href=../extensions/>extensions</a> and moved the
default visualization components into a Linkerd-Viz extension. Read on for what
this means for you.</p><h4 id=visualization-components-moved-to-linkerd-viz-extension class=anchor>Visualization components moved to Linkerd-Viz extension
<a href=#visualization-components-moved-to-linkerd-viz-extension class=anchor__link><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7A5 5 0 002 12a5 5 0 005 5h4V15.1H7c-1.71.0-3.1-1.39-3.1-3.1M8 13h8V11H8v2m9-6H13V8.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1H13V17h4a5 5 0 005-5A5 5 0 0017 7z"/></svg></a></h4><p>With the introduction of <a href=../extensions/>extensions</a>, all of the
Linkerd control plane components related to visibility (including Prometheus,
Grafana, Web, and Tap) have been removed from the main Linkerd control plane
and moved into the Linkerd-Viz extension. This means that when you upgrade to
stable-2.10.0, these components will be removed from your cluster and you will
not be able to run commands such as <code>linkerd stat</code> or
<code>linkerd dashboard</code>. To restore this functionality, you must install the
Linkerd-Viz extension by running <code>linkerd viz install | kubectl apply -f -</code>
and then invoke those commands through <code>linkerd viz stat</code>,
<code>linkerd viz dashboard</code>, etc.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Upgrade the control plane (this will remove viz components).</span>
</span></span><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd -f -
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Prune cluster-scoped resources</span>
</span></span><span style=display:flex><span>linkerd upgrade | kubectl apply --prune -l linkerd.io/control-plane-ns<span style=color:#ff7b72;font-weight:700>=</span>linkerd <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-allowlist<span style=color:#ff7b72;font-weight:700>=</span>rbac.authorization.k8s.io/v1/clusterrole <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-allowlist<span style=color:#ff7b72;font-weight:700>=</span>rbac.authorization.k8s.io/v1/clusterrolebinding <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --prune-allowlist<span style=color:#ff7b72;font-weight:700>=</span>apiregistration.k8s.io/v1/apiservice -f -
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install the Linkerd-Viz extension to restore viz functionality.</span>
</span></span><span style=display:flex><span>linkerd viz install | kubectl apply -f -
</span></span></code></pre></div><p>Helm users should note that configuration values related to these visibility
components have moved to the Linkerd-Viz chart. Please update any values
overrides you have and use these updated overrides when upgrading the Linkerd
chart or installing the Linkerd-Viz chart. See below for a complete list of
values which have moved.</p><div class=highlight><pre tabindex=0 style=color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Upgrade the control plane (this will remove viz components).</span>
</span></span><span style=display:flex><span>helm upgrade linkerd2 linkerd/linkerd2 --reset-values -f values.yaml --atomic
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Install the Linkerd-Viz extension to restore viz functionality.</span>
</span></span><span style=display:flex><span>helm install linkerd2-viz linkerd/linkerd2-viz -f viz-values.yaml
</span></span></code></pre></div><p>The following values were removed from the Linkerd2 chart. Most of the removed
values have been moved to the Linkerd-Viz chart or the Linkerd-Jaeger chart.</p><ul><li><code>dashboard.replicas</code> moved to Linkerd-Viz as <code>dashboard.replicas</code></li><li><code>tap</code> moved to Linkerd-Viz as <code>tap</code></li><li><code>tapResources</code> moved to Linkerd-Viz as <code>tap.resources</code></li><li><code>tapProxyResources</code> moved to Linkerd-Viz as <code>tap.proxy.resources</code></li><li><code>webImage</code> moved to Linkerd-Viz as <code>dashboard.image</code></li><li><code>webResources</code> moved to Linkerd-Viz as <code>dashboard.resources</code></li><li><code>webProxyResources</code> moved to Linkerd-Viz as <code>dashboard.proxy.resources</code></li><li><code>grafana</code> moved to Linkerd-Viz as <code>grafana</code></li><li><code>grafana.proxy</code> moved to Linkerd-Viz as <code>grafana.proxy</code></li><li><code>prometheus</code> moved to Linkerd-Viz as <code>prometheus</code></li><li><code>prometheus.proxy</code> moved to Linkerd-Viz as <code>prometheus.proxy</code></li><li><code>global.proxy.trace.collectorSvcAddr</code> moved to Linkerd-Jaeger as <code>webhook.collectorSvcAddr</code></li><li><code>global.proxy.trace.collectorSvcAccount</code> moved to Linkerd-Jaeger as <code>webhook.collectorSvcAccount</code></li><li><code>tracing.enabled</code> removed</li><li><code>tracing.collector</code> moved to Linkerd-Jaeger as <code>collector</code></li><li><code>tracing.jaeger</code> moved to Linkerd-Jaeger as <code>jaeger</code></li></ul><p>Also please note the global scope from the Linkerd2 chart values has been
dropped, moving the config values underneath it into the root scope. Any values
you had customized there will need to be migrated; in particular
<code>identityTrustAnchorsPEM</code> in order to conserve the value you set during
install."</p></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>