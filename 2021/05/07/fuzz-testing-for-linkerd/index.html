<!doctype html><html lang=en><head><meta charset=utf-8><title>Introducing fuzz testing for Linkerd | Linkerd</title>
<link rel="shortcut icon" href=/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Over the past few months, the team at Ada Logics has
been hard at work introducing fuzz testing to Linkerd&rsquo;s Rust
proxy.
These fuzz tests now run continuously on Linkerd via Google&rsquo;s
OSS-Fuzz service, providing another layer
of safety for Linkerd users around the globe. In total, fuzzing was integrated
into seven dependencies of the proxy as well as the proxy itself, and five of
these projects are now running continuously on OSS-Fuzz."><meta property="og:url" content="https://travisbeckham.github.io/2021/05/07/fuzz-testing-for-linkerd/"><meta property="og:site_name" content="Linkerd"><meta property="og:title" content="Introducing fuzz testing for Linkerd"><meta property="og:description" content="Over the past few months, the team at Ada Logics has been hard at work introducing fuzz testing to Linkerd’s Rust proxy. These fuzz tests now run continuously on Linkerd via Google’s OSS-Fuzz service, providing another layer of safety for Linkerd users around the globe. In total, fuzzing was integrated into seven dependencies of the proxy as well as the proxy itself, and five of these projects are now running continuously on OSS-Fuzz."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-05-07T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-07T00:00:00+00:00"><meta property="og:image" content="https://travisbeckham.github.io/2021/05/07/fuzz-testing-for-linkerd/cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://travisbeckham.github.io/2021/05/07/fuzz-testing-for-linkerd/cover.jpg"><meta name=twitter:title content="Introducing fuzz testing for Linkerd"><meta name=twitter:description content="Over the past few months, the team at Ada Logics has been hard at work introducing fuzz testing to Linkerd’s Rust proxy. These fuzz tests now run continuously on Linkerd via Google’s OSS-Fuzz service, providing another layer of safety for Linkerd users around the globe. In total, fuzzing was integrated into seven dependencies of the proxy as well as the proxy itself, and five of these projects are now running continuously on OSS-Fuzz."><meta name=twitter:site content="@Linkerd"><link rel=canonical href=https://travisbeckham.github.io/2021/05/07/fuzz-testing-for-linkerd/><link rel=stylesheet href=/css/main.css><script src=/js/main.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":"William Morgan","datePublished":"2021-05-07T00:00:00Z","dateModified":"2021-05-07T00:00:00Z","headline":"Introducing fuzz testing for Linkerd","image":"https://travisbeckham.github.io/2021/05/07/fuzz-testing-for-linkerd/cover.jpg","publisher":{"@type":"Organization","name":"linkerd.io","logo":{"@type":"ImageObject","url":"https://travisbeckham.github.io/logos/linkerd.png","width":472,"height":100}}}</script></head><body><header class=main-header><div class=main-header__container><div class=main-header__logo><a href=/><img src=/logos/linkerd.png alt=Linkerd></a></div><input class=main-header__toggle-checkbox type=checkbox id=main-header-toggle>
<label class=main-header__toggle for=main-header-toggle><span class=main-header__toggle-icon><span class=main-header__toggle-icon--open><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M3 6H21V8H3V6m0 5H21v2H3V11m0 5H21v2H3V16z"/></svg>
</span><span class=main-header__toggle-icon--close><svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg></span></span></label><div class=main-header__nav><nav class=main-nav><ul class=main-nav__menu><li><a href=/docs>Docs</a></li><li><a href=#>Community<svg class="icon icon--primary" viewBox="0 0 24 24"><path d="M7.41 8.58 12 13.17l4.59-4.59L18 10l-6 6-6-6L7.41 8.58z"/></svg></a><ul><li><a href=/community/get-involved/>Get Involved</a></li><li><a href=/community/adopters/>Adopters</a></li><li><a href=/community/ambassadors/>Linkerd Ambassadors</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Buoyant's Linkerd Forum</a></li></ul></li><li class=main-nav__menu--selected><a href=/blog/>Blog</a></li><li><a href=/faq/>FAQ</a></li><li><a href=/enterprise/>Enterprise</a></li></ul><div class=main-nav__search><form action=/search method=get><div class="search-input search-input--sm"><svg class="icon" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5.0 0116 9.5c0 1.61-.59 3.09-1.56 4.23L14.71 14H15.5l5 5L19 20.5l-5-5V14.71L13.73 14.44C12.59 15.41 11.11 16 9.5 16A6.5 6.5.0 013 9.5 6.5 6.5.0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
<input type=text name=q placeholder=Search></div></form></div><div class=main-nav__github><a class=github-button href=https://github.com/linkerd/linkerd2 data-icon=octicon-star data-size=large data-show-count=true aria-label="Star linkerd/linkerd2 on GitHub">Star</a></div><div class=main-nav__forum><a href=https://linkerd.buoyant.io class="button button--primary button--sm" target=_blank rel=noopener>Join Forum</a></div></nav></div></div></header><div class=main-announcement>Service Mesh 101: Get Service Mesh-Certified
<span class=main-announcement__link><a href=https://buoyant.io/courses/service-mesh-101 target=_blank rel=noopener>Enroll now</a></span></div><main class=main-content><div class="blog blog--single"><div class="blog__container container"><div class=blog-post><div class=blog-post__header><h1>Introducing fuzz testing for Linkerd</h1><div class=blog-post-meta><div class=blog-post-meta__media><img src=/authors/william-morgan.jpg alt="William Morgan" class="img img--48 img--round"></div><div class=blog-post-meta__body><div class=blog-post-meta__name>William Morgan</div><div class=blog-post-meta__date>May 7, 2021 • 6 min read</div></div></div></div><div class=blog-post__cover><img src=/2021/05/07/fuzz-testing-for-linkerd/cover.jpg alt=Cover class="img img--fill img--rounded"></div><div class="blog-post__content prose"><p>Over the past few months, the team at <a href=https://adalogics.com/ target=_blank rel=noopener>Ada Logics</a> has
been hard at work introducing fuzz testing to <a href=https://linkerd.io/2020/07/23/under-the-hood-of-linkerds-state-of-the-art-rust-proxy-linkerd2-proxy/ target=_blank rel=noopener>Linkerd&rsquo;s Rust
proxy</a>.
These fuzz tests now run continuously on Linkerd via Google&rsquo;s
<a href=https://github.com/google/oss-fuzz target=_blank rel=noopener>OSS-Fuzz</a> service, providing another layer
of safety for Linkerd users around the globe. In total, fuzzing was integrated
into seven dependencies of the proxy as well as the proxy itself, and five of
these projects are now running continuously on OSS-Fuzz.</p><p>These fuzz tests uncovered two minor bugs in the proxy, which have since been
fixed. (By comparison, a similar recent effort on a C-based CNCF project found
(and fixed) over 30 bugs, primarily related to memory safety). In addition, a
few minor issues were found in dependencies, and these have all been
communicated to the maintainers.</p><p>You can read the <a href=https://github.com/linkerd/linkerd2-proxy/blob/main/docs/reports/linkerd2-proxy-fuzzing-report.pdf target=_blank rel=noopener>full report
here</a>.
For details, and how you can get involved in this important safety measure for
Linkerd, read on!</p><p>(Background reading: <a href=https://linkerd.io/2020/07/23/under-the-hood-of-linkerds-state-of-the-art-rust-proxy-linkerd2-proxy/ target=_blank rel=noopener>Under the hood of Linkerd&rsquo;s state-of-the-art Rust proxy,
Linkerd2-proxy</a>;
and <a href=https://linkerd.io/2020/12/03/why-linkerd-doesnt-use-envoy/ target=_blank rel=noopener>Why Linkerd doesn&rsquo;t use
Envoy</a>.)</p><h2 id=why-fuzz-test-the-proxy>Why fuzz test the proxy?</h2><p>Fuzz testing is a type of automated software testing that uses randomized
inputs and coverage-based genetic algorithms to evaluate the behavior of code.
Because the input is randomly generated, fuzz testing is useful in capturing
test cases that humans might miss, especially when it comes to corner cases
around invalid or unexpected inputs.</p><p>Linkerd uses <a href=https://github.com/linkerd/linkerd2/actions target=_blank rel=noopener>an arsenal of automated
tests</a> to ensure safety and
reliability on every commit. These tests range from code linting and static
analysis, to unit tests, to a comprehensive suite of integration tests. While
these tests play a major part of Linkerd&rsquo;s development process, there are
three reasons why we wanted to augment them with fuzz testing of the proxy in
particular:</p><ol><li><p><strong>Linkerd&rsquo;s proxy handles untrusted input from the network.</strong> The proxy must
take a request from an application or possibly from the open Internet; parse
the data; and &ldquo;do something&rdquo; with it—send it to its destination, reject it,
etc. While Rust&rsquo;s memory safety guarantees help us avoid an entire class of
security vulnerabilities that are endemic to C and C++ code, that, of course,
doesn&rsquo;t prevent other types of bugs. And the threshold for resilience in the
proxy is <em>extremely</em> high—it must be able to handle even the worst-case
scenario of malicious input crafted by someone with full source code access.</p></li><li><p><strong>The data plane proxy is the most critical runtime component of any service
mesh.</strong> While Linkerd is designed so that a temporary failure of control plane
components does not affect running applications, temporary failures at the data
plane level means that pods are unable to process requests. And beyond simple
failures, the worst-case scenario for bugs in the proxy is horrifying: changing
or corrupting a request could be disastrous; not handling mTLS correctly could
expose traffic to attackers; and so on. Thus, it behoves us to have the most
robust set of tests possible, in addition to our existing reliability practices
around code review, etc.</p></li><li><p><strong>The fuzz testing ecosystem for Rust is simply underdeveloped compared to
that of other languages.</strong> Investing in this critical area meant that not just
Linkerd, but other projects that are built on the state-of-the-art Rust
networking ecosystem (projects like <a href=https://tokio.rs/ target=_blank rel=noopener>Tokio</a>,
<a href=https://hyper.rs/ target=_blank rel=noopener>Hyper</a>, <a href=https://github.com/ctz/rustls target=_blank rel=noopener>Rustls</a>, and
<a href=https://github.com/tower-rs/tower target=_blank rel=noopener>Tower</a>) could all benefit from this work—a
win for everyone.</p></li></ol><h2 id=what-did-the-fuzz-testing-find>What did the fuzz testing find?</h2><p>The initial fuzz tests found two minor bugs in Linkerd&rsquo;s proxy.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> First, the
proxy would panic when a DNS lookup resulted in names exceeding 255 bytes, due
to <a href=https://github.com/bluejekyll/trust-dns/issues/1447 target=_blank rel=noopener>a bug in the trust-dns
library</a> the proxy uses
for DNS queries. This issue was fixed immediately by the maintainers of that
library and the fix incorporated in recent Linkerd releases.</p><p>Second, the proxy would panic when resolving IPv6 addresses with port 80. (Most
Kubernetes providers do not yet support IPv6, but the proxy is future-proofed
for when they do.) This was <a href=https://github.com/linkerd/linkerd2-proxy/pull/976 target=_blank rel=noopener>a bug in the proxy
itself</a>, and was also fixed
immediately with the fix incorporated into recent Linkerd releases.</p><p>These bugs demonstrate the value of fuzz testing: they represent logical flaws
in the proxy (and dependent libraries) that involved unexpected edge cases, in
code which had passed several rounds of human review.</p><p>While no two projects are alike, as a point of comparison, a recent similar
exercise by Ada Logics on a graduated CNCF project written in C yielded over 30
bugs, including 4 &ldquo;high severity&rdquo; and 8 &ldquo;medium severity&rdquo; bugs. The majority of
these bugs were buffer overflows, null dereferences, memory leaks, and other
types of memory errors that Linkerd&rsquo;s use of Rust allows us to avoid in the
first place.
(<a href=https://www.cncf.io/blog/2020/12/15/securing-open-source-fuzzing-integration-vulnerability-analysis-and-bug-fixing-of-fluent-bit/ target=_blank rel=noopener>link</a>)</p><h2 id=so-whats-next>So what&rsquo;s next?</h2><p>The fact that the fuzz tests found bugs is great! But this is just the
beginning, not the end, of the fuzz testing story. This initial work only
captured a portion of the proxy&rsquo;s surface area, and there&rsquo;s a lot more that
could benefit from fuzz testing.</p><p>If you&rsquo;re looking for ways to get involved with Linkerd—and we&rsquo;d love to have
you—the good news is that this is yet another avenue by which you can help the
project. If you&rsquo;re interested in further building out Linkerd&rsquo;s set of fuzz
tests, please see <a href=https://github.com/linkerd/linkerd2-proxy/blob/main/docs/FUZZING.md target=_blank rel=noopener>the developer docs for proxy fuzzing in
Linkerd</a>,
hop into <code>#contributors</code> on <a href=https://slack.linkerd.io target=_blank rel=noopener>the Linkerd Slack</a>, and
let&rsquo;s make it happen!</p><h2 id=thank-you>Thank you</h2><p>The Linkerd maintainers would like to issue a special thank-you to the Ada
Logics team and David Korczynski in particular for their hard work in
implementing these fuzzers, for wading into the uncharted waters of fuzz
testing for Rust, and for helping us navigate the OSS-Fuzz project. We&rsquo;d also
like to thank the CNCF, especially Chris Aniszczyk, for sponsoring this work.</p><h2 id=linkerd-is-for-everyone>Linkerd is for everyone</h2><p>Linkerd is a community project and is hosted by the
<a href=https://cncf.io/ target=_blank rel=noopener>Cloud Native Computing Foundation</a>. Linkerd is
<a href=https://linkerd.io/2019/10/03/linkerds-commitment-to-open-governance/ target=_blank rel=noopener>committed to open governance.</a>
If you have feature requests, questions, or comments, we&rsquo;d love to have you join
our rapidly-growing community! Linkerd is hosted on
<a href=https://github.com/linkerd/ target=_blank rel=noopener>GitHub</a>, and we have a thriving community on
<a href=https://slack.linkerd.io/ target=_blank rel=noopener>Slack</a>, <a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a>, and
the <a href=https://linkerd.io/2.16/get-involved/ target=_blank rel=noopener>mailing lists</a>. Come and join the fun!</p><p>(<em>Photo by <a href="https://unsplash.com/@princeabid708?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText%22" target=_blank rel=noopener>Prince Abid</a> on <a href="https://unsplash.com/s/photos/fuzz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target=_blank rel=noopener>Unsplash</a>.</em>)</p><h2 id=footnotes>Footnotes</h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>The tests are focused on finding situations that cause the proxy to &ldquo;panic&rdquo;, or intentionally crash—an easily-detectable situation that is the consequence of the proxy finding itself in a situation it can&rsquo;t handle. A fuzz test that causes the proxy to panic in response to strange input is a sure sign of a bug.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></div><div class=blog-post-related><h2>Suggested Blog Posts</h2><div class=blog-post-related__pages><div class="card card--horz card--center"><div class=card__media><img src=/2024/10/15/linkerd-edge-release-roundup/thumbnail.png alt=Thumbnail class="img img--128 img--rounded"></div><div class=card__body><div class=card__header><h4><a href=/2024/10/15/linkerd-edge-release-roundup/>Linkerd Edge Release Roundup: October 2024</a></h4><div class=blog-post-meta><div class=blog-post-meta__date>Oct 15, 2024 • 4 min read</div></div></div></div></div><div class="card card--horz card--center"><div class=card__media><img src=/2024/09/06/linkerd-edge-release-roundup/thumbnail.png alt=Thumbnail class="img img--128 img--rounded"></div><div class=card__body><div class=card__header><h4><a href=/2024/09/06/linkerd-edge-release-roundup/>Linkerd Edge Release Roundup: September 2024</a></h4><div class=blog-post-meta><div class=blog-post-meta__date>Sep 6, 2024 • 3 min read</div></div></div></div></div><div class="card card--horz card--center"><div class=card__media><img src=/2024/08/13/announcing-linkerd-2.16/cover.jpg alt=Cover class="img img--128 img--rounded"></div><div class=card__body><div class=card__header><h4><a href=/2024/08/13/announcing-linkerd-2.16/>Announcing Linkerd 2.16! Metrics, retries, and timeouts for HTTP and gRPC
routes; IPv6 support; policy audit mode; and lots more</a></h4><div class=blog-post-meta><div class=blog-post-meta__date>Aug 13, 2024 • 6 min read</div></div></div></div></div></div></div></div></div></main><footer class=main-footer><div class=main-footer__top><div class="main-footer__container container"><div class=main-footer__info><p><img src=/logos/linkerd.png alt=Linkerd></p><p>Linkerd was originally created by <a href=https://buoyant.io/ target=_blank rel=noopener>Buoyant</a></p><p>View <a href=https://github.com/linkerd/linkerd/wiki/Linkerd-code-of-conduct target=_blank rel=noopener>Code of Conduct</a></p></div><div class=main-footer__links><div class=main-footer__community><h4>Community</h4><ul><li><a href=https://github.com/linkerd/linkerd2 target=_blank rel=noopener>GitHub</a></li><li><a href=https://slack.linkerd.io target=_blank rel=noopener>Slack</a></li><li><a href=https://linkerd.buoyant.io target=_blank rel=noopener>Linkerd Forum</a></li></ul></div><div class=main-footer__follow><h4>Follow</h4><ul><li><a href=https://www.linkedin.com/company/linkerd/ target=_blank rel=noopener>Linkedin</a></li><li><a href=https://www.youtube.com/buoyantio target=_blank rel=noopener>YouTube</a></li><li><a href=https://twitter.com/linkerd target=_blank rel=noopener>Twitter</a></li></ul></div></div></div></div><div class=main-footer__bottom><div class="main-footer__container container"><p><a href=https://github.com/linkerd/website/tree/main/linkerd.io/content target=_blank rel=noopener>Edit This Site</a></p><p>Copyright © 2024 Linkerd Authors. All rights reserved.</p></div></div></footer></body></html>